import{c as W,g as q}from"./chunk-A6HFWANZ.js";import{q as U}from"./chunk-3YQBHJ2R.js";import{a as H,b as K}from"./chunk-FFY7Y7IJ.js";import{a as Q}from"./chunk-TMQQ4ID3.js";import{h as Z,wa as B,ya as P}from"./chunk-FFTZY5MM.js";import{$c as $,Aa as h,Ca as z,Ea as w,Fb as R,Lb as k,Sb as D,T as y,ad as A,da as p,dc as E,dd as G,ec as S,fc as g,gc as M,h as C,la as d,nb as T,nc as j,oa as I,qa as l,rc as b,s as F,sc as u,ua as v,wc as V,xb as _,xc as O,xd as L,yc as N,za as f,zd as s}from"./chunk-VGTTTKP2.js";var m=(()=>{class o{modalFullStatusStore$=new C(!1);setModalFullStatusStore(e){this.modalFullStatusStore$.next(e)}getModalFullStatusStore(){return this.modalFullStatusStore$.asObservable()}static \u0275fac=function(t){return new(t||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var re=["componentTpl"];function le(o,x){if(o&1){let e=j();S(0,"span",1),b("click",function(n){f(e);let r=u();return h(r.fullScreenIconClick(n))}),M(1,"nz-icon",2),$(2,"async"),g(),S(3,"span",3),b("click",function(){f(e);let n=u();return h(n.closeModal())}),M(4,"nz-icon",4),g()}if(o&2){let e=u();T(),E("nzType",A(2,1,e.modalFullStatus$)?"fullscreen-exit":"fullscreen")}}var X=(()=>{class o{componentTpl;modalFullScreenFlag=!1;modalFullStatus=l(m);modalFullStatus$=this.modalFullStatus.getModalFullStatusStore();constructor(){this.modalFullStatus$.pipe(s()).subscribe(e=>this.modalFullScreenFlag=e)}fullScreenIconClick(e){this.modalFullScreenFlag=!this.modalFullScreenFlag,this.modalFullStatus.setModalFullStatusStore(this.modalFullScreenFlag),W(e)}closeModal(){this.modalFullScreenFlag=!1,this.modalFullStatus.setModalFullStatusStore(!1)}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=R({type:o,selectors:[["app-global-modal-btn-tpl"]],viewQuery:function(t,n){if(t&1&&V(re,7),t&2){let r;O(r=N())&&(n.componentTpl=r.first)}},decls:2,vars:0,consts:[["componentTpl",""],[1,"hover-blue","full-height","flex-auto","text-right","d-i-b",3,"click"],["nzTheme","outline",1,"m-r-8",3,"nzType"],[1,"hover-red","full-height","flex-auto","d-i-b","m-r-15",3,"click"],["nzTheme","outline","nzType","close"]],template:function(t,n){t&1&&k(0,le,5,3,"ng-template",null,0,G)},dependencies:[P,B,Z],encapsulation:2,changeDetection:0})}return o})();var Y=new I("modal action btn token",{providedIn:"root",factory:()=>{let o=l(D),x=l(v),e=L(X,{environmentInjector:x});return o.attachView(e.hostView),e}});var ee=o=>{throw new Error(o)},te=()=>ee("Maybe your modal component did not introduce override modalRef = inject(NzModalRef);"),oe=()=>ee("Maybe the getCurrentValue method is not introduced in your modal component, and you need to override the implementation.");var ne=class{modalRef=l(H)},Ve=(()=>{class o{bsModalService;btnTpl;renderer;destroyRef=l(w);baseInjector=l(z);modalFullStatusStoreService=l(m);dragDrop=l(Q);rendererFactory=l(_);btnComponentRef=l(Y);constructor(){this.bsModalService=this.baseInjector.get(K),this.renderer=this.rendererFactory.createRenderer(null,null),this.btnTpl=this.btnComponentRef.instance.componentTpl,this.modalFullStatusStoreService.getModalFullStatusStore().pipe(s()).subscribe(e=>{this.fullScreenIconClick(e)})}fullScreenIconClick(e){this.bsModalService.openModals.forEach(t=>{e?this.renderer.addClass(t.containerInstance.host.nativeElement,"fullscreen-modal"):this.renderer.removeClass(t.containerInstance.host.nativeElement,"fullscreen-modal")})}getRandomCls(){return`NZ-MODAL-WRAP-CLS-${q()}`}cancelCallback(e){return this.modalCompVerification(e),this.modalFullStatusStoreService.setModalFullStatusStore(!1),e.modalRef.destroy({status:0,modalValue:null})}confirmCallback(e){this.modalCompVerification(e),e.modalRef.componentInstance.getCurrentValue().pipe(p(t=>(this.modalFullStatusStoreService.setModalFullStatusStore(!1),t?e.modalRef.destroy({status:1,modalValue:t}):F(!1))),s(this.destroyRef)).subscribe()}modalCompVerification(e){e.modalRef||te(),e.modalRef.componentInstance.getCurrentValue||oe()}getZIndex(e){return+getComputedStyle(e,null).zIndex}getModalMaxZIndex(e){return this.bsModalService.openModals.reduce((t,n)=>{let r=n.containerInstance.host.nativeElement;if(e===r)return t;let a=this.getZIndex(r);return a>=t.zIndex&&(t.zIndex=a,t.canChange=!0),t},{zIndex:this.getZIndex(e),canChange:!1})}setMaxZIndex(e){e.addEventListener("mousedown",()=>{let t=this.getModalMaxZIndex(e);t.canChange&&(e.style.zIndex=`${t.zIndex+1}`)},!1)}createDrag(e){let t=document.querySelector(`.${e}`),n=t.querySelector(".ant-modal-content"),r=n.querySelector(".ant-modal-header"),a=this.getModalMaxZIndex(t);return a.canChange&&(t.style.zIndex=`${a.zIndex+1}`),this.setMaxZIndex(t),r?(r.className+=" hand-model-move",this.dragDrop.createDrag(r).withHandles([r]).withRootElement(n)):this.dragDrop.createDrag(n).withHandles([n])}fixedWrapElementStyle(e){e.style.pointerEvents="none"}createModalConfig(e,t={},n,r=""){let a={nzTitle:"",nzContent:e,nzCloseIcon:t.nzCloseIcon||this.btnTpl,nzMaskClosable:!1,nzFooter:[{label:"Confirm",type:"primary",show:!0,onClick:this.confirmCallback.bind(this)},{label:"Cancel",type:"default",show:!0,onClick:this.cancelCallback.bind(this)}],nzOnCancel:()=>new Promise(c=>{c({status:0,modalValue:null})}),nzClosable:!0,nzWidth:720,nzData:n},i=U(a,t);return i.nzWrapClassName=`${i.nzWrapClassName||""} ${r}`,i}show(e,t={},n){let r=this.getRandomCls(),a=this.createModalConfig(e,t,n,r),i=this.bsModalService.create(a),c;return i.afterOpen.pipe(y(),s(this.destroyRef)).subscribe(()=>{c=this.createDrag(r)}),i.afterClose.pipe(p(()=>{c.dispose(),c=null,this.modalFullStatusStoreService.setModalFullStatusStore(!1)}))}static \u0275fac=function(t){return new(t||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();export{ne as a,Ve as b};
