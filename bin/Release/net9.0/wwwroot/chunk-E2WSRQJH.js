import{a as Bn,b as Dn,c as Pn,d as Fn}from"./chunk-BBP6QTKY.js";import{a as vn,b as An,c as Mn,d as Nn,e as In,f as Rn}from"./chunk-QH4QWHOD.js";import{a as re,b as le}from"./chunk-M7P75A5D.js";import{a as Ln}from"./chunk-RZS2VBKI.js";import{a as ie,b as ae}from"./chunk-MB62BGFX.js";import"./chunk-D7APIFYM.js";import{A as H,B as zn,C as bn,D as yn,E as Cn,G as Tn,I as kn,J as G,e as an,f as xt,h as sn,j as mn,m as pn,n as cn,o as xn,p as hn,t as Sn,u as un,v as En,w as gn,x as fn,y as wn,z as _n}from"./chunk-EKL3WZR4.js";import"./chunk-KZNNWNDS.js";import{d as rn,f as ln,g as on,m as lt,n as He}from"./chunk-Y3M25KWH.js";import{a as B,b as D,c as P,i as tn,k as nn,l as F,m as O}from"./chunk-CJQLLOKI.js";import{a as I,b as R,c as rt,e as L}from"./chunk-JRPV4KBQ.js";import"./chunk-FOQHZVA7.js";import{Z as dn,ba as te,ca as ne,k as Z,q as de}from"./chunk-I77QUVB7.js";import"./chunk-4Q6BGM2E.js";import"./chunk-PZF5K3UE.js";import{C as ee,d as J,e as Q,f as N,q as X,v as $}from"./chunk-QUV3AW6L.js";import{Ca as en,P as ct,da as Zt,ea as Xt,fa as Ge,ga as $t,i as it,k as Yt,m as Y,ta as A,u as at,va as M}from"./chunk-75GKP3NE.js";import{b as pe}from"./chunk-EOIQRFAW.js";import{a as me}from"./chunk-CAAASSRE.js";import{$b as t,Ac as e,Ba as At,Bc as ze,Ca as Ke,Cc as be,Db as g,Ec as Ht,Fb as Re,Fc as V,Ga as Me,Gb as se,Gc as U,Hc as j,Lc as mt,Mc as Vt,Na as Mt,Nc as Ut,Oa as Nt,Oc as W,Pc as dt,Qa as It,Qb as Dt,Qc as jt,R as ot,Rc as Wt,Sb as ue,Ub as Ee,Uc as Jt,Wb as Ue,Wc as Qt,Xb as je,Yb as We,Yc as v,Zb as c,_b as n,ac as d,ad as Gt,ba as bt,bc as f,cc as w,da as qe,ea as yt,ec as _,f as zt,gd as qt,ib as Rt,ja as Ct,jc as h,ka as Tt,kd as pt,lb as m,lc as p,ld as tt,m as Ve,mc as Ze,n as _e,nb as Lt,nc as Xe,oa as x,oc as Pt,pb as Ye,pc as $e,pd as nt,q as oe,qc as Je,qd as Kt,rc as Qe,tc as Ft,uc as Ot,va as kt,vc as T,wa as vt,xa as u,xb as C,ya as E,yb as Bt,yc as et,zc as st}from"./chunk-LNT4AZLS.js";import{a as ge,b as fe}from"./chunk-3XFQOAE3.js";function ht(a,s){if(!a||!a.getClientRects().length)return 0;let i=a.getBoundingClientRect();if(i.width||i.height){if(s===window){let l=a.ownerDocument.documentElement;return i.top-l.clientTop}return i.top-s.getBoundingClientRect().top}return i.top}var $n=["ink"],ei=["*"],ti=a=>({"ant-anchor-wrapper-horizontal":a}),ni=a=>({"ant-anchor-fixed":a});function ii(a,s){}function ai(a,s){if(a&1&&(n(0,"nz-affix",2),g(1,ii,0,0,"ng-template",3),t()),a&2){let i=p(),l=T(3);c("nzOffsetTop",i.nzOffsetTop)("nzTarget",i.container),m(),c("ngTemplateOutlet",l)}}function ri(a,s){}function li(a,s){if(a&1&&g(0,ri,0,0,"ng-template",3),a&2){p();let i=T(3);c("ngTemplateOutlet",i)}}function oi(a,s){if(a&1&&(n(0,"div",4)(1,"div",5)(2,"div",6),d(3,"div",7,1),t(),Xe(5),t()()),a&2){let i=p();et(i.wrapperStyle),st(dt(6,ti,i.nzDirection==="horizontal")),m(),st(dt(8,ni,!i.nzAffix&&!i.nzShowInkInFixed))}}var On="ant-anchor-ink-ball-visible",si="anchor",mi=/#([^#]+)$/,di=$t({passive:!0}),q=(()=>{let a,s=[],i=[],l,r=[],o=[],S,y=[],Et=[],gt,ft=[],wt=[];return class St{static{let b=typeof Symbol=="function"&&Symbol.metadata?Object.create(null):void 0;a=[Ge()],l=[Ge()],S=[Ge()],gt=[Ge()],Ve(null,null,a,{kind:"field",name:"nzShowInkInFixed",static:!1,private:!1,access:{has:z=>"nzShowInkInFixed"in z,get:z=>z.nzShowInkInFixed,set:(z,k)=>{z.nzShowInkInFixed=k}},metadata:b},s,i),Ve(null,null,l,{kind:"field",name:"nzBounds",static:!1,private:!1,access:{has:z=>"nzBounds"in z,get:z=>z.nzBounds,set:(z,k)=>{z.nzBounds=k}},metadata:b},r,o),Ve(null,null,S,{kind:"field",name:"nzOffsetTop",static:!1,private:!1,access:{has:z=>"nzOffsetTop"in z,get:z=>z.nzOffsetTop,set:(z,k)=>{z.nzOffsetTop=k}},metadata:b},y,Et),Ve(null,null,gt,{kind:"field",name:"nzTargetOffset",static:!1,private:!1,access:{has:z=>"nzTargetOffset"in z,get:z=>z.nzTargetOffset,set:(z,k)=>{z.nzTargetOffset=k}},metadata:b},ft,wt),b&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:b})}nzConfigService=x(Xt);scrollSrv=x(en);cdr=x(tt);platform=x(at);renderer=x(Ye);doc=x(At);destroyRef=x(Ke);_nzModuleName=si;ink;nzAffix=!0;nzShow=!0;nzShowInkInFixed=_e(this,s,!1);nzBounds=(_e(this,i),_e(this,r,5));nzOffsetTop=(_e(this,o),_e(this,y,void 0));nzTargetOffset=(_e(this,Et),_e(this,ft,void 0));nzContainer=_e(this,wt);nzCurrentAnchor;nzDirection="vertical";nzClick=new Re;nzChange=new Re;nzScroll=new Re;visible=!1;wrapperStyle={"max-height":"100vh"};container;activeLink;links=[];animating=!1;destroy$=new zt;handleScrollTimeoutID;constructor(){this.destroyRef.onDestroy(()=>{clearTimeout(this.handleScrollTimeoutID),this.destroy$.next(!0),this.destroy$.complete()})}registerLink(b){this.links.push(b)}unregisterLink(b){this.links.splice(this.links.indexOf(b),1)}getContainer(){return this.container||window}ngAfterViewInit(){this.registerScrollEvent()}registerScrollEvent(){this.platform.isBrowser&&(this.destroy$.next(!0),Zt(this.getContainer(),"scroll",di).pipe(yt(50),bt(this.destroy$)).subscribe(()=>this.handleScroll()),this.handleScrollTimeoutID=setTimeout(()=>this.handleScroll()))}handleScroll(){if(typeof document>"u"||this.animating)return;let b=[],k=(this.nzTargetOffset?this.nzTargetOffset:this.nzOffsetTop||0)+this.nzBounds;if(this.links.forEach(K=>{let Se=mi.exec(K.nzHref.toString());if(!Se)return;let we=this.doc.getElementById(Se[1]);if(we){let _t=ht(we,this.getContainer());_t<k&&b.push({top:_t,comp:K})}}),this.visible=!!b.length,!this.visible)this.clearActive(),this.cdr.detectChanges();else{let K=b.reduce((Se,we)=>we.top>Se.top?we:Se);this.handleActive(K.comp)}this.setVisible()}clearActive(){this.links.forEach(b=>{b.unsetActive()})}setActive(b){let z=this.activeLink,k=this.nzCurrentAnchor&&this.links.find(Se=>Se.nzHref===this.nzCurrentAnchor)||b;if(!k)return;k.setActive();let K=k.getLinkTitleElement();this.nzDirection==="vertical"?this.ink.nativeElement.style.top=`${K.offsetTop+K.clientHeight/2-4.5}px`:this.ink.nativeElement.style.left=`${K.offsetLeft+K.clientWidth/2}px`,this.activeLink=(b||k).nzHref,z!==this.activeLink&&this.nzChange.emit(this.activeLink)}handleActive(b){this.clearActive(),this.setActive(b),this.visible=!0,this.setVisible(),this.nzScroll.emit(b)}setVisible(){this.ink&&(this.visible?this.renderer.addClass(this.ink.nativeElement,On):this.renderer.removeClass(this.ink.nativeElement,On))}handleScrollTo(b){let z=this.doc.querySelector(b.nzHref);if(!z)return;this.animating=!0;let k=this.scrollSrv.getScroll(this.getContainer()),K=ht(z,this.getContainer()),Se=k+K;Se-=this.nzTargetOffset!==void 0?this.nzTargetOffset:this.nzOffsetTop||0,this.scrollSrv.scrollTo(this.getContainer(),Se,{callback:()=>{this.animating=!1,this.handleActive(b)}}),this.nzClick.emit(b.nzHref)}ngOnChanges(b){let{nzShow:z,nzOffsetTop:k,nzContainer:K,nzCurrentAnchor:Se}=b;if(k&&(this.wrapperStyle=fe(ge({},this.wrapperStyle),{"max-height":`calc(100vh - ${this.nzOffsetTop}px)`})),z&&(this.wrapperStyle=fe(ge({},this.wrapperStyle),{display:this.nzShow?"block":"none"})),K){let we=this.nzContainer;this.container=typeof we=="string"?this.doc.querySelector(we):we,this.registerScrollEvent()}Se&&this.setActive()}static \u0275fac=function(z){return new(z||St)};static \u0275cmp=C({type:St,selectors:[["nz-anchor"]],viewQuery:function(z,k){if(z&1&&$e($n,5),z&2){let K;Je(K=Qe())&&(k.ink=K.first)}},inputs:{nzAffix:[2,"nzAffix","nzAffix",nt],nzShow:[2,"nzShow","nzShow",nt],nzShowInkInFixed:[2,"nzShowInkInFixed","nzShowInkInFixed",nt],nzBounds:[2,"nzBounds","nzBounds",Kt],nzOffsetTop:[2,"nzOffsetTop","nzOffsetTop",ct],nzTargetOffset:[2,"nzTargetOffset","nzTargetOffset",ct],nzContainer:"nzContainer",nzCurrentAnchor:"nzCurrentAnchor",nzDirection:"nzDirection"},outputs:{nzClick:"nzClick",nzChange:"nzChange",nzScroll:"nzScroll"},exportAs:["nzAnchor"],features:[Mt],ngContentSelectors:ei,decls:4,vars:1,consts:[["content",""],["ink",""],[3,"nzOffsetTop","nzTarget"],[3,"ngTemplateOutlet"],[1,"ant-anchor-wrapper"],[1,"ant-anchor"],[1,"ant-anchor-ink"],[1,"ant-anchor-ink-ball"]],template:function(z,k){z&1&&(Ze(),ue(0,ai,2,3,"nz-affix",2)(1,li,1,1,null,3),g(2,oi,6,10,"ng-template",null,0,v)),z&2&&Ee(k.nzAffix?0:1)},dependencies:[it,ae,ie],encapsulation:2,changeDetection:0})}})();var pi=["nzTemplate"],ci=["linkTitle"],xi=["*"];function hi(a,s){if(a&1&&(n(0,"span"),e(1),t()),a&2){let i=p();m(),ze(i.titleStr)}}function Si(a,s){}function ui(a,s){if(a&1&&g(0,Si,0,0,"ng-template",2),a&2){let i=p();c("ngTemplateOutlet",i.titleTpl||i.nzTemplate)}}function Ei(a,s){a&1&&Xe(0)}var ce=(()=>{class a{elementRef=x(It);anchorComp=x(q);platform=x(at);renderer=x(Ye);destroyRef=x(Ke);nzHref="#";nzTarget;titleStr="";titleTpl;nzDirection="vertical";set nzTitle(i){i instanceof Lt?(this.titleStr=null,this.titleTpl=i):this.titleStr=i}nzTemplate;linkTitle;constructor(){this.destroyRef.onDestroy(()=>{this.anchorComp.unregisterLink(this)})}ngOnInit(){this.anchorComp.registerLink(this),this.nzDirection=this.anchorComp.nzDirection}getLinkTitleElement(){return this.linkTitle.nativeElement}setActive(){this.renderer.addClass(this.elementRef.nativeElement,"ant-anchor-link-active")}unsetActive(){this.renderer.removeClass(this.elementRef.nativeElement,"ant-anchor-link-active")}goToClick(i){i.preventDefault(),i.stopPropagation(),this.platform.isBrowser&&this.anchorComp.handleScrollTo(this)}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-link"]],contentQueries:function(l,r,o){if(l&1&&Pt(o,pi,5),l&2){let S;Je(S=Qe())&&(r.nzTemplate=S.first)}},viewQuery:function(l,r){if(l&1&&$e(ci,5),l&2){let o;Je(o=Qe())&&(r.linkTitle=o.first)}},hostAttrs:[1,"ant-anchor-link"],inputs:{nzHref:"nzHref",nzTarget:"nzTarget",nzTitle:"nzTitle"},exportAs:["nzLink"],ngContentSelectors:xi,decls:5,vars:5,consts:[["linkTitle",""],[1,"ant-anchor-link-title",3,"click","href","target"],[3,"ngTemplateOutlet"]],template:function(l,r){if(l&1){let o=_();Ze(),n(0,"a",1,0),h("click",function(y){return u(o),E(r.goToClick(y))}),ue(2,hi,2,1,"span")(3,ui,1,1,null,2),t(),ue(4,Ei,1,0)}l&2&&(c("href",r.nzHref,Rt)("target",r.nzTarget),Dt("title",r.titleStr),m(2),Ee(r.titleStr?2:3),m(2),Ee(r.nzDirection==="vertical"?4:-1))},dependencies:[it],encapsulation:2,changeDetection:0})}return a})();var xe=(()=>{class a{static \u0275fac=function(l){return new(l||a)};static \u0275mod=Bt({type:a});static \u0275inj=Tt({imports:[q]})}return a})();var gi=()=>({standalone:!0});function fi(a,s){if(a&1){let i=_();f(0),n(1,"a",52),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",53),d(3,"nz-icon",54),t()(),w()}}function wi(a,s){if(a&1){let i=_();f(0),n(1,"a",52),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",53),e(3,"Alexei Cioina's blog"),t()(),w()}}var Hn=(()=>{class a{router=x(Z);#e=x(G);viewPort=x(Y);zone=x(se);mermaidImport=x(pe,{optional:!0});mermaid;isMermaid=!1;enableNavigation=this.#e.selectors.isSwitcher();constructor(){this.isMermaid&&this.mermaidImport&&this.loadMermaid(this.mermaidImport)}ngAfterViewChecked(){this.isMermaid&&this.mermaid&&(this.isMermaid=!1,this.zone.runOutsideAngular(()=>this.mermaid?.default.run()))}loadMermaid(i){this.zone.runOutsideAngular(()=>oe(i).pipe(me()).subscribe(l=>{this.mermaid=l,this.mermaid.default.initialize({startOnLoad:!1}),this.mermaid?.default.run()}))}clickLink(){this.#e.selectors.isAdminArticles()?this.router.navigate(["admin","articles"]):this.router.navigate(["articles"])}disableEnable(){this.#e.setSwitcher(this.enableNavigation)}goLink(i){window&&(window.location.hash=i)}scrollTop(){window&&(window.location.hash=""),this.viewPort.scrollToPosition([0,0])}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-blog-what-version-of-this-blog"]],decls:406,vars:8,consts:[[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","start"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],[1,"toc-affix",3,"nzOffsetTop"],["nz-row","","nzJustify","end"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzSize","small",3,"ngModelChange","ngModel","ngModelOptions"],["nzShowInkInFixed","",3,"nzClick","nzOffsetTop","nzAffix","nzShow"],["nzHref","#h-8a303762","nzTitle","The Problem"],["nzHref","#h-c36299ac","nzTitle","Case Scenario #1"],["nzHref","#h-a42d4269","nzTitle","Case Scenario #2"],["nzHref","#h-b3708047","nzTitle","Case Scenario #3"],[1,"markdown-title"],[1,"subtitle"],[1,"widget"],["aria-label","Edit this page on Github","href","https://github.com/cioina/cioina.azurewebsites.net/edit/main/blog/20211009-what-version-of-this-blog.md","target","_blank","rel","noopener noreferrer",1,"edit-button"],["nzType","edit"],[1,"markdown"],["id","h-8a303762"],["onclick","window.location.hash = 'h-8a303762'",1,"anchor"],["href","https://stackoverflow.com/questions/55494181/what-is-the-purpose-of-swupdate-activateupdate-in-angular/59175788#59175788","target","_blank","rel","noopener"],["id","h-c36299ac"],["onclick","window.location.hash = 'h-c36299ac'",1,"anchor"],["href","https://github.com/cioina/openshift-laravel-example/blob/main/src/acioina/site/src/Acioina/UserManagement/Http/Controllers/Api/VersionController.php","target","_blank","rel","noopener"],[1,"language-php"],[1,"hljs-meta"],[1,"hljs-keyword"],[1,"hljs-title","class_"],[1,"hljs-title"],[1,"hljs-class"],[1,"hljs-variable","constant_"],[1,"hljs-string"],[1,"hljs-function"],[1,"hljs-params"],[1,"hljs-variable"],[1,"hljs-built_in"],[1,"hljs-title","function_","invoke__"],[1,"hljs-variable","language_"],[1,"language-typescript"],[1,"hljs-attr"],[1,"language-csharp"],[1,"hljs-literal"],[1,"hljs-title","function_"],[1,"hljs-property"],["id","h-a42d4269"],["onclick","window.location.hash = 'h-a42d4269'",1,"anchor"],["href","https://github.com/ngrx/platform/blob/main/projects/ngrx.io/src/app/sw-updates/sw-updates.service.ts","target","_blank","rel","noopener"],["id","h-b3708047"],["onclick","window.location.hash = 'h-b3708047'",1,"anchor"],[3,"click"],["nz-typography","","nzType","success"],["nzType","arrow-left"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"nz-card",1)(2,"div",2)(3,"div",3)(4,"nz-space",4),g(5,fi,4,0,"ng-container",5)(6,wi,4,0,"ng-container",5),t()()(),n(7,"nz-affix",6)(8,"div",7)(9,"div",3)(10,"a",8),h("click",function(){return r.scrollTop()}),e(11,"Jump to top"),t()(),n(12,"div",3)(13,"nz-switch",9),j("ngModelChange",function(S){return U(r.enableNavigation,S)||(r.enableNavigation=S),S}),h("ngModelChange",function(){return r.disableEnable()}),t()()(),n(14,"nz-anchor",10),h("nzClick",function(S){return r.goLink(S)}),d(15,"nz-link",11)(16,"nz-link",12)(17,"nz-link",13)(18,"nz-link",14),t()(),n(19,"span",15),e(20," What Version of This Blog Do You See?"),d(21,"span",16)(22,"span",17),n(23,"a",18),d(24,"nz-icon",19),t()(),n(25,"article",20)(26,"p"),e(27,"As you can see, this website does not have a formal version tag. It uses the latest version of "),n(28,"code"),e(29,"ng-zorro-antd"),t(),e(30," and Angular as some kind of version tag. So, just imagine how surprised I was when I deployed this website compiled with Angular "),n(31,"code"),e(32,"12.2.9"),t(),e(33," and checking my very old Samsung that runs on Android 4.4.2. For some reason, the old Chrome web browser does not want to load this website correctly, so, I use an old version of FireFox browser for Android (As you may know, Google does not allow to update apps for old Android versions.) FireFox worked ok at first. But, when I closed and opened the browser again, this site loaded automatically and showed Angular "),n(34,"code"),e(35,"12.2.4"),t(),e(36," at the bottom of the footer. Somehow, FireFox cached an old version of my website. Deleting the FireFox cache did not help, but, reloading the URL would show the correct Angular "),n(37,"code"),e(38,"12.2.9"),t(),e(39,"."),t(),n(40,"blockquote")(41,"p"),e(42,"It looks like starting with Angular 16, this website will not work at all anymore on outdated devices!"),t()(),n(43,"h2",21)(44,"span"),e(45,"The Problem"),t(),n(46,"a",22),e(47,"#"),t()(),n(48,"p"),e(49,"It may be problematic to have latest version for some websites that use Angular with a lot of lazy-loading modules. Imagine a user browsing your website just seconds before you start to deploy a new version of your website. The user will still have the old version (old Angular compiled JavaScript files) even after the deployment ends. We will consider three case scenarios here and will try to implement solution #2 from "),n(50,"strong"),e(51,"gkalpak"),t(),e(52,"'s "),n(53,"a",23),e(54,"StackOverflow"),t(),e(55," answer. We will let website users know that a new version is available and ask them to refresh the webpage."),t(),n(56,"h2",24)(57,"span"),e(58,"Case Scenario #1"),t(),n(59,"a",25),e(60,"#"),t()(),n(61,"p"),e(62,"From my experience, the problem may appear for old/outdated web browsers like one described above or when you open multiple tabs of the same page. You will get a message to reload/refresh the page with an error similar to "),n(63,"strong"),e(64,"ERROR: b607b9112d"),t(),e(65," (where b607b9112d is the new hash.)"),t(),n(66,"p"),e(67,"It was very simple for me to implement this solution because I use a server-side API and deploy my backend and frontend on the same server and generate my deployment with a Node.js script. So, I generate "),n(68,"a",26),e(69,"a small PHP file"),t(),e(70," and small TypeScript file with some unique hash."),t(),n(71,"p")(72,"strong")(73,"code"),e(74,"VersionController.php"),t()()(),n(75,"pre",27)(76,"code")(77,"span",28),e(78,"<?php"),t(),e(79,`
`),n(80,"span",29),e(81,"namespace"),t(),e(82," "),n(83,"span",30),e(84,"Acioina"),t(),e(85,"\\"),n(86,"span",30),e(87,"UserManagement"),t(),e(88,"\\"),n(89,"span",30),e(90,"Http"),t(),e(91,"\\"),n(92,"span",30),e(93,"Controllers"),t(),e(94,"\\"),n(95,"span",30),e(96,"Api"),t(),e(97,`;
`),n(98,"span",29),e(99,"use"),t(),e(100," "),n(101,"span",31),e(102,"Acioina"),t(),e(103,"\\"),n(104,"span",31),e(105,"UserManagement"),t(),e(106,"\\"),n(107,"span",31),e(108,"Transformers"),t(),e(109,"\\"),n(110,"span",31),e(111,"VersionTransformer"),t(),e(112,`;

`),n(113,"span",32)(114,"span",29),e(115,"class"),t(),e(116," "),n(117,"span",31),e(118,"VersionController"),t(),e(119," "),n(120,"span",29),e(121,"extends"),t(),e(122," "),n(123,"span",31),e(124,"ApiController"),t(),e(125,`
`),t(),e(126,`{
    `),n(127,"span",29),e(128,"private"),t(),e(129," "),n(130,"span",29),e(131,"const"),t(),e(132," "),n(133,"span",33),e(134,"ANGULAR_APP_HASH"),t(),e(135," = "),n(136,"span",34),e(137,"'b607b9112d'"),t(),e(138,`;

    `),n(139,"span",29),e(140,"public"),t(),e(141," "),n(142,"span",35)(143,"span",29),e(144,"function"),t(),e(145," "),n(146,"span",31),e(147,"__construct"),t(),e(148,"("),n(149,"span",36),e(150,"VersionTransformer "),n(151,"span",37),e(152,"$transformer"),t()(),e(153,`)
    `),t(),e(154,`{
        `),n(155,"span",38),e(156,"parent"),t(),e(157,"::"),n(158,"span",39),e(159,"__construct"),t(),e(160,"("),n(161,"span",37),e(162,"$transformer"),t(),e(163,`);
    }

    `),n(164,"span",29),e(165,"public"),t(),e(166," "),n(167,"span",35)(168,"span",29),e(169,"function"),t(),e(170," "),n(171,"span",31),e(172,"index"),t(),e(173,"("),d(174,"span",36),e(175,`)
    `),t(),e(176,`{
        `),n(177,"span",29),e(178,"return"),t(),e(179," "),n(180,"span",40),e(181,"$this"),t(),e(182,"->"),n(183,"span",39),e(184,"respondWithTransformer"),t(),e(185,"(["),n(186,"span",34),e(187,"'hash'"),t(),e(188," => "),n(189,"span",38),e(190,"self"),t(),e(191,"::"),n(192,"span",33),e(193,"ANGULAR_APP_HASH"),t(),e(194,`]);
    }
}`),t()(),n(195,"p")(196,"strong")(197,"code"),e(198,"version.ts"),t()()(),n(199,"pre",41)(200,"code")(201,"span",29),e(202,"export"),t(),e(203," "),n(204,"span",29),e(205,"const"),t(),e(206," "),n(207,"span",33),e(208,"APP_VERSION"),t(),e(209,` = {
  `),n(210,"span",42),e(211,"version"),t(),e(212,": "),n(213,"span",34),e(214,"'0.0.0'"),t(),e(215,`,
  `),n(216,"span",42),e(217,"hash"),t(),e(218,": "),n(219,"span",34),e(220,"'b607b9112d'"),t(),e(221,`,
};`),t()(),n(222,"p"),e(223,"Currently we are moving our server-side to ASP.NET Core and we are generating this small file:"),t(),n(224,"p")(225,"strong")(226,"code"),e(227,"VersionResponseModel.cs"),t()()(),n(228,"pre",43)(229,"code")(230,"span",29),e(231,"namespace"),t(),e(232," "),n(233,"span",31),e(234,"BlogAngular.Application.Common.Version"),t(),e(235,`;
`),n(236,"span",29),e(237,"using"),t(),e(238,` Newtonsoft.Json;
`),n(239,"span",29),e(240,"public"),t(),e(241," "),n(242,"span",29),e(243,"class"),t(),e(244," "),n(245,"span",31),e(246,"VersionResponseModel"),t(),e(247,`
{
    `),n(248,"span",35)(249,"span",29),e(250,"public"),t(),e(251," "),n(252,"span",31),e(253,"VersionResponseModel"),t(),e(254,"()"),t(),e(255,`
    {
        Hash = `),n(256,"span",34),e(257,'"b607b9112d"'),t(),e(258,`;
    }

    [`),n(259,"span",28),e(260,"JsonProperty("),n(261,"span",34),e(262,'"hash"'),t(),e(263,")"),t(),e(264,`]
    `),n(265,"span",29),e(266,"public"),t(),e(267," "),n(268,"span",38),e(269,"string"),t(),e(270,"? Hash { "),n(271,"span",29),e(272,"get"),t(),e(273,"; } = "),n(274,"span",44),e(275,"default"),t(),e(276,`!;
}`),t()(),n(277,"p"),e(278,"In my "),n(279,"code"),e(280,"app.component.ts"),t(),e(281,", I have something like this:"),t(),n(282,"pre",41)(283,"code")(284,"span",28),e(285,"@Component"),t(),e(286,`({
  `),n(287,"span",42),e(288,"selector"),t(),e(289,": "),n(290,"span",34),e(291,"'app-root'"),t(),e(292,`,
  `),n(293,"span",42),e(294,"template"),t(),e(295,": "),n(296,"span",34),e(297,`\`
    <div class="page-wrapper">
      <app-header [windowWidth]="windowWidth" [isLoggedIn]="isLoggedIn" [username]="username"> </app-header>
      <ng-container *ngIf="notification">
        <nz-card>
          <div nz-row nzJustify="center">
            <div nz-col>
              <h5 nz-typography nzType="danger" [nzContent]="notification"></h5>
            </div>
          </div>
        </nz-card>
      </ng-container>
...
\``),t(),e(298,`
  `),n(299,"span",45),e(300,"ngOnInit"),t(),e(301,"(): "),n(302,"span",38),e(303,"void"),t(),e(304,` {
    `),n(305,"span",40),e(306,"this"),t(),e(307,"."),n(308,"span",46),e(309,"versionFacade"),t(),e(310,"."),n(311,"span",45),e(312,"getVersion"),t(),e(313,`();

    `),n(314,"span",40),e(315,"this"),t(),e(316,"."),n(317,"span",46),e(318,"versionFacade"),t(),e(319,"."),n(320,"span",46),e(321,"versionHash$"),t(),e(322,"."),n(323,"span",45),e(324,"pipe"),t(),e(325,"("),n(326,"span",45),e(327,"takeUntil"),t(),e(328,"("),n(329,"span",40),e(330,"this"),t(),e(331,"."),n(332,"span",46),e(333,"destroy$"),t(),e(334,"))."),n(335,"span",45),e(336,"subscribe"),t(),e(337,"("),n(338,"span",35),e(339,"("),n(340,"span",36)(341,"span",42),e(342,"hash"),t(),e(343,": "),n(344,"span",38),e(345,"string"),t()(),e(346,") =>"),t(),e(347,` {
      `),n(348,"span",29),e(349,"if"),t(),e(350," (hash && hash !== "),n(351,"span",33),e(352,"APP_VERSION"),t(),e(353,"."),n(354,"span",46),e(355,"hash"),t(),e(356,`) {
        `),n(357,"span",40),e(358,"this"),t(),e(359,"."),n(360,"span",46),e(361,"notification"),t(),e(362,` =
          `),n(363,"span",34),e(364,"'You are using an old version of this website and some pages may not work correctly. Please reload/refresh the page in order to load the latest version.'"),t(),e(365,`;
        `),n(366,"span",40),e(367,"this"),t(),e(368,"."),n(369,"span",46),e(370,"cdr"),t(),e(371,"."),n(372,"span",45),e(373,"markForCheck"),t(),e(374,`();
      }
    });
  }`),t()(),n(375,"p"),e(376,"I compile my frontend app with a command like this: "),n(377,"code"),e(378,"yarn build:site"),t(),e(379,". This simple solution helped me to solve my FireFox problem, however, the most logical solution is not to allow outdated web browsers to access this website."),t(),n(380,"h2",47)(381,"span"),e(382,"Case Scenario #2"),t(),n(383,"a",48),e(384,"#"),t()(),n(385,"p"),e(386,"This is the most common case scenario for modern (up to date) web browsers based on Google Chrome. It happens when you open this website from the browser bookmarks or when you browse this website while a new version was deployed to the server. You will get a message to reload/refresh the page with "),n(387,"strong"),e(388,"ERROR: SwUpdatesService: activated"),t(),e(389,". This website uses a Service Worker loaded from "),n(390,"code"),e(391,"ngsw-worker.js"),t(),e(392,". In addition, we use Angular "),n(393,"a",49),e(394,"SwUpdates"),t(),e(395," which will load updated resources of the website behind the scene on the user's machine. Theoretically, this website should work fine without reloading most of the time."),t(),n(396,"h2",50)(397,"span"),e(398,"Case Scenario #3"),t(),n(399,"a",51),e(400,"#"),t()(),n(401,"p"),e(402,"This case scenario happens when you open multiple tabs of this website while a new version was deployed to the server. You will get a message to reload/refresh the page with "),n(403,"strong"),e(404,"ERROR: GlobalErrorHandler"),t(),e(405,". It means that the browser tries to load old resources that were deleted by a new deployment."),t()()()()),l&2&&(m(),c("nzBordered",!0),m(6),c("nzOffsetTop",45),m(6),V("ngModel",r.enableNavigation),c("ngModelOptions",W(7,gi)),m(),c("nzOffsetTop",63)("nzAffix",!1)("nzShow",r.enableNavigation))},dependencies:[ee,X,$,xe,q,ce,ae,ie,ne,te,P,D,B,M,A,L,I,R,O,F,H,N,Q,J,le,re,de],encapsulation:2,changeDetection:0})}return a})();var _i=()=>({standalone:!0});function zi(a,s){if(a&1){let i=_();f(0),n(1,"a",108),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",109),d(3,"nz-icon",110),t()(),w()}}function bi(a,s){if(a&1){let i=_();f(0),n(1,"a",108),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",109),e(3,"Alexei Cioina's blog"),t()(),w()}}var Vn=(()=>{class a{router=x(Z);#e=x(G);viewPort=x(Y);zone=x(se);mermaidImport=x(pe,{optional:!0});mermaid;isMermaid=!0;enableNavigation=this.#e.selectors.isSwitcher();constructor(){this.isMermaid&&this.mermaidImport&&this.loadMermaid(this.mermaidImport)}ngAfterViewChecked(){this.isMermaid&&this.mermaid&&(this.isMermaid=!1,this.zone.runOutsideAngular(()=>this.mermaid?.default.run()))}loadMermaid(i){this.zone.runOutsideAngular(()=>oe(i).pipe(me()).subscribe(l=>{this.mermaid=l,this.mermaid.default.initialize({startOnLoad:!1}),this.mermaid?.default.run()}))}clickLink(){this.#e.selectors.isAdminArticles()?this.router.navigate(["admin","articles"]):this.router.navigate(["articles"])}disableEnable(){this.#e.setSwitcher(this.enableNavigation)}goLink(i){window&&(window.location.hash=i)}scrollTop(){window&&(window.location.hash=""),this.viewPort.scrollToPosition([0,0])}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-blog-svg-icons"]],decls:924,vars:8,consts:[[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","start"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],[1,"toc-affix",3,"nzOffsetTop"],["nz-row","","nzJustify","end"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzSize","small",3,"ngModelChange","ngModel","ngModelOptions"],["nzShowInkInFixed","",3,"nzClick","nzOffsetTop","nzAffix","nzShow"],["nzHref","#h-175576ef","nzTitle","List of icons"],["nzHref","#h-db974238","nzTitle","API"],["nzHref","#h-cf0c0858","nzTitle","[nz-icon]"],["nzHref","#h-1a353508","nzTitle","NzIconService"],["nzHref","#h-ed485f46","nzTitle","SVG icons"],["nzHref","#h-ec99ccb9","nzTitle","Static loading and dynamic loading"],["nzHref","#h-10028ae6","nzTitle","Add Icons in Lazy-loaded Modules"],["nzHref","#h-93e3a3a1","nzTitle","Set Default TwoTone Color"],["nzHref","#h-3ce4aec9","nzTitle","Custom Font Icon"],["nzHref","#h-b3ba0fe9","nzTitle","Namespace"],["nzHref","#h-1fe917b0","nzTitle","FAQ"],["nzHref","#h-8e1d7328","nzTitle","All my icons are gone"],["nzHref","#h-a81dd5f2","nzTitle","There are two similar icons in a "],["nzHref","#h-62a9076a","nzTitle","I want to import all icons statically. What should I do?"],["nzHref","#h-5de90099","nzTitle","Does dynamic loading affect web pages' performance?"],["nzHref","#h-b7b1fb21","nzTitle","How do I know a icon's corresponding module to import?"],[1,"markdown-title"],[1,"subtitle"],[1,"widget"],["aria-label","Edit this page on Github","href","https://github.com/cioina/cioina.azurewebsites.net/edit/main/blog/20230219-svg-icons.md","target","_blank","rel","noopener noreferrer",1,"edit-button"],["nzType","edit"],[1,"markdown"],[2,"border-color","#faad14"],["href","https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/components/icon/doc/index.en-US.md","target","_blank","rel","noopener"],["href","https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/LICENSE","target","_blank","rel","noopener"],[1,"pic-plus",2,"text-align","center"],["nzType","custom:zorro","nzWidth","180px","nzHeight","180px"],["nzType","custom:angular","nzWidth","180px","nzHeight","180px"],["nzType","custom:ng-zorro","nzWidth","180px","nzHeight","180px"],["id","h-5504977c"],["onclick","window.location.hash = 'h-5504977c'",1,"anchor"],[1,"mermaid"],["id","h-5f3a8aa0"],["onclick","window.location.hash = 'h-5f3a8aa0'",1,"anchor"],["id","h-ed81be50"],["onclick","window.location.hash = 'h-ed81be50'",1,"anchor"],["id","h-d67b37b2"],["onclick","window.location.hash = 'h-d67b37b2'",1,"anchor"],["id","h-f3b60b4e"],["onclick","window.location.hash = 'h-f3b60b4e'",1,"anchor"],["id","h-175576ef"],["onclick","window.location.hash = 'h-175576ef'",1,"anchor"],["href","https://ant.design/components/icon/","target","_blank","rel","noopener"],[1,"language-ts"],[1,"hljs-keyword"],[1,"hljs-title","class_"],[1,"hljs-string"],["id","h-db974238"],["onclick","window.location.hash = 'h-db974238'",1,"anchor"],["id","h-cf0c0858"],[1,"api-type-label","directive"],["onclick","window.location.hash = 'h-cf0c0858'",1,"anchor"],["href","https://github.com/twbs/icons","target","_blank","rel","noopener"],["href","https://icons.getbootstrap.com/","target","_blank","rel","noopener"],["href","https://github.com/ant-design/ant-design-icons/tree/master/packages/icons-svg","target","_blank","rel","noopener"],["id","h-1a353508"],[1,"api-type-label","service"],["onclick","window.location.hash = 'h-1a353508'",1,"anchor"],["id","h-ed485f46"],["onclick","window.location.hash = 'h-ed485f46'",1,"anchor"],["href","https://github.com/ant-design/ant-design/issues/10353","target","_blank","rel","noopener"],[1,"language-html"],[1,"hljs-tag"],[1,"hljs-name"],[1,"hljs-attr"],["id","h-ec99ccb9"],["onclick","window.location.hash = 'h-ec99ccb9'",1,"anchor"],[1,"hljs-comment"],[1,"hljs-meta"],[1,"hljs-title","function_"],["href","https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/components/icon/icons.ts","target","_blank","rel","noopener"],[1,"language-json"],[1,"hljs-punctuation"],["id","h-10028ae6"],["onclick","window.location.hash = 'h-10028ae6'",1,"anchor"],["id","h-93e3a3a1"],["onclick","window.location.hash = 'h-93e3a3a1'",1,"anchor"],["id","h-3ce4aec9"],["onclick","window.location.hash = 'h-3ce4aec9'",1,"anchor"],["href","http://iconfont.cn/","target","_blank","rel","noopener"],[1,"hljs-variable","language_"],[1,"hljs-property"],["href","http://iconfont.cn/help/detail?spm=a313x.7781069.1998910419.15&helptype=code","target","_blank","rel","noopener"],["id","h-b3ba0fe9"],["onclick","window.location.hash = 'h-b3ba0fe9'",1,"anchor"],["id","h-1fe917b0"],["onclick","window.location.hash = 'h-1fe917b0'",1,"anchor"],["id","h-8e1d7328"],["onclick","window.location.hash = 'h-8e1d7328'",1,"anchor"],["id","h-0dfac33e"],["onclick","window.location.hash = 'h-0dfac33e'",1,"anchor"],["id","h-62a9076a"],["onclick","window.location.hash = 'h-62a9076a'",1,"anchor"],["id","h-5de90099"],["onclick","window.location.hash = 'h-5de90099'",1,"anchor"],["id","h-b7b1fb21"],["onclick","window.location.hash = 'h-b7b1fb21'",1,"anchor"],[3,"click"],["nz-typography","","nzType","success"],["nzType","arrow-left"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"nz-card",1)(2,"div",2)(3,"div",3)(4,"nz-space",4),g(5,zi,4,0,"ng-container",5)(6,bi,4,0,"ng-container",5),t()()(),n(7,"nz-affix",6)(8,"div",7)(9,"div",3)(10,"a",8),h("click",function(){return r.scrollTop()}),e(11,"Jump to top"),t()(),n(12,"div",3)(13,"nz-switch",9),j("ngModelChange",function(S){return U(r.enableNavigation,S)||(r.enableNavigation=S),S}),h("ngModelChange",function(){return r.disableEnable()}),t()()(),n(14,"nz-anchor",10),h("nzClick",function(S){return r.goLink(S)}),d(15,"nz-link",11)(16,"nz-link",12)(17,"nz-link",13)(18,"nz-link",14)(19,"nz-link",15)(20,"nz-link",16)(21,"nz-link",17)(22,"nz-link",18)(23,"nz-link",19)(24,"nz-link",20)(25,"nz-link",21)(26,"nz-link",22)(27,"nz-link",23)(28,"nz-link",24)(29,"nz-link",25)(30,"nz-link",26),t()(),n(31,"span",27),e(32," Semantic Vector Graphics (SVG) Icons"),d(33,"span",28)(34,"span",29),n(35,"a",30),d(36,"nz-icon",31),t()(),n(37,"article",32)(38,"blockquote",33)(39,"p")(40,"strong"),e(41,"This is a modified version of the "),n(42,"a",34),e(43,"NG-ZORRO original"),t(),e(44," document provided under "),n(45,"a",35),e(46,"Alibaba.com MIT LICENSE"),t(),e(47,"."),t()()(),n(48,"div",36),d(49,"nz-icon",37),n(50,"span"),e(51,"+"),t(),d(52,"nz-icon",38),n(53,"span"),e(54,"="),t(),d(55,"nz-icon",39),t(),n(56,"h4",40)(57,"span"),e(58,"Example 1"),t(),n(59,"a",41),e(60,"#"),t()(),n(61,"pre",42),e(62,`block-beta
columns 1
  db(("DB"))
  blockArrowId6<["\xA0\xA0\xA0"]>(down)
  block:ID
    A
    B["A wide one in the middle"]
    C
  end
  space
  D
  ID --> D
  C --> D
  style B fill:#969,stroke:#333,stroke-width:4px`),t(),n(63,"h4",43)(64,"span"),e(65,"Example 2"),t(),n(66,"a",44),e(67,"#"),t()(),n(68,"pre",42),e(69,`block-beta
  columns 3
  a:3
  block:group1:2
    columns 2
    h i j k
  end
  g
  block:group2:3
    %% columns auto (default)
    l m n o p q r
  end  `),t(),n(70,"h4",45)(71,"span"),e(72,"Example 3"),t(),n(73,"a",46),e(74,"#"),t()(),n(75,"pre",42),e(76,`block-beta
  id1[/"This is the text in the box"/]
  id2["This is the text in the box"]
  A[/"Christmas"]
  B["Go shopping"/]`),t(),n(77,"h4",47)(78,"span"),e(79,"Example 4"),t(),n(80,"a",48),e(81,"#"),t()(),n(82,"pre",42),e(83,`block-beta
  blockArrowId<["Label"]>(right)
  blockArrowId2<["Label"]>(left)
  blockArrowId3<["Label"]>(up)
  blockArrowId4<["Label"]>(down)
  blockArrowId5<["Label"]>(x)
  blockArrowId6<["Label"]>(y)
  blockArrowId6<["Label"]>(x, down)`),t(),n(84,"h4",49)(85,"span"),e(86,"Example 5"),t(),n(87,"a",50),e(88,"#"),t()(),n(89,"pre",42),e(90,`block-beta
  columns 3
  Start(("Start")) space:2
  down<[" "]>(down) space:2
  Decision("Make Decision") right<["Yes"]>(right) Process1["Process A"]
  downAgain<["No"]>(down) space r3<["Done"]>(down)
  Process2["Process B"] r2<["Done"]>(right) End(("End"))

  style Start fill:#969;
  style End fill:#696;`),t(),n(91,"h2",51)(92,"span"),e(93,"List of icons"),t(),n(94,"a",52),e(95,"#"),t()(),n(96,"p"),e(97,"We are still adding icons right now, syncing to "),n(98,"a",53),e(99,"antd"),t(),e(100,"."),t(),n(101,"pre",54)(102,"code")(103,"span",55),e(104,"import"),t(),e(105," { "),n(106,"span",56),e(107,"NzIconModule"),t(),e(108," } "),n(109,"span",55),e(110,"from"),t(),e(111," "),n(112,"span",57),e(113,"'ng-zorro-antd/icon'"),t(),e(114,";"),t()(),n(115,"h2",58)(116,"span"),e(117,"API"),t(),n(118,"a",59),e(119,"#"),t()(),n(120,"h3",60)(121,"span"),e(122,"[nz-icon]"),t(),n(123,"label",61),e(124,"directive"),t(),n(125,"a",62),e(126,"#"),t()(),n(127,"table")(128,"thead")(129,"tr")(130,"th"),e(131,"Property"),t(),n(132,"th"),e(133,"Description"),t(),n(134,"th"),e(135,"Type"),t(),n(136,"th"),e(137,"Default"),t(),n(138,"th"),e(139,"Global Config"),t()()(),n(140,"tbody")(141,"tr")(142,"td")(143,"code"),e(144,"[nzType]"),t()(),n(145,"td"),e(146,"Type of the ant design icon"),t(),n(147,"td")(148,"code"),e(149,"string"),t()(),n(150,"td"),e(151,"-"),t(),d(152,"td"),t(),n(153,"tr")(154,"td")(155,"code"),e(156,"[nzTheme]"),t()(),n(157,"td"),e(158,"Type of the ant design icon"),t(),n(159,"td")(160,"code"),e(161,"'fill'|'outline'|'twotone'|'feather'"),t()(),n(162,"td")(163,"code"),e(164,"'outline'"),t()(),n(165,"td"),e(166,"\u2705"),t()(),n(167,"tr")(168,"td")(169,"code"),e(170,"[nzSpin]"),t()(),n(171,"td"),e(172,"Rotate icon with animation"),t(),n(173,"td")(174,"code"),e(175,"boolean"),t()(),n(176,"td")(177,"code"),e(178,"false"),t()(),d(179,"td"),t(),n(180,"tr")(181,"td")(182,"code"),e(183,"[nzTwotoneColor]"),t()(),n(184,"td"),e(185,"Only support the two-tone icon. Specific the primary color."),t(),n(186,"td")(187,"code"),e(188,"string (hex color)"),t()(),n(189,"td"),e(190,"-"),t(),n(191,"td"),e(192,"\u2705"),t()(),n(193,"tr")(194,"td")(195,"code"),e(196,"[nzIconfont]"),t()(),n(197,"td"),e(198,"Type of the icon from iconfont"),t(),n(199,"td")(200,"code"),e(201,"string"),t()(),n(202,"td"),e(203,"-"),t(),d(204,"td"),t(),n(205,"tr")(206,"td")(207,"code"),e(208,"[nzRotate]"),t()(),n(209,"td"),e(210,"Rotate degrees"),t(),n(211,"td")(212,"code"),e(213,"number"),t()(),n(214,"td"),e(215,"-"),t(),d(216,"td"),t(),n(217,"tr")(218,"td")(219,"code"),e(220,"[nzWidth]"),t()(),n(221,"td"),e(222,"SVG width"),t(),n(223,"td")(224,"code"),e(225,"number|string"),t()(),n(226,"td")(227,"code"),e(228,"1em"),t()(),d(229,"td"),t(),n(230,"tr")(231,"td")(232,"code"),e(233,"[nzHeight]"),t()(),n(234,"td"),e(235,"SVG height"),t(),n(236,"td")(237,"code"),e(238,"number|string"),t()(),n(239,"td")(240,"code"),e(241,"1em"),t()(),d(242,"td"),t()()(),n(243,"blockquote")(244,"p"),e(245,"In "),n(246,"code"),e(247,"feather"),t(),e(248," folder, there are all "),n(249,"a",63),e(250,"official open source SVG icons for Bootstrap"),t(),e(251," that can be viewed "),n(252,"a",64),e(253,"here"),t(),e(254,". In "),n(255,"code"),e(256,"fill"),t(),e(257,","),n(258,"code"),e(259,"outline"),t(),e(260," and "),n(261,"code"),e(262,"twotone"),t(),e(263," folders, there are all "),n(264,"a",65),e(265,"Ant Design SVG icons"),t(),e(266," that can be viewed "),n(267,"a",53),e(268,"here"),t(),e(269,". In "),n(270,"code"),e(271,"custom"),t(),e(272," folder, there are a few SVG icons added by hand witch can be accessed by "),n(273,"code"),e(274,'nzType="custom:some-icon-file-name"'),t(),e(275,"."),t()(),n(276,"h3",66)(277,"span"),e(278,"NzIconService"),t(),n(279,"label",67),e(280,"service"),t(),n(281,"a",68),e(282,"#"),t()(),n(283,"table")(284,"thead")(285,"tr")(286,"th"),e(287,"Methods/Properties"),t(),n(288,"th"),e(289,"Description"),t(),n(290,"th"),e(291,"Parameters"),t()()(),n(292,"tbody")(293,"tr")(294,"td")(295,"code"),e(296,"useJsonpLoading()"),t()(),n(297,"td"),e(298,"Call this method to switch to jsonp like loading"),t(),d(299,"td"),t(),n(300,"tr")(301,"td")(302,"code"),e(303,"addIcon()"),t()(),n(304,"td"),e(305,"To import icons statically"),t(),n(306,"td")(307,"code"),e(308,"IconDefinition"),t()()(),n(309,"tr")(310,"td")(311,"code"),e(312,"addIconLiteral()"),t()(),n(313,"td"),e(314,"To statically import custom icons"),t(),n(315,"td")(316,"code"),e(317,"string"),t(),e(318,", "),n(319,"code"),e(320,"string (SVG)"),t()()(),n(321,"tr")(322,"td")(323,"code"),e(324,"fetchFromIconfont()"),t()(),n(325,"td"),e(326,"To get icon assets from fonticon"),t(),n(327,"td")(328,"code"),e(329,"NzIconfontOption"),t()()(),n(330,"tr")(331,"td")(332,"code"),e(333,"changeAssetsSource()"),t()(),n(334,"td"),e(335,"To change the location of your icon assets, so that you can deploy these icons wherever you want"),t(),n(336,"td")(337,"code"),e(338,"string"),t()()()()(),n(339,"h3",69)(340,"span"),e(341,"SVG icons"),t(),n(342,"a",70),e(343,"#"),t()(),n(344,"p"),e(345,"We synced to Ant Design and replaced font icons with svg icons which bring benefits below:"),t(),n(346,"ul")(347,"li"),e(348,"Complete offline usage of icon, no dependency of alipay cdn font icon file and no more empty square during downloading."),t(),n(349,"li"),e(350,"Much more display accuracy in lower-level screens."),t(),n(351,"li"),e(352,"Support multiple colors for icon."),t(),n(353,"li"),e(354,"No need to change built-in icons with overriding styles by providing more props in component."),t()(),n(355,"p"),e(356,"You can join in "),n(357,"a",71),e(358,"this dicussion of Ant Design"),t(),e(359,"."),t(),n(360,"p"),e(361,"NG-ZORRO hadn't provided an icon component. Instead, icon based on font files was provided. We make this new directive compatible to old API. If you make no changes to your existing code, old icons would be dynamically loaded as "),n(362,"code"),e(363,"outline"),t(),e(364," icons. But the best pratice is always to use "),n(365,"code"),e(366,"nz-icon"),t(),e(367," directive and specify the "),n(368,"code"),e(369,"theme"),t(),e(370," prop."),t(),n(371,"pre",72)(372,"code")(373,"span",73),e(374,"<"),n(375,"span",74),e(376,"span"),t(),e(377," "),n(378,"span",75),e(379,"nz-icon"),t(),e(380," ["),n(381,"span",75),e(382,"nzType"),t(),e(383,"]="),n(384,"span",57),e(385,`"'star'"`),t(),e(386," ["),n(387,"span",75),e(388,"nzTheme"),t(),e(389,"]="),n(390,"span",57),e(391,`"'fill'"`),t(),e(392,">"),t(),n(393,"span",73),e(394,"</"),n(395,"span",74),e(396,"span"),t(),e(397,">"),t()()(),n(398,"p"),e(399,"All the icons will be rendered to "),n(400,"code"),e(401,"<svg>"),t(),e(402,", and styles and classes applied to "),n(403,"code"),e(404,"<i>"),t(),e(405," would work."),t(),n(406,"pre",72)(407,"code")(408,"span",73),e(409,"<"),n(410,"span",74),e(411,"span"),t(),e(412," "),n(413,"span",75),e(414,"nz-icon"),t(),e(415," ["),n(416,"span",75),e(417,"nzType"),t(),e(418,"]="),n(419,"span",57),e(420,`"'message'"`),t(),e(421," "),n(422,"span",75),e(423,"style"),t(),e(424,"="),n(425,"span",57),e(426,'"font-size: 16px; color: #08c;"'),t(),e(427,">"),t(),n(428,"span",73),e(429,"</"),n(430,"span",74),e(431,"span"),t(),e(432,">"),t()()(),n(433,"h3",76)(434,"span"),e(435,"Static loading and dynamic loading"),t(),n(436,"a",77),e(437,"#"),t()(),n(438,"p"),e(439,"As for icons provided by Ant Design, there are two ways of importing them into your project."),t(),n(440,"p"),e(441,"Static loading. By registering icons to "),n(442,"code"),e(443,"AppModule"),t(),e(444," you load icons statically."),t(),n(445,"pre",54)(446,"code")(447,"span",55),e(448,"import"),t(),e(449," { "),n(450,"span",56),e(451,"IconDefinition"),t(),e(452," } "),n(453,"span",55),e(454,"from"),t(),e(455," "),n(456,"span",57),e(457,"'@ant-design/icons-angular'"),t(),e(458,`;
`),n(459,"span",55),e(460,"import"),t(),e(461," { "),n(462,"span",56),e(463,"NzIconModule"),t(),e(464," } "),n(465,"span",55),e(466,"from"),t(),e(467," "),n(468,"span",57),e(469,"'ng-zorro-antd/icon'"),t(),e(470,`;

`),n(471,"span",78),e(472,"// Import what you need. RECOMMENDED. \u2714\uFE0F"),t(),e(473,`
`),n(474,"span",55),e(475,"import"),t(),e(476," { "),n(477,"span",56),e(478,"AccountBookFill"),t(),e(479,", "),n(480,"span",56),e(481,"AlertFill"),t(),e(482,", "),n(483,"span",56),e(484,"AlertOutline"),t(),e(485," } "),n(486,"span",55),e(487,"from"),t(),e(488," "),n(489,"span",57),e(490,"'@ant-design/icons-angular/icons'"),t(),e(491,`;

`),n(492,"span",55),e(493,"const"),t(),e(494," "),n(495,"span",75),e(496,"icons"),t(),e(497,": "),n(498,"span",56),e(499,"IconDefinition"),t(),e(500,"[] = [ "),n(501,"span",56),e(502,"AccountBookFill"),t(),e(503,", "),n(504,"span",56),e(505,"AlertOutline"),t(),e(506,", "),n(507,"span",56),e(508,"AlertFill"),t(),e(509,` ];

`),n(510,"span",78),e(511,"// Import all. NOT RECOMMENDED. \u274C"),t(),e(512,`
`),n(513,"span",78),e(514,"// import * as AllIcons from '@ant-design/icons-angular/icons';"),t(),e(515,`

`),n(516,"span",78),e(517,"// const antDesignIcons = AllIcons as {"),t(),e(518,`
`),n(519,"span",78),e(520,"//   [key: string]: IconDefinition;"),t(),e(521,`
`),n(522,"span",78),e(523,"// };"),t(),e(524,`
`),n(525,"span",78),e(526,"// const icons: IconDefinition[] = Object.keys(antDesignIcons).map(key => antDesignIcons[key])"),t(),e(527,`

`),n(528,"span",79),e(529,"@NgModule"),t(),e(530,`({
  `),n(531,"span",75),e(532,"declarations"),t(),e(533,`: [
    `),n(534,"span",56),e(535,"AppComponent"),t(),e(536,`
  ],
  `),n(537,"span",75),e(538,"imports"),t(),e(539,`: [
    `),n(540,"span",56),e(541,"NzIconModule"),t(),e(542,"."),n(543,"span",80),e(544,"forRoot"),t(),e(545,`(icons),
  ]
  `),n(546,"span",75),e(547,"bootstrap"),t(),e(548,": [ "),n(549,"span",56),e(550,"AppComponent"),t(),e(551,` ]
})
`),n(552,"span",55),e(553,"export"),t(),e(554," "),n(555,"span",55),e(556,"class"),t(),e(557," "),n(558,"span",56),e(559,"AppModule"),t(),e(560,` {
}`),t()(),n(561,"p"),e(562,"Actually this calls "),n(563,"code"),e(564,"addIcon"),t(),e(565," of "),n(566,"code"),e(567,"NzIconService"),t(),e(568,". Icons imported would be bundled into your "),n(569,"code"),e(570,".js"),t(),e(571," files. Static loading would increase your bundle's size so we recommend use dynamic importing as much as you can."),t(),n(572,"blockquote")(573,"p"),e(574,"Icons used by NG-ZORRO itself "),n(575,"a",81),e(576,"(NZ_ICONS_USED_BY_ZORRO)"),t(),e(577," are imported statically to increase loading speed. However, icons demonstrated on the official website are loaded dynamically."),t()(),n(578,"p"),e(579,"Dynamic importing. This way would not increase your bundle's size. When NG-ZORRO detects that the icon you want to render hasn't been registered, it would fire a HTTP request to load it. All you have to do is to config your "),n(580,"code"),e(581,"angular.json"),t(),e(582," like this:"),t(),n(583,"pre",82)(584,"code")(585,"span",83),e(586,"{"),t(),e(587,`
  `),n(588,"span",75),e(589,'"assets"'),t(),n(590,"span",83),e(591,":"),t(),e(592," "),n(593,"span",83),e(594,"["),t(),e(595,`
    `),n(596,"span",83),e(597,"{"),t(),e(598,`
      `),n(599,"span",75),e(600,'"glob"'),t(),n(601,"span",83),e(602,":"),t(),e(603," "),n(604,"span",57),e(605,'"**/*"'),t(),n(606,"span",83),e(607,","),t(),e(608,`
      `),n(609,"span",75),e(610,'"input"'),t(),n(611,"span",83),e(612,":"),t(),e(613," "),n(614,"span",57),e(615,'"./node_modules/@ant-design/icons-angular/src/inline-svg/"'),t(),n(616,"span",83),e(617,","),t(),e(618,`
      `),n(619,"span",75),e(620,'"output"'),t(),n(621,"span",83),e(622,":"),t(),e(623," "),n(624,"span",57),e(625,'"/assets/"'),t(),e(626,`
    `),n(627,"span",83),e(628,"}"),t(),e(629,`
  `),n(630,"span",83),e(631,"]"),t(),e(632,`
`),n(633,"span",83),e(634,"}"),t()()(),n(635,"p"),e(636,"You can call "),n(637,"code"),e(638,"changeAssetsSource()"),t(),e(639," of "),n(640,"code"),e(641,"NzIconService"),t(),e(642," to change the location of your icon assets, so that you can deploy these icon assets to cdn. The parameter you passed would be add in front of "),n(643,"code"),e(644,"assets/"),t(),e(645,"."),t(),n(646,"p"),e(647,"Let's assume that you deploy static assets under "),n(648,"code"),e(649,"https://mycdn.somecdn.com/icons/assets"),t(),e(650,". You can call "),n(651,"code"),e(652,"changeAssetsSource('https://mycdn.somecdn.com/icons')"),t(),e(653," to tell NG-ZORRO that all your resources are located there."),t(),n(654,"p"),e(655,"Please call this in component's constructor or "),n(656,"code"),e(657,"AppInitService"),t(),e(658,"."),t(),n(659,"h3",84)(660,"span"),e(661,"Add Icons in Lazy-loaded Modules"),t(),n(662,"a",85),e(663,"#"),t()(),n(664,"p"),e(665,"Sometimes, you want to import icons in lazy modules to avoid increasing the size of the main.js. You can use "),n(666,"code"),e(667,"NzIconModule.forChild"),t(),e(668,"."),t(),n(669,"pre",54)(670,"code")(671,"span",79),e(672,"@NgModule"),t(),e(673,`({
  `),n(674,"span",75),e(675,"imports"),t(),e(676,": ["),n(677,"span",56),e(678,"CommonModule"),t(),e(679,", "),n(680,"span",56),e(681,"NzIconModule"),t(),e(682,"."),n(683,"span",80),e(684,"forChild"),t(),e(685,"(["),n(686,"span",56),e(687,"QuestionOutline"),t(),e(688,`])],
})
`),n(689,"span",55),e(690,"class"),t(),e(691," "),n(692,"span",56),e(693,"ChildModule"),t(),e(694," {}"),t()(),n(695,"p"),e(696,"When "),n(697,"code"),e(698,"ChildModule"),t(),e(699," get loaded, the icon QuestionOutline would be usable across the application."),t(),n(700,"h3",86)(701,"span"),e(702,"Set Default TwoTone Color"),t(),n(703,"a",87),e(704,"#"),t()(),n(705,"p"),e(706,"When using the two-tone icons, you provide a global configuration like "),n(707,"code"),e(708,"{ nzIcon: { nzTwotoneColor: 'xxx' } }"),t(),e(709," via "),n(710,"code"),e(711,"NzConfigService"),t(),e(712," or call corresponding "),n(713,"code"),e(714,"set"),t(),e(715," method to change two default twotone color."),t(),n(716,"h3",88)(717,"span"),e(718,"Custom Font Icon"),t(),n(719,"a",89),e(720,"#"),t()(),n(721,"p"),e(722,"We added a "),n(723,"code"),e(724,"fetchFromIconfont"),t(),e(725," method function to help developer using their own icons deployed at "),n(726,"a",90),e(727,"iconfont.cn"),t(),e(728," in a convenient way."),t(),n(729,"blockquote")(730,"p"),e(731,"This method is specified for iconfont.cn."),t()(),n(732,"pre",54)(733,"code")(734,"span",91),e(735,"this"),t(),e(736,"."),n(737,"span",92),e(738,"_iconService"),t(),e(739,"."),n(740,"span",80),e(741,"fetchFromIconfont"),t(),e(742,`({
  `),n(743,"span",75),e(744,"scriptUrl"),t(),e(745,": "),n(746,"span",57),e(747,"'https://at.alicdn.com/t/font_8d5l8fzk5b87iudi.js'"),t(),e(748,`,
});`),t()(),n(749,"pre",72)(750,"code")(751,"span",73),e(752,"<"),n(753,"span",74),e(754,"span"),t(),e(755," "),n(756,"span",75),e(757,"nz-icon"),t(),e(758," ["),n(759,"span",75),e(760,"nzIconfont"),t(),e(761,"]="),n(762,"span",57),e(763,`"'icon-tuichu'"`),t(),e(764,">"),t(),n(765,"span",73),e(766,"</"),n(767,"span",74),e(768,"span"),t(),e(769,">"),t()()(),n(770,"p"),e(771,"It create a component that uses SVG sprites in essence."),t(),n(772,"p"),e(773,"The following option are available:"),t(),n(774,"table")(775,"thead")(776,"tr")(777,"th"),e(778,"Property"),t(),n(779,"th"),e(780,"Description"),t(),n(781,"th"),e(782,"Type"),t(),n(783,"th"),e(784,"Default"),t()()(),n(785,"tbody")(786,"tr")(787,"td")(788,"code"),e(789,"scriptUrl"),t()(),n(790,"td"),e(791,"The URL generated by iconfont.cn project."),t(),n(792,"td")(793,"code"),e(794,"string"),t()(),n(795,"td"),e(796,"-"),t()()()(),n(797,"p"),e(798,"The property scriptUrl should be set to import the svg sprite symbols."),t(),n(799,"p"),e(800,"See "),n(801,"a",93),e(802,"iconfont.cn"),t(),e(803," documents to learn about how to generate scriptUrl."),t(),n(804,"h3",94)(805,"span"),e(806,"Namespace"),t(),n(807,"a",95),e(808,"#"),t()(),n(809,"p"),e(810,"We introduced namespace so you could add your own icons in a convenient way. When you wan to render an icon, you could assign "),n(811,"code"),e(812,"type"),t(),n(813,"code"),e(814,"namespace:name"),t(),e(815,". Dynamic importing and static importing are both supported."),t(),n(816,"p"),e(817,"Static importing. Invoke "),n(818,"code"),e(819,"addIconLiteral"),t(),e(820," of "),n(821,"code"),e(822,"NzIconService"),t(),e(823,"."),t(),n(824,"p"),e(825,"Dynamic importing. Make sure that you have put your SVG resources in dir like "),n(826,"code"),e(827,"assets/${namespace}"),t(),e(828,". For example, if you have a "),n(829,"code"),e(830,"panda"),t(),e(831," icon and in "),n(832,"code"),e(833,"zoo"),t(),e(834," namespace, you should put "),n(835,"code"),e(836,"panda.svg"),t(),e(837," in "),n(838,"code"),e(839,"assets/zoo"),t(),e(840,"."),t(),n(841,"h2",96)(842,"span"),e(843,"FAQ"),t(),n(844,"a",97),e(845,"#"),t()(),n(846,"h3",98)(847,"span"),e(848,"All my icons are gone"),t(),n(849,"a",99),e(850,"#"),t()(),n(851,"p"),e(852,"Have you read the docs above?"),t(),n(853,"h3",100)(854,"span"),e(855,"There are two similar icons in a "),n(856,"code"),e(857,"<span></span>"),t(),e(858," tag. What happened?"),t(),n(859,"a",101),e(860,"#"),t()(),n(861,"p"),e(862,"In older versions of NG-ZORRO, there was a font file which would use "),n(863,"code"),e(864,":before"),t(),e(865," to insert a icon according to a "),n(866,"code"),e(867,"i"),t(),e(868," tag's "),n(869,"code"),e(870,"className"),t(),e(871,". So if you have two icons, try to remove "),n(872,"code"),e(873,"node_modules"),t(),e(874," and reinstall. If the problem is still there, search "),n(875,"code"),e(876,"@icon-url"),t(),e(877," and remove that line."),t(),n(878,"h3",102)(879,"span"),e(880,"I want to import all icons statically. What should I do?"),t(),n(881,"a",103),e(882,"#"),t()(),n(883,"p"),e(884,"Actually we demonstrate it here:"),t(),n(885,"pre",54)(886,"code")(887,"span",78),e(888,"// import * as AllIcons from '@ant-design/icons-angular/icons';"),t(),e(889,`

`),n(890,"span",78),e(891,"// const antDesignIcons = AllIcons as {"),t(),e(892,`
`),n(893,"span",78),e(894,"//   [key: string]: IconDefinition;"),t(),e(895,`
`),n(896,"span",78),e(897,"// };"),t(),e(898,`
`),n(899,"span",78),e(900,"// const icons: IconDefinition[] = Object.keys(antDesignIcons).map(key => antDesignIcons[key])"),t()()(),n(901,"h3",104)(902,"span"),e(903,"Does dynamic loading affect web pages' performance?"),t(),n(904,"a",105),e(905,"#"),t()(),n(906,"p"),e(907,"We used several methods to reduce requests, like static cache, dynamic cache and reusable request. It's basically not noticeable for visitors that icons are loaded asynchronously assuming web connections are fairly good."),t(),n(908,"h3",106)(909,"span"),e(910,"How do I know a icon's corresponding module to import?"),t(),n(911,"a",107),e(912,"#"),t()(),n(913,"p"),e(914,"Capital camel-case "),n(915,"code"),e(916,"type & theme"),t(),e(917,", i.e. "),n(918,"code"),e(919,"alibaba"),t(),e(920," => "),n(921,"code"),e(922,"AlibabaOutline"),t(),e(923,"."),t()()()()),l&2&&(m(),c("nzBordered",!0),m(6),c("nzOffsetTop",45),m(6),V("ngModel",r.enableNavigation),c("ngModelOptions",W(7,_i)),m(),c("nzOffsetTop",63)("nzAffix",!1)("nzShow",r.enableNavigation))},dependencies:[ee,X,$,xe,q,ce,ae,ie,ne,te,P,D,B,M,A,L,I,R,O,F,H,N,Q,J,le,re,de],encapsulation:2,changeDetection:0})}return a})();var yi=()=>({standalone:!0});function Ci(a,s){if(a&1){let i=_();f(0),n(1,"a",85),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",86),d(3,"nz-icon",87),t()(),w()}}function Ti(a,s){if(a&1){let i=_();f(0),n(1,"a",85),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",86),e(3,"Alexei Cioina's blog"),t()(),w()}}var Un=(()=>{class a{router=x(Z);#e=x(G);viewPort=x(Y);zone=x(se);mermaidImport=x(pe,{optional:!0});mermaid;isMermaid=!1;enableNavigation=this.#e.selectors.isSwitcher();constructor(){this.isMermaid&&this.mermaidImport&&this.loadMermaid(this.mermaidImport)}ngAfterViewChecked(){this.isMermaid&&this.mermaid&&(this.isMermaid=!1,this.zone.runOutsideAngular(()=>this.mermaid?.default.run()))}loadMermaid(i){this.zone.runOutsideAngular(()=>oe(i).pipe(me()).subscribe(l=>{this.mermaid=l,this.mermaid.default.initialize({startOnLoad:!1}),this.mermaid?.default.run()}))}clickLink(){this.#e.selectors.isAdminArticles()?this.router.navigate(["admin","articles"]):this.router.navigate(["articles"])}disableEnable(){this.#e.setSwitcher(this.enableNavigation)}goLink(i){window&&(window.location.hash=i)}scrollTop(){window&&(window.location.hash=""),this.viewPort.scrollToPosition([0,0])}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-blog-dotnet-core-testing"]],decls:2892,vars:8,consts:[[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","start"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],[1,"toc-affix",3,"nzOffsetTop"],["nz-row","","nzJustify","end"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzSize","small",3,"ngModelChange","ngModel","ngModelOptions"],["nzShowInkInFixed","",3,"nzClick","nzOffsetTop","nzAffix","nzShow"],["nzHref","#h-0b79795d","nzTitle","Introduction"],["nzHref","#h-5a486561","nzTitle","MyTested Library Out of The Box"],["nzHref","#h-24135ede","nzTitle",".NET Core Identity Controller Implementation"],["nzHref","#h-c9515f97","nzTitle","IdentityController"],["nzHref","#h-88d4cd62","nzTitle",".NET Core Identity Service Implementation"],["nzHref","#h-6278f57b","nzTitle","IdentityService"],["nzHref","#h-3505cd43","nzTitle","Data Validation with FluentValidation Library"],["nzHref","#h-6f8b794f","nzTitle","Conclusion"],["nzHref","#h-948a2e35","nzTitle","Credits"],[1,"markdown-title"],[1,"subtitle"],[1,"widget"],["aria-label","Edit this page on Github","href","https://github.com/cioina/cioina.azurewebsites.net/edit/main/blog/20230605-dotnet-core-testing.md","target","_blank","rel","noopener noreferrer",1,"edit-button"],["nzType","edit"],[1,"markdown"],[2,"border-color","#faad14"],["href","https://versionsof.net/","target","_blank","rel","noopener"],["href","https://github.com/ivaylokenov/MyTested.AspNetCore.Mvc","target","_blank","rel","noopener"],["href","https://github.com/ivaylokenov/MyTested.AspNetCore.Mvc/blob/development/LICENSE","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov/BookStore","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov/BookStore/blob/main/LICENSE","target","_blank","rel","noopener"],["id","h-0b79795d"],["onclick","window.location.hash = 'h-0b79795d'",1,"anchor"],["href","https://github.com/cioina/MyTested-test-project-example","target","_blank","rel","noopener"],["href","https://github.com/cioina/cioina.azurewebsites.net","target","_blank","rel","noopener"],["id","h-5a486561"],["onclick","window.location.hash = 'h-5a486561'",1,"anchor"],["href","https://github.com/kalintsenkov/BlazorShop/blob/master/src/BlazorShop.Tests/Controllers/AddressesControllerTests.cs","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov/BlazorShop/blob/master/src/BlazorShop.Web/Server/Infrastructure/Extensions/ServiceCollectionExtensions.cs","target","_blank","rel","noopener"],["href","https://github.com/gothinkster/aspnetcore-realworld-example-app/blob/master/src/Conduit/ServicesExtensions.cs","target","_blank","rel","noopener"],["href","https://github.com/ivaylokenov/MyTested.AspNetCore.Mvc/tree/development/samples/MusicStore/MusicStore.Test","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Routing/FrontEndRouteTest.cs","target","_blank","rel","noopener"],[1,"language-csharp"],[1,"hljs-keyword"],[1,"hljs-title"],[1,"hljs-meta"],[1,"hljs-function"],[1,"hljs-string"],["id","h-24135ede"],["onclick","window.location.hash = 'h-24135ede'",1,"anchor"],["href","https://github.com/kalintsenkov/BookStore/blob/main/src/Server/BookStore.Web/Features/IdentityController.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Web/Web/Features/IdentityController.cs","target","_blank","rel","noopener"],["id","h-c9515f97"],["onclick","window.location.hash = 'h-c9515f97'",1,"anchor"],["id","h-88d4cd62"],["onclick","window.location.hash = 'h-88d4cd62'",1,"anchor"],["href","https://github.com/kalintsenkov/BookStore/blob/main/src/Server/BookStore.Infrastructure/Identity/Services/IdentityService.cs","target","_blank","rel","noopener"],["id","h-6278f57b"],["onclick","window.location.hash = 'h-6278f57b'",1,"anchor"],[1,"hljs-params"],[1,"hljs-built_in"],[1,"hljs-literal"],[1,"hljs-number"],[1,"hljs-subst"],["href","https://github.com/gothinkster/aspnetcore-realworld-example-app/blob/master/tests/Conduit.IntegrationTests/Features/Users/LoginTests.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Routing/IdentityControllerRouteTest.cs","target","_blank","rel","noopener"],[1,"hljs-comment"],["id","h-3505cd43"],["onclick","window.location.hash = 'h-3505cd43'",1,"anchor"],["href","https://github.com/kalintsenkov/BookStore/blob/main/src/Server/BookStore.Application/Catalog/Authors/Commands/Create/AuthorCreateCommandValidator.Specs.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Routing/TagsControllerRouteTest.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Routing/IdentityControllerRouteTest.cs#L626","target","_blank","rel","noopener"],["id","h-6f8b794f"],["onclick","window.location.hash = 'h-6f8b794f'",1,"anchor"],["id","h-948a2e35"],["onclick","window.location.hash = 'h-948a2e35'",1,"anchor"],["href","https://github.com/ivaylokenov","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov","target","_blank","rel","noopener"],["href","https://github.com/ardalis","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev","target","_blank","rel","noopener"],["href","https://github.com/stefanprodan","target","_blank","rel","noopener"],["href","https://github.com/MarkCiliaVincenti","target","_blank","rel","noopener"],["href","https://github.com/jbogard","target","_blank","rel","noopener"],["href","https://github.com/BenMorris","target","_blank","rel","noopener"],[3,"click"],["nz-typography","","nzType","success"],["nzType","arrow-left"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"nz-card",1)(2,"div",2)(3,"div",3)(4,"nz-space",4),g(5,Ci,4,0,"ng-container",5)(6,Ti,4,0,"ng-container",5),t()()(),n(7,"nz-affix",6)(8,"div",7)(9,"div",3)(10,"a",8),h("click",function(){return r.scrollTop()}),e(11,"Jump to top"),t()(),n(12,"div",3)(13,"nz-switch",9),j("ngModelChange",function(S){return U(r.enableNavigation,S)||(r.enableNavigation=S),S}),h("ngModelChange",function(){return r.disableEnable()}),t()()(),n(14,"nz-anchor",10),h("nzClick",function(S){return r.goLink(S)}),d(15,"nz-link",11)(16,"nz-link",12)(17,"nz-link",13)(18,"nz-link",14)(19,"nz-link",15)(20,"nz-link",16)(21,"nz-link",17)(22,"nz-link",18)(23,"nz-link",19),t()(),n(24,"span",20),e(25," ASP.NET Core 9 Testing"),d(26,"span",21)(27,"span",22),n(28,"a",23),d(29,"nz-icon",24),t()(),n(30,"article",25),vt(),n(31,"blockquote",26)(32,"p")(33,"strong"),e(34,"All C# code from this article was tested using "),n(35,"a",27),e(36,".NET Core 9.0.1"),t(),e(37,", modified source code of "),n(38,"a",28),e(39,"MyTested.AspNetCore.Mvc - Fluent Testing Library for ASP.NET Core MVC"),t(),e(40," provided under "),n(41,"a",29),e(42,"Apache License, Version 2.0 or Microsoft Public License (Ms-PL)"),t(),e(43,", and modified source code of "),n(44,"a",30),e(45,"BookStore"),t(),e(46," provided under "),n(47,"a",31),e(48,"MIT License"),t()()()(),n(49,"h2",32)(50,"span"),e(51,"Introduction"),t(),n(52,"a",33),e(53,"#"),t()(),n(54,"p"),e(55,"In this article, we will give an example of testing of .NET Core code. We will use "),n(56,"a",28),e(57,"MyTested"),t(),e(58," - a well-known library for testing ASP.NET Core MVC. Here, we adapted the library to work with .NET Core 9 and API controllers with Bearer Header Authorization based on JWT token implementation provided by .NET Core. Our .NET Core 9 project is based on "),n(59,"a",30),e(60,"BookStore"),t(),e(61," repository and adapted to work with MyTested library. A full test project example is on "),n(62,"a",34),e(63,"our GitHub repository"),t(),e(64,"."),t(),n(65,"p"),e(66,"The main focus of our example is testing of the standard "),n(67,"code"),e(68,"User Identity"),t(),e(69," provided by "),n(70,"code"),e(71,"Microsoft.AspNetCore.Identity"),t(),e(72,". The access to the user is provided by "),n(73,"code"),e(74,"UserManager<User>"),t(),e(75," micro service. The source code of all our examples is copied and pasted from our actual application. The compiled code of our .NET Core 9 application can be found on "),n(76,"a",35),e(77,"our GitHub repository"),t(),e(78,"."),t(),n(79,"p"),e(80,"One of the advantages of having of a detailed test module for standard "),n(81,"code"),e(82,"Microsoft.AspNetCore.Identity"),t(),e(83," implementation is the fact that it is used very frequently in .NET Core applications. Following, we will give examples of API controller, the implementation of "),n(84,"code"),e(85,"User Identity"),t(),e(86," with Bearer Header Authorization based on JWT token and an example of a comprehensive "),n(87,"code"),e(88,"User Identity"),t(),e(89," controller testing."),t(),n(90,"h2",36)(91,"span"),e(92,"MyTested Library Out of The Box"),t(),n(93,"a",37),e(94,"#"),t()(),n(95,"p"),e(96,"I found out about MyTested for the first time from "),n(97,"a",38),e(98,"BlazorShop"),t(),e(99," repository. At the same time, I found out about "),n(100,"code"),e(101,"JwtAuthentication"),t(),e(102," implementation from same "),n(103,"a",39),e(104,"BlazorShop"),t(),e(105," repository and from "),n(106,"a",40),e(107,"aspnetcore-realworld-example"),t(),e(108," repository. Both "),n(109,"code"),e(110,"JwtAuthentication"),t(),e(111," implementations did not work with original "),n(112,"a",28),e(113,"MyTested"),t(),e(114," library, so I decided to find out why. I do not know who engineered MyTested, but I was not able to fully understand how it works. I was able only to add some small pieces of code to make MyTested and my own "),n(115,"code"),e(116,"JwtAuthentication"),t(),e(117," implementation work and not to break any original MyTested tests. But, what MyTested can do out of the box? The best answer is in "),n(118,"a",41),e(119,"MusicStore"),t(),e(120," testing project. For the API controller, "),n(121,"a",42),e(122,"here"),t(),e(123," is an example:"),t(),n(124,"pre",43)(125,"code")(126,"span",44),e(127,"using"),t(),e(128,` BlogAngular.Application.Common.Version;
`),n(129,"span",44),e(130,"using"),t(),e(131,` BlogAngular.Web.Features;
`),n(132,"span",44),e(133,"using"),t(),e(134,` MyTested.AspNetCore.Mvc;
`),n(135,"span",44),e(136,"using"),t(),e(137,` Xunit;

`),n(138,"span",44),e(139,"namespace"),t(),e(140," "),n(141,"span",45),e(142,"BlogAngular.Test.Routing"),t(),e(143,`
{
    `),n(144,"span",44),e(145,"public"),t(),e(146," "),n(147,"span",44),e(148,"class"),t(),e(149," "),n(150,"span",45),e(151,"FrontEndRouteTest"),t(),e(152,`
    {
        [`),n(153,"span",46),e(154,"Fact"),t(),e(155,`]
        `),n(156,"span",47)(157,"span",44),e(158,"public"),t(),e(159," "),n(160,"span",44),e(161,"void"),t(),e(162," "),n(163,"span",45),e(164,"VersionShouldBeRouted"),t(),e(165,"()"),t(),e(166,`
        => MyMvc
        .Pipeline()
        .ShouldMap(request => request
            .WithMethod(HttpMethod.Get)
            .WithLocation(`),n(167,"span",48),e(168,'"api/v1.0/version"'),t(),e(169,`))
        .To<VersionController>(c => c.Index())
        .Which()
        .ShouldReturn()
        .ActionResult(result => result.Result(`),n(170,"span",44),e(171,"new"),t(),e(172,` VersionResponseEnvelope
        {
            VersionJson = `),n(173,"span",44),e(174,"new"),t(),e(175,` VersionResponseModel()
        }));
    }
}`),t()(),n(176,"h2",49)(177,"span"),e(178,".NET Core Identity Controller Implementation"),t(),n(179,"a",50),e(180,"#"),t()(),n(181,"p"),e(182,"Our controller implementation is based on "),n(183,"a",51),e(184,"this GitHub repository"),t(),e(185,". We added two more methods: "),n(186,"code"),e(187,"LoginPassword"),t(),e(188," and "),n(189,"code"),e(190,"Update"),t(),e(191," with "),n(192,"code"),e(193,"[Authorize(AuthenticationSchemes = Bearer, Policy = BearerPolicy)]"),t(),e(194," attribute that uses Bearer Header Authorization based on JWT token implementation provided by .NET Core 9. Our Angular 18 application that runs in a web browser will make a request to the endpoint "),n(195,"code"),e(196,"http://localhost:1503/api/v1.0/identity/update"),t(),e(197,". The request has an Authorization header with a JWT token. The request body has some data in JSON format. Our .NET Core 9 application must authenticate the user based on the JWT token and authorize the user based on a specific policy. Once the user passes the authorization process, the application must execute a command and return some data in JSON format. Below, we give an example of an "),n(198,"a",52),e(199,"API controller"),t()(),n(200,"h3",53)(201,"span"),e(202,"IdentityController"),t(),n(203,"a",54),e(204,"#"),t()(),n(205,"pre",43)(206,"code")(207,"span",44),e(208,"using"),t(),e(209,` BlogAngular.Application.Identity.Commands.Common;
`),n(210,"span",44),e(211,"using"),t(),e(212,` BlogAngular.Application.Identity.Commands.Login;
`),n(213,"span",44),e(214,"using"),t(),e(215,` BlogAngular.Application.Identity.Commands.Register;
`),n(216,"span",44),e(217,"using"),t(),e(218,` BlogAngular.Application.Identity.Commands.Update;
`),n(219,"span",44),e(220,"using"),t(),e(221,` Microsoft.AspNetCore.Authorization;
`),n(222,"span",44),e(223,"using"),t(),e(224,` Microsoft.AspNetCore.Mvc;
`),n(225,"span",44),e(226,"using"),t(),e(227,` System.Threading.Tasks;

`),n(228,"span",44),e(229,"using"),t(),e(230," "),n(231,"span",44),e(232,"static"),t(),e(233,` BlogAngular.Domain.Common.Models.ModelConstants.Identity;

`),n(234,"span",44),e(235,"namespace"),t(),e(236," "),n(237,"span",45),e(238,"BlogAngular.Web.Features"),t(),e(239,`
{
    `),n(240,"span",44),e(241,"public"),t(),e(242," "),n(243,"span",44),e(244,"class"),t(),e(245," "),n(246,"span",45),e(247,"IdentityController"),t(),e(248," : "),n(249,"span",45),e(250,"ApiController"),t(),e(251,`
    {
        [`),n(252,"span",46),e(253,"HttpPost"),t(),e(254,`]
        [`),n(255,"span",46),e(256,"Authorize(AuthenticationSchemes = Bearer, Policy = BearerPolicy, Roles = AdministratorRoleName)"),t(),e(257,`]
        `),n(258,"span",44),e(259,"public"),t(),e(260," "),n(261,"span",44),e(262,"async"),t(),e(263,` Task<ActionResult<UserResponseEnvelope>> LoginPassword(
            LoginPasswordCommand command)
            => `),n(264,"span",44),e(265,"await"),t(),e(266," "),n(267,"span",44),e(268,"this"),t(),e(269,`.Send(command);

        [`),n(270,"span",46),e(271,"HttpPost"),t(),e(272,`]
        [`),n(273,"span",46),e(274,"Route(nameof(Login))"),t(),e(275,`]
        `),n(276,"span",44),e(277,"public"),t(),e(278," "),n(279,"span",44),e(280,"async"),t(),e(281,` Task<ActionResult<UserResponseEnvelope>> Login(
            UserLoginCommand command)
            => `),n(282,"span",44),e(283,"await"),t(),e(284," "),n(285,"span",44),e(286,"this"),t(),e(287,`.Send(command);

        [`),n(288,"span",46),e(289,"HttpPost"),t(),e(290,`]
        [`),n(291,"span",46),e(292,"Route(nameof(Register))"),t(),e(293,`]
        `),n(294,"span",44),e(295,"public"),t(),e(296," "),n(297,"span",44),e(298,"async"),t(),e(299,` Task<ActionResult<UserResponseEnvelope>> Register(
            UserRegisterCommand command)
            => `),n(300,"span",44),e(301,"await"),t(),e(302," "),n(303,"span",44),e(304,"this"),t(),e(305,`.Send(command);

        [`),n(306,"span",46),e(307,"HttpPut"),t(),e(308,`]
        [`),n(309,"span",46),e(310,"Route(nameof(Update))"),t(),e(311,`]
        [`),n(312,"span",46),e(313,"Authorize(AuthenticationSchemes = Bearer, Policy = BearerPolicy, Roles = AdministratorRoleName)"),t(),e(314,`]
        `),n(315,"span",44),e(316,"public"),t(),e(317," "),n(318,"span",44),e(319,"async"),t(),e(320,` Task<ActionResult<UserResponseEnvelope>> Update(
            UserUpdateCommand command)
            => `),n(321,"span",44),e(322,"await"),t(),e(323," "),n(324,"span",44),e(325,"this"),t(),e(326,`.Send(command);
    }
}`),t()(),n(327,"h2",55)(328,"span"),e(329,".NET Core Identity Service Implementation"),t(),n(330,"a",56),e(331,"#"),t()(),n(332,"p"),e(333,"Our service implementation is based on "),n(334,"a",57),e(335,"this GitHub repository"),t(),e(336,". As we said earlier, this kind of "),n(337,"code"),e(338,"Identity Service"),t(),e(339," will look the same for all .NET Core 9 applications that use a standard "),n(340,"code"),e(341,"Microsoft.AspNetCore.Identity"),t(),e(342," implementation. Below, there is an example that we copied and pasted direct from our actual application."),t(),n(343,"h3",58)(344,"span"),e(345,"IdentityService"),t(),n(346,"a",59),e(347,"#"),t()(),n(348,"pre",43)(349,"code")(350,"span",44),e(351,"using"),t(),e(352,` BlogAngular.Application.Common;
`),n(353,"span",44),e(354,"using"),t(),e(355,` BlogAngular.Application.Common.Models;
`),n(356,"span",44),e(357,"using"),t(),e(358,` BlogAngular.Application.Identity;
`),n(359,"span",44),e(360,"using"),t(),e(361,` BlogAngular.Application.Identity.Commands.Common;
`),n(362,"span",44),e(363,"using"),t(),e(364,` BlogAngular.Application.Identity.Commands.Register;
`),n(365,"span",44),e(366,"using"),t(),e(367,` BlogAngular.Application.Identity.Commands.Update;
`),n(368,"span",44),e(369,"using"),t(),e(370,` BlogAngular.Application.Identity.Queries.Profile;
`),n(371,"span",44),e(372,"using"),t(),e(373,` BlogAngular.Domain.Common.Events.Identity;
`),n(374,"span",44),e(375,"using"),t(),e(376,` BlogAngular.Infrastructure.Common.Events;
`),n(377,"span",44),e(378,"using"),t(),e(379,` BlogAngular.Infrastructure.Common.Extensions;
`),n(380,"span",44),e(381,"using"),t(),e(382,` Microsoft.AspNetCore.Hosting;
`),n(383,"span",44),e(384,"using"),t(),e(385,` Microsoft.AspNetCore.Http;
`),n(386,"span",44),e(387,"using"),t(),e(388,` Microsoft.AspNetCore.Identity;
`),n(389,"span",44),e(390,"using"),t(),e(391,` Microsoft.Extensions.Options;
`),n(392,"span",44),e(393,"using"),t(),e(394,` System;
`),n(395,"span",44),e(396,"using"),t(),e(397,` System.Collections.Generic;
`),n(398,"span",44),e(399,"using"),t(),e(400,` System.Security.Claims;
`),n(401,"span",44),e(402,"using"),t(),e(403,` System.Threading.Tasks;

`),n(404,"span",44),e(405,"namespace"),t(),e(406," "),n(407,"span",45),e(408,"BlogAngular.Infrastructure.Identity.Services"),t(),e(409,`
{
    `),n(410,"span",47)(411,"span",44),e(412,"internal"),t(),e(413," "),n(414,"span",44),e(415,"class"),t(),e(416," "),n(417,"span",45),e(418,"IdentityService"),t(),e(419,"("),n(420,"span",60),e(421,`
        IWebHostEnvironment env,
        UserManager<User> userManager,
        IJwtGenerator jwtGenerator,
        IEventDispatcher eventDispatcher,
        IOptions<ApplicationSettings> applicationSettings,
        IHttpContextAccessor httpContextAccessor
            `),t(),e(422,") : IIdentity"),t(),e(423,`
    {
        `),n(424,"span",44),e(425,"private"),t(),e(426," "),n(427,"span",44),e(428,"const"),t(),e(429," "),n(430,"span",61),e(431,"string"),t(),e(432," InvalidErrorMessage = "),n(433,"span",48),e(434,'"Invalid credentials."'),t(),e(435,`;
        `),n(436,"span",44),e(437,"private"),t(),e(438," "),n(439,"span",44),e(440,"const"),t(),e(441," "),n(442,"span",61),e(443,"string"),t(),e(444," NoDataErrorMessage = "),n(445,"span",48),e(446,'"There is no data to process."'),t(),e(447,`;
        `),n(448,"span",44),e(449,"private"),t(),e(450," "),n(451,"span",44),e(452,"const"),t(),e(453," "),n(454,"span",61),e(455,"string"),t(),e(456," IdentityErrorMessage = "),n(457,"span",48),e(458,'"Something went wrong. The server may be down."'),t(),e(459,`;
        `),n(460,"span",44),e(461,"private"),t(),e(462," "),n(463,"span",44),e(464,"const"),t(),e(465," "),n(466,"span",61),e(467,"string"),t(),e(468," IdentityRoleErrorMessage = "),n(469,"span",48),e(470,'@"Cannot find role {0}"'),t(),e(471,`;
        `),n(472,"span",44),e(473,"private"),t(),e(474," "),n(475,"span",44),e(476,"const"),t(),e(477," "),n(478,"span",61),e(479,"string"),t(),e(480," UserNameTakenErrorMessage = "),n(481,"span",48),e(482,'"The user name has been taken."'),t(),e(483,`;
        `),n(484,"span",44),e(485,"private"),t(),e(486," "),n(487,"span",44),e(488,"const"),t(),e(489," "),n(490,"span",61),e(491,"string"),t(),e(492," EmailTakenErrorMessage = "),n(493,"span",48),e(494,'"The email has been taken."'),t(),e(495,`;
        `),n(496,"span",44),e(497,"private"),t(),e(498," "),n(499,"span",44),e(500,"const"),t(),e(501," "),n(502,"span",61),e(503,"string"),t(),e(504," UserNullErrorMessage = "),n(505,"span",48),e(506,'"Cannot find user by Id."'),t(),e(507,`;
        `),n(508,"span",44),e(509,"private"),t(),e(510," "),n(511,"span",44),e(512,"const"),t(),e(513," "),n(514,"span",61),e(515,"string"),t(),e(516," ProfileErrorMessage = "),n(517,"span",48),e(518,'"Cannot find user profile."'),t(),e(519,`;
        `),n(520,"span",44),e(521,"private"),t(),e(522," "),n(523,"span",44),e(524,"const"),t(),e(525," "),n(526,"span",61),e(527,"string"),t(),e(528," UsernameFormatErrorMessage = "),n(529,"span",48),e(530,'"Username must contain letters and numbers."'),t(),e(531,`;
        `),n(532,"span",44),e(533,"private"),t(),e(534," "),n(535,"span",44),e(536,"const"),t(),e(537," "),n(538,"span",61),e(539,"string"),t(),e(540," PasswordFormatErrorMessage = "),n(541,"span",48),e(542,'"Password required upper and lower case letters, digits, and at least one special symbol."'),t(),e(543,`;
        `),n(544,"span",44),e(545,"private"),t(),e(546," "),n(547,"span",44),e(548,"const"),t(),e(549," "),n(550,"span",61),e(551,"string"),t(),e(552," PasswordDeletedErrorMessage = "),n(553,"span",48),e(554,'"The old password was deleted. You must provide a new password."'),t(),e(555,`;
        `),n(556,"span",44),e(557,"private"),t(),e(558," "),n(559,"span",44),e(560,"const"),t(),e(561," "),n(562,"span",61),e(563,"string"),t(),e(564," LockoutErrorMessage = "),n(565,"span",48),e(566,'@"You have been lockout for {0} minutes.{1}"'),t(),e(567,`;
        `),n(568,"span",44),e(569,"private"),t(),e(570," "),n(571,"span",44),e(572,"const"),t(),e(573," "),n(574,"span",61),e(575,"string"),t(),e(576," LockoutEnabledErrorMessage = "),n(577,"span",48),e(578,'"Lockout setting is not enabled."'),t(),e(579,`;

        `),n(580,"span",44),e(581,"private"),t(),e(582," "),n(583,"span",44),e(584,"readonly"),t(),e(585,` IWebHostEnvironment env = env;
        `),n(586,"span",44),e(587,"private"),t(),e(588," "),n(589,"span",44),e(590,"readonly"),t(),e(591,` UserManager<User> userManager = userManager;
        `),n(592,"span",44),e(593,"private"),t(),e(594," "),n(595,"span",44),e(596,"readonly"),t(),e(597,` IJwtGenerator jwtGenerator = jwtGenerator;
        `),n(598,"span",44),e(599,"private"),t(),e(600," "),n(601,"span",44),e(602,"readonly"),t(),e(603,` IEventDispatcher eventDispatcher = eventDispatcher;
        `),n(604,"span",44),e(605,"private"),t(),e(606," "),n(607,"span",44),e(608,"readonly"),t(),e(609,` ApplicationSettings applicationSettings = applicationSettings.Value;
        `),n(610,"span",44),e(611,"private"),t(),e(612," "),n(613,"span",44),e(614,"readonly"),t(),e(615,` IHttpContextAccessor httpContextAccessor = httpContextAccessor;
        `),n(616,"span",44),e(617,"internal"),t(),e(618," "),n(619,"span",44),e(620,"static"),t(),e(621," "),n(622,"span",44),e(623,"readonly"),t(),e(624," "),n(625,"span",61),e(626,"string"),t(),e(627,"[] registerNotImplemented = ["),n(628,"span",48),e(629,'"Register is not implemented yet."'),t(),e(630,`];

        `),n(631,"span",46),e(632,"#"),n(633,"span",44),e(634,"region"),t(),e(635," IsInRoleAsync"),t(),e(636,`
        `),n(637,"span",44),e(638,"public"),t(),e(639," "),n(640,"span",44),e(641,"async"),t(),e(642," Task<Result<"),n(643,"span",61),e(644,"bool"),t(),e(645,`>> IsInRoleAsync()
        {
            ClaimsPrincipal? claimsPrincipal = `),n(646,"span",44),e(647,"this"),t(),e(648,`.httpContextAccessor.HttpContext!.User!;
            `),n(649,"span",44),e(650,"if"),t(),e(651," (claimsPrincipal != "),n(652,"span",62),e(653,"null"),t(),e(654,`)
            {
                `),n(655,"span",44),e(656,"var"),t(),e(657,` isAuthenticated = claimsPrincipal.Identity?.IsAuthenticated;
                `),n(658,"span",44),e(659,"if"),t(),e(660," (isAuthenticated == "),n(661,"span",62),e(662,"null"),t(),e(663," || !("),n(664,"span",61),e(665,"bool"),t(),e(666,`)isAuthenticated)
                {
                    `),n(667,"span",44),e(668,"return"),t(),e(669," Result<"),n(670,"span",61),e(671,"bool"),t(),e(672,">.Failure("),n(673,"span",44),e(674,"new"),t(),e(675," Dictionary<"),n(676,"span",61),e(677,"string"),t(),e(678,", "),n(679,"span",61),e(680,"string"),t(),e(681,`[]>
                {
                    { `),n(682,"span",48),e(683,'"identity_error"'),t(),e(684,", "),n(685,"span",44),e(686,"new"),t(),e(687,`[] { IdentityErrorMessage } }
                });
                }
            }
            `),n(688,"span",44),e(689,"else"),t(),e(690,`
            {
                `),n(691,"span",44),e(692,"return"),t(),e(693," Result<"),n(694,"span",61),e(695,"bool"),t(),e(696,">.Failure("),n(697,"span",44),e(698,"new"),t(),e(699," Dictionary<"),n(700,"span",61),e(701,"string"),t(),e(702,", "),n(703,"span",61),e(704,"string"),t(),e(705,`[]>
            {
                { `),n(706,"span",48),e(707,'"identity_error"'),t(),e(708,", "),n(709,"span",44),e(710,"new"),t(),e(711,`[] { IdentityErrorMessage } }
            });
            }

            User? user;
            `),n(712,"span",44),e(713,"if"),t(),e(714," ("),n(715,"span",44),e(716,"this"),t(),e(717,".env.EnvironmentName == "),n(718,"span",48),e(719,'"Test"'),t(),e(720,`)
            {
                `),n(721,"span",44),e(722,"var"),t(),e(723,` name = claimsPrincipal.Identity?.Name;
                `),n(724,"span",44),e(725,"if"),t(),e(726," (name == "),n(727,"span",62),e(728,"null"),t(),e(729,`)
                {
                    `),n(730,"span",44),e(731,"return"),t(),e(732," Result<"),n(733,"span",61),e(734,"bool"),t(),e(735,">.Failure("),n(736,"span",44),e(737,"new"),t(),e(738," Dictionary<"),n(739,"span",61),e(740,"string"),t(),e(741,", "),n(742,"span",61),e(743,"string"),t(),e(744,`[]>
                {
                    { `),n(745,"span",48),e(746,'"debug_error"'),t(),e(747,", "),n(748,"span",44),e(749,"new"),t(),e(750,`[] { IdentityErrorMessage } }
                });
                }
                user = `),n(751,"span",44),e(752,"await"),t(),e(753," "),n(754,"span",44),e(755,"this"),t(),e(756,`.userManager.FindByEmailAsync(name);
            }
            `),n(757,"span",44),e(758,"else"),t(),e(759,`
            {
                `),n(760,"span",44),e(761,"var"),t(),e(762,` claim = claimsPrincipal.FindFirst(ClaimTypes.NameIdentifier);
                `),n(763,"span",44),e(764,"if"),t(),e(765," (claim == "),n(766,"span",62),e(767,"null"),t(),e(768,`)
                {
                    `),n(769,"span",44),e(770,"return"),t(),e(771," Result<"),n(772,"span",61),e(773,"bool"),t(),e(774,">.Failure("),n(775,"span",44),e(776,"new"),t(),e(777," Dictionary<"),n(778,"span",61),e(779,"string"),t(),e(780,", "),n(781,"span",61),e(782,"string"),t(),e(783,`[]>
                {
                    { `),n(784,"span",48),e(785,'"name_identifier_error"'),t(),e(786,", "),n(787,"span",44),e(788,"new"),t(),e(789,`[] { IdentityErrorMessage } }
                });
                }
                user = `),n(790,"span",44),e(791,"await"),t(),e(792," "),n(793,"span",44),e(794,"this"),t(),e(795,`.userManager.FindByIdAsync(claim.Value);
            }

            `),n(796,"span",44),e(797,"if"),t(),e(798," (user == "),n(799,"span",62),e(800,"null"),t(),e(801,`)
            {
                `),n(802,"span",44),e(803,"return"),t(),e(804," Result<"),n(805,"span",61),e(806,"bool"),t(),e(807,">.Failure("),n(808,"span",44),e(809,"new"),t(),e(810," Dictionary<"),n(811,"span",61),e(812,"string"),t(),e(813,", "),n(814,"span",61),e(815,"string"),t(),e(816,`[]>
            {
                { `),n(817,"span",48),e(818,'"user_error"'),t(),e(819,", "),n(820,"span",44),e(821,"new"),t(),e(822,`[] { UserNullErrorMessage } }
            });
            }

            `),n(823,"span",44),e(824,"var"),t(),e(825,` claimRole = claimsPrincipal.FindFirst(ClaimTypes.Role);
            `),n(826,"span",44),e(827,"if"),t(),e(828," (claimRole == "),n(829,"span",62),e(830,"null"),t(),e(831,`)
            {
                `),n(832,"span",44),e(833,"return"),t(),e(834," Result<"),n(835,"span",61),e(836,"bool"),t(),e(837,">.Failure("),n(838,"span",44),e(839,"new"),t(),e(840," Dictionary<"),n(841,"span",61),e(842,"string"),t(),e(843,", "),n(844,"span",61),e(845,"string"),t(),e(846,`[]>
                {
                    { `),n(847,"span",48),e(848,'"is_in_role_error"'),t(),e(849,", "),n(850,"span",44),e(851,"new"),t(),e(852,"[] { "),n(853,"span",61),e(854,"string"),t(),e(855,".Format(IdentityRoleErrorMessage, "),n(856,"span",48),e(857,'""'),t(),e(858,`) } }
                });
            }
            `),n(859,"span",44),e(860,"var"),t(),e(861," isInRole = "),n(862,"span",44),e(863,"await"),t(),e(864," "),n(865,"span",44),e(866,"this"),t(),e(867,`.userManager.IsInRoleAsync(user, claimRole.Value);
            `),n(868,"span",44),e(869,"if"),t(),e(870,` (!isInRole)
            {
                `),n(871,"span",44),e(872,"return"),t(),e(873," Result<"),n(874,"span",61),e(875,"bool"),t(),e(876,">.Failure("),n(877,"span",44),e(878,"new"),t(),e(879," Dictionary<"),n(880,"span",61),e(881,"string"),t(),e(882,", "),n(883,"span",61),e(884,"string"),t(),e(885,`[]>
                {
                    { `),n(886,"span",48),e(887,'"is_in_role_error"'),t(),e(888,", "),n(889,"span",44),e(890,"new"),t(),e(891,"[] { "),n(892,"span",61),e(893,"string"),t(),e(894,`.Format(IdentityRoleErrorMessage, claimRole.Value) } }
                });
            }

            `),n(895,"span",44),e(896,"return"),t(),e(897," "),n(898,"span",62),e(899,"true"),t(),e(900,`;
        }
        `),n(901,"span",46),e(902,"#"),n(903,"span",44),e(904,"endregion"),t()(),e(905,`

        `),n(906,"span",46),e(907,"#"),n(908,"span",44),e(909,"region"),t(),e(910," LoginPassword  "),t(),e(911,`
        `),n(912,"span",44),e(913,"public"),t(),e(914," "),n(915,"span",44),e(916,"async"),t(),e(917,` Task<Result<UserResponseEnvelope>> LoginPassword(LoginPasswordCommand userRequest)
        {
            `),n(918,"span",44),e(919,"if"),t(),e(920," (userRequest.UserJson.Password == "),n(921,"span",62),e(922,"null"),t(),e(923,`)
            {
                `),n(924,"span",44),e(925,"return"),t(),e(926," Result<UserResponseEnvelope>.Failure("),n(927,"span",44),e(928,"new"),t(),e(929," Dictionary<"),n(930,"span",61),e(931,"string"),t(),e(932,", "),n(933,"span",61),e(934,"string"),t(),e(935,`[]>
            {
                { `),n(936,"span",48),e(937,'"no_data_error"'),t(),e(938,", "),n(939,"span",44),e(940,"new"),t(),e(941,`[] { NoDataErrorMessage } }
            });
            }

            `),n(942,"span",61),e(943,"bool"),t(),e(944," isNewToken = "),n(945,"span",62),e(946,"false"),t(),e(947,`;
            ClaimsPrincipal? claimsPrincipal = `),n(948,"span",44),e(949,"this"),t(),e(950,`.httpContextAccessor.HttpContext!.User!;
            `),n(951,"span",44),e(952,"if"),t(),e(953," (claimsPrincipal != "),n(954,"span",62),e(955,"null"),t(),e(956,`)
            {
                `),n(957,"span",44),e(958,"var"),t(),e(959,` isAuthenticated = claimsPrincipal.Identity?.IsAuthenticated;
                `),n(960,"span",44),e(961,"if"),t(),e(962," (isAuthenticated == "),n(963,"span",62),e(964,"null"),t(),e(965," || !("),n(966,"span",61),e(967,"bool"),t(),e(968,`)isAuthenticated)
                {
                    `),n(969,"span",44),e(970,"return"),t(),e(971," Result<UserResponseEnvelope>.Failure("),n(972,"span",44),e(973,"new"),t(),e(974," Dictionary<"),n(975,"span",61),e(976,"string"),t(),e(977,", "),n(978,"span",61),e(979,"string"),t(),e(980,`[]>
                {
                    { `),n(981,"span",48),e(982,'"identity_error"'),t(),e(983,", "),n(984,"span",44),e(985,"new"),t(),e(986,`[] { IdentityErrorMessage } }
                });
                }
                `),n(987,"span",44),e(988,"var"),t(),e(989," iat = claimsPrincipal.FindFirst("),n(990,"span",48),e(991,'"iat"'),t(),e(992,`);
                `),n(993,"span",44),e(994,"var"),t(),e(995," exp = claimsPrincipal.FindFirst("),n(996,"span",48),e(997,'"exp"'),t(),e(998,`);
                `),n(999,"span",44),e(1e3,"if"),t(),e(1001," (iat == "),n(1002,"span",62),e(1003,"null"),t(),e(1004," || exp == "),n(1005,"span",62),e(1006,"null"),t(),e(1007,`)
                {
                    `),n(1008,"span",44),e(1009,"return"),t(),e(1010," Result<UserResponseEnvelope>.Failure("),n(1011,"span",44),e(1012,"new"),t(),e(1013," Dictionary<"),n(1014,"span",61),e(1015,"string"),t(),e(1016,", "),n(1017,"span",61),e(1018,"string"),t(),e(1019,`[]>
                {
                    { `),n(1020,"span",48),e(1021,'"identity_error"'),t(),e(1022,", "),n(1023,"span",44),e(1024,"new"),t(),e(1025,`[] { IdentityErrorMessage } }
                });
                }

                `),n(1026,"span",44),e(1027,"var"),t(),e(1028," rate = ("),n(1029,"span",61),e(1030,"long"),t(),e(1031,".Parse(exp.Value) - "),n(1032,"span",61),e(1033,"long"),t(),e(1034,`.Parse(iat.Value)) * applicationSettings.SecurityTokenRefreshRate;
                `),n(1035,"span",44),e(1036,"var"),t(),e(1037," current = "),n(1038,"span",61),e(1039,"long"),t(),e(1040,`.Parse(exp.Value) - DateTimeOffset.Now.ToUnixTimeSeconds();

                isNewToken = current < rate;
            }
            `),n(1041,"span",44),e(1042,"else"),t(),e(1043,`
            {
                `),n(1044,"span",44),e(1045,"return"),t(),e(1046," Result<UserResponseEnvelope>.Failure("),n(1047,"span",44),e(1048,"new"),t(),e(1049," Dictionary<"),n(1050,"span",61),e(1051,"string"),t(),e(1052,", "),n(1053,"span",61),e(1054,"string"),t(),e(1055,`[]>
            {
                { `),n(1056,"span",48),e(1057,'"identity_error"'),t(),e(1058,", "),n(1059,"span",44),e(1060,"new"),t(),e(1061,`[] { IdentityErrorMessage } }
            });
            }

            User? user;
            `),n(1062,"span",44),e(1063,"if"),t(),e(1064," ("),n(1065,"span",44),e(1066,"this"),t(),e(1067,".env.EnvironmentName == "),n(1068,"span",48),e(1069,'"Test"'),t(),e(1070,`)
            {
                `),n(1071,"span",44),e(1072,"var"),t(),e(1073,` name = claimsPrincipal.Identity?.Name;
                `),n(1074,"span",44),e(1075,"if"),t(),e(1076," (name == "),n(1077,"span",62),e(1078,"null"),t(),e(1079,`)
                {
                    `),n(1080,"span",44),e(1081,"return"),t(),e(1082," Result<UserResponseEnvelope>.Failure("),n(1083,"span",44),e(1084,"new"),t(),e(1085," Dictionary<"),n(1086,"span",61),e(1087,"string"),t(),e(1088,", "),n(1089,"span",61),e(1090,"string"),t(),e(1091,`[]>
                {
                    { `),n(1092,"span",48),e(1093,'"debug_error"'),t(),e(1094,", "),n(1095,"span",44),e(1096,"new"),t(),e(1097,`[] { IdentityErrorMessage } }
                });
                }
                user = `),n(1098,"span",44),e(1099,"await"),t(),e(1100," "),n(1101,"span",44),e(1102,"this"),t(),e(1103,`.userManager.FindByEmailAsync(name);
            }
            `),n(1104,"span",44),e(1105,"else"),t(),e(1106,`
            {
                `),n(1107,"span",44),e(1108,"var"),t(),e(1109,` claim = claimsPrincipal.FindFirst(ClaimTypes.NameIdentifier);
                `),n(1110,"span",44),e(1111,"if"),t(),e(1112," (claim == "),n(1113,"span",62),e(1114,"null"),t(),e(1115,`)
                {
                    `),n(1116,"span",44),e(1117,"return"),t(),e(1118," Result<UserResponseEnvelope>.Failure("),n(1119,"span",44),e(1120,"new"),t(),e(1121," Dictionary<"),n(1122,"span",61),e(1123,"string"),t(),e(1124,", "),n(1125,"span",61),e(1126,"string"),t(),e(1127,`[]>
                {
                    { `),n(1128,"span",48),e(1129,'"name_identifier_error"'),t(),e(1130,", "),n(1131,"span",44),e(1132,"new"),t(),e(1133,`[] { IdentityErrorMessage } }
                });
                }
                user = `),n(1134,"span",44),e(1135,"await"),t(),e(1136," "),n(1137,"span",44),e(1138,"this"),t(),e(1139,`.userManager.FindByIdAsync(claim.Value);
            }

            `),n(1140,"span",44),e(1141,"if"),t(),e(1142," (user == "),n(1143,"span",62),e(1144,"null"),t(),e(1145,`)
            {
                `),n(1146,"span",44),e(1147,"return"),t(),e(1148," Result<UserResponseEnvelope>.Failure("),n(1149,"span",44),e(1150,"new"),t(),e(1151," Dictionary<"),n(1152,"span",61),e(1153,"string"),t(),e(1154,", "),n(1155,"span",61),e(1156,"string"),t(),e(1157,`[]>
            {
                { `),n(1158,"span",48),e(1159,'"user_error"'),t(),e(1160,", "),n(1161,"span",44),e(1162,"new"),t(),e(1163,`[] { UserNullErrorMessage } }
            });
            }

            `),n(1164,"span",44),e(1165,"var"),t(),e(1166,` claimRole = claimsPrincipal.FindFirst(ClaimTypes.Role);
            `),n(1167,"span",44),e(1168,"if"),t(),e(1169," (claimRole == "),n(1170,"span",62),e(1171,"null"),t(),e(1172,`)
            {
                `),n(1173,"span",44),e(1174,"return"),t(),e(1175," Result<UserResponseEnvelope>.Failure("),n(1176,"span",44),e(1177,"new"),t(),e(1178," Dictionary<"),n(1179,"span",61),e(1180,"string"),t(),e(1181,", "),n(1182,"span",61),e(1183,"string"),t(),e(1184,`[]>
                {
                    { `),n(1185,"span",48),e(1186,'"is_in_role_error"'),t(),e(1187,", "),n(1188,"span",44),e(1189,"new"),t(),e(1190,"[] { "),n(1191,"span",61),e(1192,"string"),t(),e(1193,".Format(IdentityRoleErrorMessage, "),n(1194,"span",48),e(1195,'""'),t(),e(1196,`) } }
                });
            }
            `),n(1197,"span",44),e(1198,"var"),t(),e(1199," isInRole = "),n(1200,"span",44),e(1201,"await"),t(),e(1202," "),n(1203,"span",44),e(1204,"this"),t(),e(1205,`.userManager.IsInRoleAsync(user, claimRole.Value);
            `),n(1206,"span",44),e(1207,"if"),t(),e(1208,` (!isInRole)
            {
                `),n(1209,"span",44),e(1210,"return"),t(),e(1211," Result<UserResponseEnvelope>.Failure("),n(1212,"span",44),e(1213,"new"),t(),e(1214," Dictionary<"),n(1215,"span",61),e(1216,"string"),t(),e(1217,", "),n(1218,"span",61),e(1219,"string"),t(),e(1220,`[]>
                {
                    { `),n(1221,"span",48),e(1222,'"is_in_role_error"'),t(),e(1223,", "),n(1224,"span",44),e(1225,"new"),t(),e(1226,"[] { "),n(1227,"span",61),e(1228,"string"),t(),e(1229,`.Format(IdentityRoleErrorMessage, claimRole.Value) } }
                });
            }

            `),n(1230,"span",44),e(1231,"var"),t(),e(1232," isLockoutEnabled = "),n(1233,"span",44),e(1234,"await"),t(),e(1235,` userManager.GetLockoutEnabledAsync(user);

            `),n(1236,"span",44),e(1237,"if"),t(),e(1238,` (isLockoutEnabled)
            {
                `),n(1239,"span",44),e(1240,"var"),t(),e(1241," count = "),n(1242,"span",44),e(1243,"await"),t(),e(1244,` userManager.GetAccessFailedCountAsync(user);
                `),n(1245,"span",44),e(1246,"if"),t(),e(1247," (count == applicationSettings.MaxFailedAccessAttempts - "),n(1248,"span",63),e(1249,"1"),t(),e(1250,`)
                {
                    `),n(1251,"span",44),e(1252,"var"),t(),e(1253," endDate = "),n(1254,"span",44),e(1255,"await"),t(),e(1256,` userManager.GetLockoutEndDateAsync(user);
                    `),n(1257,"span",44),e(1258,"var"),t(),e(1259,` currentDate = DateTimeOffset.UtcNow;
                    `),n(1260,"span",44),e(1261,"if"),t(),e(1262,` (endDate > currentDate)
                    {
                        `),n(1263,"span",44),e(1264,"return"),t(),e(1265," Result<UserResponseEnvelope>.Failure("),n(1266,"span",44),e(1267,"new"),t(),e(1268," Dictionary<"),n(1269,"span",61),e(1270,"string"),t(),e(1271,", "),n(1272,"span",61),e(1273,"string"),t(),e(1274,`[]>
                    {
                        { `),n(1275,"span",48),e(1276,'"lockout_error"'),t(),e(1277,", "),n(1278,"span",44),e(1279,"new"),t(),e(1280,"[] {  "),n(1281,"span",61),e(1282,"string"),t(),e(1283,".Format(LockoutErrorMessage, applicationSettings.DefaultLockoutTimeSpanInMinutes,"),n(1284,"span",48),e(1285,'""'),t(),e(1286,`) } }
                    });
                    }
                }

                `),n(1287,"span",44),e(1288,"var"),t(),e(1289," passwordValid = "),n(1290,"span",44),e(1291,"await"),t(),e(1292," "),n(1293,"span",44),e(1294,"this"),t(),e(1295,`.userManager.CheckPasswordAsync(
                user,
                userRequest.UserJson.Password);

                `),n(1296,"span",44),e(1297,"if"),t(),e(1298,` (!passwordValid)
                {
                    `),n(1299,"span",44),e(1300,"var"),t(),e(1301," accessFailed = "),n(1302,"span",44),e(1303,"await"),t(),e(1304," "),n(1305,"span",44),e(1306,"this"),t(),e(1307,`.userManager.AccessFailedAsync(user);
                    `),n(1308,"span",44),e(1309,"if"),t(),e(1310,` (!accessFailed.Succeeded)
                    {
                        `),n(1311,"span",44),e(1312,"var"),t(),e(1313," errors = "),n(1314,"span",44),e(1315,"new"),t(),e(1316," Dictionary<"),n(1317,"span",61),e(1318,"string"),t(),e(1319,", "),n(1320,"span",61),e(1321,"string"),t(),e(1322,`[]>();
                        accessFailed.Errors.ForEach(e =>
                        {
                            `),n(1323,"span",44),e(1324,"switch"),t(),e(1325,` (e.Code)
                            {
                                `),n(1326,"span",44),e(1327,"case"),t(),e(1328," "),n(1329,"span",48),e(1330,'"TODO: need to debug e.Code"'),t(),e(1331,`:
                                    e.Description = `),n(1332,"span",61),e(1333,"string"),t(),e(1334,".Format(LockoutErrorMessage, applicationSettings.DefaultLockoutTimeSpanInMinutes, "),n(1335,"span",48),e(1336,'""'),t(),e(1337,`);
                                    `),n(1338,"span",44),e(1339,"break"),t(),e(1340,`;
                            }

                            e.Description = `),n(1341,"span",61),e(1342,"string"),t(),e(1343,`.Format(LockoutErrorMessage, applicationSettings.DefaultLockoutTimeSpanInMinutes, e.Code);
                            errors.Add(e.Code, [e.Description]);
                        });

                        `),n(1344,"span",44),e(1345,"return"),t(),e(1346,` Result<UserResponseEnvelope>.Failure(errors);
                    }

                    `),n(1347,"span",44),e(1348,"return"),t(),e(1349," Result<UserResponseEnvelope>.Failure("),n(1350,"span",44),e(1351,"new"),t(),e(1352," Dictionary<"),n(1353,"span",61),e(1354,"string"),t(),e(1355,", "),n(1356,"span",61),e(1357,"string"),t(),e(1358,`[]>
                {
                    { `),n(1359,"span",48),e(1360,'"invalid_error"'),t(),e(1361,", "),n(1362,"span",44),e(1363,"new"),t(),e(1364,`[] { InvalidErrorMessage } }
                });
                }
            }
            `),n(1365,"span",44),e(1366,"else"),t(),e(1367,`
            {
                `),n(1368,"span",44),e(1369,"if"),t(),e(1370," ("),n(1371,"span",44),e(1372,"this"),t(),e(1373,".env.EnvironmentName == "),n(1374,"span",48),e(1375,'"Test"'),t(),e(1376,`)
                {
                    `),n(1377,"span",44),e(1378,"var"),t(),e(1379," passwordValid = "),n(1380,"span",44),e(1381,"await"),t(),e(1382," "),n(1383,"span",44),e(1384,"this"),t(),e(1385,`.userManager.CheckPasswordAsync(
                     user,
                     userRequest.UserJson.Password);

                    `),n(1386,"span",44),e(1387,"if"),t(),e(1388,` (!passwordValid)
                    {
                        `),n(1389,"span",44),e(1390,"return"),t(),e(1391," Result<UserResponseEnvelope>.Failure("),n(1392,"span",44),e(1393,"new"),t(),e(1394," Dictionary<"),n(1395,"span",61),e(1396,"string"),t(),e(1397,", "),n(1398,"span",61),e(1399,"string"),t(),e(1400,`[]>
                    {
                        { `),n(1401,"span",48),e(1402,'"invalid_error"'),t(),e(1403,", "),n(1404,"span",44),e(1405,"new"),t(),e(1406,`[] { InvalidErrorMessage } }
                    });
                    }
                }
                `),n(1407,"span",44),e(1408,"else"),t(),e(1409,`
                {
                    `),n(1410,"span",44),e(1411,"return"),t(),e(1412," Result<UserResponseEnvelope>.Failure("),n(1413,"span",44),e(1414,"new"),t(),e(1415," Dictionary<"),n(1416,"span",61),e(1417,"string"),t(),e(1418,", "),n(1419,"span",61),e(1420,"string"),t(),e(1421,`[]>
                {
                    { `),n(1422,"span",48),e(1423,'"lockout_enabled_error"'),t(),e(1424,", "),n(1425,"span",44),e(1426,"new"),t(),e(1427,`[] { LockoutEnabledErrorMessage } }
                });
                }
            }

            `),n(1428,"span",61),e(1429,"string"),t(),e(1430,`? token;
            `),n(1431,"span",44),e(1432,"if"),t(),e(1433," ("),n(1434,"span",44),e(1435,"this"),t(),e(1436,".env.EnvironmentName == "),n(1437,"span",48),e(1438,'"Test"'),t(),e(1439,`)
            {
                token = `),n(1440,"span",48),e(1441,'$"Token: '),n(1442,"span",64),e(1443,"{user.Email}"),t(),e(1444,'"'),t(),e(1445,`;
            }
            `),n(1446,"span",44),e(1447,"else"),t(),e(1448,`
            {
                token = isNewToken ? `),n(1449,"span",44),e(1450,"await"),t(),e(1451," "),n(1452,"span",44),e(1453,"this"),t(),e(1454,`.jwtGenerator.GenerateToken(user) :
                `),n(1455,"span",44),e(1456,"this"),t(),e(1457,".httpContextAccessor.HttpContext!.Request.Headers.Authorization.ToString()["),n(1458,"span",48),e(1459,'"Bearer "'),t(),e(1460,`.Length..].Trim();
            }

            `),n(1461,"span",44),e(1462,"return"),t(),e(1463," "),n(1464,"span",44),e(1465,"new"),t(),e(1466,` UserResponseEnvelope
            {
                UserJson = `),n(1467,"span",44),e(1468,"new"),t(),e(1469,`()
                {
                    Email = user.Email!,
                    UserName = user.UserName!,
                    Token = token,
                }
            };
        }
        `),n(1470,"span",46),e(1471,"#"),n(1472,"span",44),e(1473,"endregion"),t()(),e(1474,`

        `),n(1475,"span",46),e(1476,"#"),n(1477,"span",44),e(1478,"region"),t(),e(1479," Update"),t(),e(1480,`
        `),n(1481,"span",44),e(1482,"public"),t(),e(1483," "),n(1484,"span",44),e(1485,"async"),t(),e(1486,` Task<Result<UserResponseEnvelope>> Update(UserUpdateCommand userRequest)
        {
            `),n(1487,"span",44),e(1488,"if"),t(),e(1489," (userRequest.UserJson.FullName == "),n(1490,"span",62),e(1491,"null"),t(),e(1492," && userRequest.UserJson.Password == "),n(1493,"span",62),e(1494,"null"),t(),e(1495,`)
            {
                `),n(1496,"span",44),e(1497,"return"),t(),e(1498," Result<UserResponseEnvelope>.Failure("),n(1499,"span",44),e(1500,"new"),t(),e(1501," Dictionary<"),n(1502,"span",61),e(1503,"string"),t(),e(1504,", "),n(1505,"span",61),e(1506,"string"),t(),e(1507,`[]>
            {
                 { `),n(1508,"span",48),e(1509,'"no_data_error"'),t(),e(1510,", "),n(1511,"span",44),e(1512,"new"),t(),e(1513,`[] { NoDataErrorMessage } }
            });
            }

            `),n(1514,"span",61),e(1515,"bool"),t(),e(1516," isNewToken = "),n(1517,"span",62),e(1518,"false"),t(),e(1519,`;
            ClaimsPrincipal? claimsPrincipal = `),n(1520,"span",44),e(1521,"this"),t(),e(1522,`.httpContextAccessor.HttpContext!.User!;
            `),n(1523,"span",44),e(1524,"if"),t(),e(1525," (claimsPrincipal != "),n(1526,"span",62),e(1527,"null"),t(),e(1528,`)
            {
                `),n(1529,"span",44),e(1530,"var"),t(),e(1531,` isAuthenticated = claimsPrincipal.Identity?.IsAuthenticated;
                `),n(1532,"span",44),e(1533,"if"),t(),e(1534," (isAuthenticated == "),n(1535,"span",62),e(1536,"null"),t(),e(1537," || !("),n(1538,"span",61),e(1539,"bool"),t(),e(1540,`)isAuthenticated)
                {
                    `),n(1541,"span",44),e(1542,"return"),t(),e(1543," Result<UserResponseEnvelope>.Failure("),n(1544,"span",44),e(1545,"new"),t(),e(1546," Dictionary<"),n(1547,"span",61),e(1548,"string"),t(),e(1549,", "),n(1550,"span",61),e(1551,"string"),t(),e(1552,`[]>
                {
                    { `),n(1553,"span",48),e(1554,'"identity_error"'),t(),e(1555,", "),n(1556,"span",44),e(1557,"new"),t(),e(1558,`[] { IdentityErrorMessage } }
                });
                }
                `),n(1559,"span",44),e(1560,"var"),t(),e(1561," iat = claimsPrincipal.FindFirst("),n(1562,"span",48),e(1563,'"iat"'),t(),e(1564,`);
                `),n(1565,"span",44),e(1566,"var"),t(),e(1567," exp = claimsPrincipal.FindFirst("),n(1568,"span",48),e(1569,'"exp"'),t(),e(1570,`);
                `),n(1571,"span",44),e(1572,"if"),t(),e(1573," (iat == "),n(1574,"span",62),e(1575,"null"),t(),e(1576," || exp == "),n(1577,"span",62),e(1578,"null"),t(),e(1579,`)
                {
                    `),n(1580,"span",44),e(1581,"return"),t(),e(1582," Result<UserResponseEnvelope>.Failure("),n(1583,"span",44),e(1584,"new"),t(),e(1585," Dictionary<"),n(1586,"span",61),e(1587,"string"),t(),e(1588,", "),n(1589,"span",61),e(1590,"string"),t(),e(1591,`[]>
                {
                    { `),n(1592,"span",48),e(1593,'"identity_error"'),t(),e(1594,", "),n(1595,"span",44),e(1596,"new"),t(),e(1597,`[] { IdentityErrorMessage } }
                });
                }

                `),n(1598,"span",44),e(1599,"var"),t(),e(1600," rate = ("),n(1601,"span",61),e(1602,"long"),t(),e(1603,".Parse(exp.Value) - "),n(1604,"span",61),e(1605,"long"),t(),e(1606,`.Parse(iat.Value)) * applicationSettings.SecurityTokenRefreshRate;
                `),n(1607,"span",44),e(1608,"var"),t(),e(1609," current = "),n(1610,"span",61),e(1611,"long"),t(),e(1612,`.Parse(exp.Value) - DateTimeOffset.Now.ToUnixTimeSeconds();

                isNewToken = current < rate;
            }
            `),n(1613,"span",44),e(1614,"else"),t(),e(1615,`
            {
                `),n(1616,"span",44),e(1617,"return"),t(),e(1618," Result<UserResponseEnvelope>.Failure("),n(1619,"span",44),e(1620,"new"),t(),e(1621," Dictionary<"),n(1622,"span",61),e(1623,"string"),t(),e(1624,", "),n(1625,"span",61),e(1626,"string"),t(),e(1627,`[]>
            {
                { `),n(1628,"span",48),e(1629,'"identity_error"'),t(),e(1630,", "),n(1631,"span",44),e(1632,"new"),t(),e(1633,`[] { IdentityErrorMessage } }
            });
            }

            `),n(1634,"span",44),e(1635,"if"),t(),e(1636," (userRequest.UserJson.FullName != "),n(1637,"span",62),e(1638,"null"),t(),e(1639,`)
            {
                `),n(1640,"span",44),e(1641,"var"),t(),e(1642," userByName = "),n(1643,"span",44),e(1644,"await"),t(),e(1645," "),n(1646,"span",44),e(1647,"this"),t(),e(1648,`.userManager.FindByNameAsync(userRequest.UserJson.FullName);

                `),n(1649,"span",44),e(1650,"if"),t(),e(1651," (userByName != "),n(1652,"span",62),e(1653,"null"),t(),e(1654,`)
                {
                    `),n(1655,"span",44),e(1656,"return"),t(),e(1657," Result<UserResponseEnvelope>.Failure("),n(1658,"span",44),e(1659,"new"),t(),e(1660," Dictionary<"),n(1661,"span",61),e(1662,"string"),t(),e(1663,", "),n(1664,"span",61),e(1665,"string"),t(),e(1666,`[]>
                {
                    { `),n(1667,"span",48),e(1668,'"name_error"'),t(),e(1669,", "),n(1670,"span",44),e(1671,"new"),t(),e(1672,`[] { UserNameTakenErrorMessage } }
                });
                }
            }

            User? user;
            `),n(1673,"span",44),e(1674,"if"),t(),e(1675," ("),n(1676,"span",44),e(1677,"this"),t(),e(1678,".env.EnvironmentName == "),n(1679,"span",48),e(1680,'"Test"'),t(),e(1681,`)
            {
                `),n(1682,"span",44),e(1683,"var"),t(),e(1684,` name = claimsPrincipal.Identity?.Name;
                `),n(1685,"span",44),e(1686,"if"),t(),e(1687," (name == "),n(1688,"span",62),e(1689,"null"),t(),e(1690,`)
                {
                    `),n(1691,"span",44),e(1692,"return"),t(),e(1693," Result<UserResponseEnvelope>.Failure("),n(1694,"span",44),e(1695,"new"),t(),e(1696," Dictionary<"),n(1697,"span",61),e(1698,"string"),t(),e(1699,", "),n(1700,"span",61),e(1701,"string"),t(),e(1702,`[]>
                {
                    { `),n(1703,"span",48),e(1704,'"debug_error"'),t(),e(1705,", "),n(1706,"span",44),e(1707,"new"),t(),e(1708,`[] { IdentityErrorMessage } }
                });
                }
                user = `),n(1709,"span",44),e(1710,"await"),t(),e(1711," "),n(1712,"span",44),e(1713,"this"),t(),e(1714,`.userManager.FindByEmailAsync(name);
            }
            `),n(1715,"span",44),e(1716,"else"),t(),e(1717,`
            {
                `),n(1718,"span",44),e(1719,"var"),t(),e(1720,` claim = claimsPrincipal.FindFirst(ClaimTypes.NameIdentifier);
                `),n(1721,"span",44),e(1722,"if"),t(),e(1723," (claim == "),n(1724,"span",62),e(1725,"null"),t(),e(1726,`)
                {
                    `),n(1727,"span",44),e(1728,"return"),t(),e(1729," Result<UserResponseEnvelope>.Failure("),n(1730,"span",44),e(1731,"new"),t(),e(1732," Dictionary<"),n(1733,"span",61),e(1734,"string"),t(),e(1735,", "),n(1736,"span",61),e(1737,"string"),t(),e(1738,`[]>
                {
                    { `),n(1739,"span",48),e(1740,'"name_identifier_error"'),t(),e(1741,", "),n(1742,"span",44),e(1743,"new"),t(),e(1744,`[] { IdentityErrorMessage } }
                });
                }
                user = `),n(1745,"span",44),e(1746,"await"),t(),e(1747," "),n(1748,"span",44),e(1749,"this"),t(),e(1750,`.userManager.FindByIdAsync(claim.Value);
            }

            `),n(1751,"span",44),e(1752,"if"),t(),e(1753," (user == "),n(1754,"span",62),e(1755,"null"),t(),e(1756,`)
            {
                `),n(1757,"span",44),e(1758,"return"),t(),e(1759," Result<UserResponseEnvelope>.Failure("),n(1760,"span",44),e(1761,"new"),t(),e(1762," Dictionary<"),n(1763,"span",61),e(1764,"string"),t(),e(1765,", "),n(1766,"span",61),e(1767,"string"),t(),e(1768,`[]>
            {
                { `),n(1769,"span",48),e(1770,'"user_error"'),t(),e(1771,", "),n(1772,"span",44),e(1773,"new"),t(),e(1774,`[] { UserNullErrorMessage } }
            });
            }

            `),n(1775,"span",44),e(1776,"var"),t(),e(1777,` claimRole = claimsPrincipal.FindFirst(ClaimTypes.Role);
            `),n(1778,"span",44),e(1779,"if"),t(),e(1780," (claimRole == "),n(1781,"span",62),e(1782,"null"),t(),e(1783,`)
            {
                `),n(1784,"span",44),e(1785,"return"),t(),e(1786," Result<UserResponseEnvelope>.Failure("),n(1787,"span",44),e(1788,"new"),t(),e(1789," Dictionary<"),n(1790,"span",61),e(1791,"string"),t(),e(1792,", "),n(1793,"span",61),e(1794,"string"),t(),e(1795,`[]>
                {
                    { `),n(1796,"span",48),e(1797,'"is_in_role_error"'),t(),e(1798,", "),n(1799,"span",44),e(1800,"new"),t(),e(1801,"[] { "),n(1802,"span",61),e(1803,"string"),t(),e(1804,".Format(IdentityRoleErrorMessage, "),n(1805,"span",48),e(1806,'""'),t(),e(1807,`) } }
                });
            }
            `),n(1808,"span",44),e(1809,"var"),t(),e(1810," isInRole = "),n(1811,"span",44),e(1812,"await"),t(),e(1813," "),n(1814,"span",44),e(1815,"this"),t(),e(1816,`.userManager.IsInRoleAsync(user, claimRole.Value);
            `),n(1817,"span",44),e(1818,"if"),t(),e(1819,` (!isInRole)
            {
                `),n(1820,"span",44),e(1821,"return"),t(),e(1822," Result<UserResponseEnvelope>.Failure("),n(1823,"span",44),e(1824,"new"),t(),e(1825," Dictionary<"),n(1826,"span",61),e(1827,"string"),t(),e(1828,", "),n(1829,"span",61),e(1830,"string"),t(),e(1831,`[]>
                {
                    { `),n(1832,"span",48),e(1833,'"is_in_role_error"'),t(),e(1834,", "),n(1835,"span",44),e(1836,"new"),t(),e(1837,"[] { "),n(1838,"span",61),e(1839,"string"),t(),e(1840,`.Format(IdentityRoleErrorMessage, claimRole.Value) } }
                });
            }

            `),n(1841,"span",44),e(1842,"if"),t(),e(1843," (userRequest.UserJson.Password != "),n(1844,"span",62),e(1845,"null"),t(),e(1846,`)
            {
                `),n(1847,"span",44),e(1848,"var"),t(),e(1849," identityResult2 = "),n(1850,"span",44),e(1851,"await"),t(),e(1852," "),n(1853,"span",44),e(1854,"this"),t(),e(1855,`.userManager.RemovePasswordAsync(user);

                `),n(1856,"span",44),e(1857,"if"),t(),e(1858,` (!identityResult2.Succeeded)
                {
                    `),n(1859,"span",44),e(1860,"var"),t(),e(1861," errors = "),n(1862,"span",44),e(1863,"new"),t(),e(1864," Dictionary<"),n(1865,"span",61),e(1866,"string"),t(),e(1867,", "),n(1868,"span",61),e(1869,"string"),t(),e(1870,`[]>();
                    identityResult2.Errors.ForEach(e =>
                    {
                        errors.Add(e.Code, [e.Description]);
                    });

                    `),n(1871,"span",44),e(1872,"return"),t(),e(1873,` Result<UserResponseEnvelope>.Failure(errors);
                }

                identityResult2 = `),n(1874,"span",44),e(1875,"await"),t(),e(1876," "),n(1877,"span",44),e(1878,"this"),t(),e(1879,`.userManager.AddPasswordAsync(
                     user,
                     userRequest.UserJson.Password);

                `),n(1880,"span",44),e(1881,"if"),t(),e(1882,` (!identityResult2.Succeeded)
                {
                    `),n(1883,"span",44),e(1884,"var"),t(),e(1885," errors = "),n(1886,"span",44),e(1887,"new"),t(),e(1888," Dictionary<"),n(1889,"span",61),e(1890,"string"),t(),e(1891,", "),n(1892,"span",61),e(1893,"string"),t(),e(1894,`[]>();
                    identityResult2.Errors.ForEach(e =>
                    {
                        `),n(1895,"span",44),e(1896,"switch"),t(),e(1897,` (e.Code)
                        {
                            `),n(1898,"span",44),e(1899,"case"),t(),e(1900," "),n(1901,"span",48),e(1902,'"PasswordRequiresDigit"'),t(),e(1903,`:
                                e.Description = PasswordFormatErrorMessage;
                                `),n(1904,"span",44),e(1905,"break"),t(),e(1906,`;
                        }
                        errors.Add(e.Code, [e.Description]);
                    });
                    errors.Add(`),n(1907,"span",48),e(1908,'"PasswordDeleted"'),t(),e(1909,`, [PasswordDeletedErrorMessage]);
                    `),n(1910,"span",44),e(1911,"return"),t(),e(1912,` Result<UserResponseEnvelope>.Failure(errors);
                }
            }

            `),n(1913,"span",44),e(1914,"if"),t(),e(1915," (userRequest.UserJson.FullName != "),n(1916,"span",62),e(1917,"null"),t(),e(1918,`)
            {
                `),n(1919,"span",44),e(1920,"var"),t(),e(1921," identityResult1 = "),n(1922,"span",44),e(1923,"await"),t(),e(1924," "),n(1925,"span",44),e(1926,"this"),t(),e(1927,`.userManager.SetUserNameAsync(
                     user,
                     userRequest.UserJson.FullName);

                `),n(1928,"span",44),e(1929,"if"),t(),e(1930,` (!identityResult1.Succeeded)
                {
                    `),n(1931,"span",44),e(1932,"var"),t(),e(1933," errors = "),n(1934,"span",44),e(1935,"new"),t(),e(1936," Dictionary<"),n(1937,"span",61),e(1938,"string"),t(),e(1939,", "),n(1940,"span",61),e(1941,"string"),t(),e(1942,`[]>();
                    identityResult1.Errors.ForEach(e =>
                    {
                        `),n(1943,"span",44),e(1944,"switch"),t(),e(1945,` (e.Code)
                        {
                            `),n(1946,"span",44),e(1947,"case"),t(),e(1948," "),n(1949,"span",48),e(1950,'"InvalidUserName"'),t(),e(1951,`:
                                e.Description = UsernameFormatErrorMessage;
                                `),n(1952,"span",44),e(1953,"break"),t(),e(1954,`;
                        }
                        errors.Add(e.Code, [e.Description]);
                    });

                    `),n(1955,"span",44),e(1956,"return"),t(),e(1957,` Result<UserResponseEnvelope>.Failure(errors);
                }
            }

            `),n(1958,"span",61),e(1959,"string"),t(),e(1960,`? token;
            `),n(1961,"span",44),e(1962,"if"),t(),e(1963," ("),n(1964,"span",44),e(1965,"this"),t(),e(1966,".env.EnvironmentName == "),n(1967,"span",48),e(1968,'"Test"'),t(),e(1969,`)
            {
                token = `),n(1970,"span",48),e(1971,'$"Token: '),n(1972,"span",64),e(1973,"{user.Email}"),t(),e(1974,'"'),t(),e(1975,`;
            }
            `),n(1976,"span",44),e(1977,"else"),t(),e(1978,`
            {
                token = isNewToken ? `),n(1979,"span",44),e(1980,"await"),t(),e(1981," "),n(1982,"span",44),e(1983,"this"),t(),e(1984,`.jwtGenerator.GenerateToken(user) :
                `),n(1985,"span",44),e(1986,"this"),t(),e(1987,".httpContextAccessor.HttpContext!.Request.Headers.Authorization.ToString()["),n(1988,"span",48),e(1989,'"Bearer "'),t(),e(1990,`.Length..].Trim();
            }

            `),n(1991,"span",44),e(1992,"return"),t(),e(1993," "),n(1994,"span",44),e(1995,"new"),t(),e(1996,` UserResponseEnvelope
            {
                UserJson = `),n(1997,"span",44),e(1998,"new"),t(),e(1999,`()
                {
                    Email = user.Email!,
                    UserName = user.UserName!,
                    Token = token,
                }
            };
        }
        `),n(2e3,"span",46),e(2001,"#"),n(2002,"span",44),e(2003,"endregion"),t()(),e(2004,`

        `),n(2005,"span",44),e(2006,"public"),t(),e(2007," "),n(2008,"span",44),e(2009,"async"),t(),e(2010," Task<Result<ProfileResponseEnvelope>> Profile("),n(2011,"span",61),e(2012,"string"),t(),e(2013,` userName)
        {
            `),n(2014,"span",44),e(2015,"var"),t(),e(2016," user = "),n(2017,"span",44),e(2018,"await"),t(),e(2019," "),n(2020,"span",44),e(2021,"this"),t(),e(2022,`.userManager.FindByNameAsync(userName);

            `),n(2023,"span",44),e(2024,"if"),t(),e(2025," (user == "),n(2026,"span",62),e(2027,"null"),t(),e(2028,`)
            {
                `),n(2029,"span",44),e(2030,"return"),t(),e(2031," Result<ProfileResponseEnvelope>.Failure("),n(2032,"span",44),e(2033,"new"),t(),e(2034," Dictionary<"),n(2035,"span",61),e(2036,"string"),t(),e(2037,", "),n(2038,"span",61),e(2039,"string"),t(),e(2040,`[]>
                    {
                       { `),n(2041,"span",48),e(2042,'"profile_error"'),t(),e(2043,", "),n(2044,"span",44),e(2045,"new"),t(),e(2046,`[] { ProfileErrorMessage } }
                    }
                );
            }

            `),n(2047,"span",44),e(2048,"return"),t(),e(2049," "),n(2050,"span",44),e(2051,"new"),t(),e(2052,` ProfileResponseEnvelope
            {
                ProfileJson = `),n(2053,"span",44),e(2054,"new"),t(),e(2055,` ProfileResponseModel(user.UserName, user.UserName, user.UserName)
            };

        }

        `),n(2056,"span",44),e(2057,"public"),t(),e(2058," "),n(2059,"span",44),e(2060,"async"),t(),e(2061,` Task<Result<UserResponseEnvelope>> Register(UserRegisterRequestEnvelope userRequest)
        {
            `),n(2062,"span",44),e(2063,"var"),t(),e(2064," userByEmail = "),n(2065,"span",44),e(2066,"await"),t(),e(2067," "),n(2068,"span",44),e(2069,"this"),t(),e(2070,`.userManager.FindByEmailAsync(userRequest.UserJson.Email);

            `),n(2071,"span",44),e(2072,"if"),t(),e(2073," (userByEmail != "),n(2074,"span",62),e(2075,"null"),t(),e(2076,`)
            {
                `),n(2077,"span",44),e(2078,"return"),t(),e(2079," Result<UserResponseEnvelope>.Failure("),n(2080,"span",44),e(2081,"new"),t(),e(2082," Dictionary<"),n(2083,"span",61),e(2084,"string"),t(),e(2085,", "),n(2086,"span",61),e(2087,"string"),t(),e(2088,`[]>
            {
                { `),n(2089,"span",48),e(2090,'"email_error"'),t(),e(2091,", "),n(2092,"span",44),e(2093,"new"),t(),e(2094,`[] { EmailTakenErrorMessage } }
            });
            }

            `),n(2095,"span",44),e(2096,"var"),t(),e(2097," userByName = "),n(2098,"span",44),e(2099,"await"),t(),e(2100," "),n(2101,"span",44),e(2102,"this"),t(),e(2103,`.userManager.FindByNameAsync(userRequest.UserJson.FullName);

            `),n(2104,"span",44),e(2105,"if"),t(),e(2106," (userByName != "),n(2107,"span",62),e(2108,"null"),t(),e(2109,`)
            {
                `),n(2110,"span",44),e(2111,"return"),t(),e(2112," Result<UserResponseEnvelope>.Failure("),n(2113,"span",44),e(2114,"new"),t(),e(2115," Dictionary<"),n(2116,"span",61),e(2117,"string"),t(),e(2118,", "),n(2119,"span",61),e(2120,"string"),t(),e(2121,`[]>
            {
               { `),n(2122,"span",48),e(2123,'"name_error"'),t(),e(2124,", "),n(2125,"span",44),e(2126,"new"),t(),e(2127,`[] { UserNameTakenErrorMessage } }
            });
            }

            `),n(2128,"span",44),e(2129,"if"),t(),e(2130," ("),n(2131,"span",44),e(2132,"this"),t(),e(2133,".env.EnvironmentName == "),n(2134,"span",48),e(2135,'"Test"'),t(),e(2136,`)
            {
                `),n(2137,"span",44),e(2138,"var"),t(),e(2139," user = "),n(2140,"span",44),e(2141,"new"),t(),e(2142,` User(userRequest.UserJson.Email, userRequest.UserJson.FullName);

                `),n(2143,"span",44),e(2144,"var"),t(),e(2145," identityResult = "),n(2146,"span",44),e(2147,"await"),t(),e(2148," "),n(2149,"span",44),e(2150,"this"),t(),e(2151,`.userManager.CreateAsync(
                    user,
                    userRequest.UserJson.Password);

                `),n(2152,"span",44),e(2153,"if"),t(),e(2154,` (!identityResult.Succeeded)
                {
                    `),n(2155,"span",44),e(2156,"var"),t(),e(2157," errors = "),n(2158,"span",44),e(2159,"new"),t(),e(2160," Dictionary<"),n(2161,"span",61),e(2162,"string"),t(),e(2163,", "),n(2164,"span",61),e(2165,"string"),t(),e(2166,`[]>();
                    identityResult.Errors.ForEach(e =>
                    {
                        `),n(2167,"span",44),e(2168,"switch"),t(),e(2169,` (e.Code)
                        {
                            `),n(2170,"span",44),e(2171,"case"),t(),e(2172," "),n(2173,"span",48),e(2174,'"InvalidUserName"'),t(),e(2175,`:
                                e.Description = UsernameFormatErrorMessage;
                                `),n(2176,"span",44),e(2177,"break"),t(),e(2178,`;
                            `),n(2179,"span",44),e(2180,"case"),t(),e(2181," "),n(2182,"span",48),e(2183,'"PasswordRequiresDigit"'),t(),e(2184,`:
                                e.Description = PasswordFormatErrorMessage;
                                `),n(2185,"span",44),e(2186,"break"),t(),e(2187,`;
                        }
                        errors.Add(e.Code, [e.Description]);
                    });

                    `),n(2188,"span",44),e(2189,"return"),t(),e(2190,` Result<UserResponseEnvelope>.Failure(errors);
                }

                `),n(2191,"span",44),e(2192,"var"),t(),e(2193," token = "),n(2194,"span",48),e(2195,'$"Token: '),n(2196,"span",64),e(2197,"{user.Email}"),t(),e(2198,'"'),t(),e(2199,`;

                `),n(2200,"span",44),e(2201,"await"),t(),e(2202," "),n(2203,"span",44),e(2204,"this"),t(),e(2205,".eventDispatcher.Dispatch("),n(2206,"span",44),e(2207,"new"),t(),e(2208,` UserRegisteredEvent(
                    user.Id,
                    userRequest.UserJson.FullName));

                `),n(2209,"span",44),e(2210,"return"),t(),e(2211," "),n(2212,"span",44),e(2213,"new"),t(),e(2214,` UserResponseEnvelope
                {
                    UserJson = `),n(2215,"span",44),e(2216,"new"),t(),e(2217,`()
                    {
                        Email = user.Email!,
                        UserName = user.UserName!,
                        Token = token,
                    }
                };
            }
            `),n(2218,"span",44),e(2219,"else"),t(),e(2220,`
            {
                `),n(2221,"span",44),e(2222,"return"),t(),e(2223," Result<UserResponseEnvelope>.Failure("),n(2224,"span",44),e(2225,"new"),t(),e(2226," Dictionary<"),n(2227,"span",61),e(2228,"string"),t(),e(2229,", "),n(2230,"span",61),e(2231,"string"),t(),e(2232,`[]>
            {
                 { `),n(2233,"span",48),e(2234,'"not_implemented_error"'),t(),e(2235,`, registerNotImplemented }
            });
            }
        }

        `),n(2236,"span",44),e(2237,"public"),t(),e(2238," "),n(2239,"span",44),e(2240,"async"),t(),e(2241,` Task<Result<UserResponseEnvelope>> Login(UserLoginRequestEnvelope userRequest)
        {
            `),n(2242,"span",44),e(2243,"var"),t(),e(2244," user = "),n(2245,"span",44),e(2246,"await"),t(),e(2247," "),n(2248,"span",44),e(2249,"this"),t(),e(2250,`.userManager.FindByEmailAsync(userRequest.UserJson.Email);

            `),n(2251,"span",44),e(2252,"if"),t(),e(2253," (user == "),n(2254,"span",62),e(2255,"null"),t(),e(2256,`)
            {
                `),n(2257,"span",44),e(2258,"return"),t(),e(2259," Result<UserResponseEnvelope>.Failure("),n(2260,"span",44),e(2261,"new"),t(),e(2262," Dictionary<"),n(2263,"span",61),e(2264,"string"),t(),e(2265,", "),n(2266,"span",61),e(2267,"string"),t(),e(2268,`[]>
            {
                { `),n(2269,"span",48),e(2270,'"invalid_error"'),t(),e(2271,", "),n(2272,"span",44),e(2273,"new"),t(),e(2274,`[] { InvalidErrorMessage } }
            });
            }

            `),n(2275,"span",44),e(2276,"var"),t(),e(2277," isLockoutEnabled = "),n(2278,"span",44),e(2279,"await"),t(),e(2280,` userManager.GetLockoutEnabledAsync(user);

            `),n(2281,"span",44),e(2282,"if"),t(),e(2283,` (isLockoutEnabled)
            {
                `),n(2284,"span",44),e(2285,"var"),t(),e(2286," count = "),n(2287,"span",44),e(2288,"await"),t(),e(2289,` userManager.GetAccessFailedCountAsync(user);
                `),n(2290,"span",44),e(2291,"if"),t(),e(2292," (count == applicationSettings.MaxFailedAccessAttempts - "),n(2293,"span",63),e(2294,"1"),t(),e(2295,`)
                {
                    `),n(2296,"span",44),e(2297,"var"),t(),e(2298," endDate = "),n(2299,"span",44),e(2300,"await"),t(),e(2301,` userManager.GetLockoutEndDateAsync(user);
                    `),n(2302,"span",44),e(2303,"var"),t(),e(2304,` currentDate = DateTimeOffset.UtcNow;
                    `),n(2305,"span",44),e(2306,"if"),t(),e(2307,` (endDate > currentDate)
                    {
                        `),n(2308,"span",44),e(2309,"return"),t(),e(2310," Result<UserResponseEnvelope>.Failure("),n(2311,"span",44),e(2312,"new"),t(),e(2313," Dictionary<"),n(2314,"span",61),e(2315,"string"),t(),e(2316,", "),n(2317,"span",61),e(2318,"string"),t(),e(2319,`[]>
                    {
                        { `),n(2320,"span",48),e(2321,'"lockout_error"'),t(),e(2322,", "),n(2323,"span",44),e(2324,"new"),t(),e(2325,"[] {  "),n(2326,"span",61),e(2327,"string"),t(),e(2328,".Format(LockoutErrorMessage, applicationSettings.DefaultLockoutTimeSpanInMinutes,"),n(2329,"span",48),e(2330,'""'),t(),e(2331,`) } }
                    });
                    }
                }

                `),n(2332,"span",44),e(2333,"var"),t(),e(2334," passwordValid = "),n(2335,"span",44),e(2336,"await"),t(),e(2337," "),n(2338,"span",44),e(2339,"this"),t(),e(2340,`.userManager.CheckPasswordAsync(
                user,
                userRequest.UserJson.Password);

                `),n(2341,"span",44),e(2342,"if"),t(),e(2343,` (!passwordValid)
                {
                    `),n(2344,"span",44),e(2345,"var"),t(),e(2346," accessFailed = "),n(2347,"span",44),e(2348,"await"),t(),e(2349," "),n(2350,"span",44),e(2351,"this"),t(),e(2352,`.userManager.AccessFailedAsync(user);
                    `),n(2353,"span",44),e(2354,"if"),t(),e(2355,` (!accessFailed.Succeeded)
                    {
                        `),n(2356,"span",44),e(2357,"var"),t(),e(2358," errors = "),n(2359,"span",44),e(2360,"new"),t(),e(2361," Dictionary<"),n(2362,"span",61),e(2363,"string"),t(),e(2364,", "),n(2365,"span",61),e(2366,"string"),t(),e(2367,`[]>();
                        accessFailed.Errors.ForEach(e =>
                        {
                            `),n(2368,"span",44),e(2369,"switch"),t(),e(2370,` (e.Code)
                            {
                                `),n(2371,"span",44),e(2372,"case"),t(),e(2373," "),n(2374,"span",48),e(2375,'"TODO: need to debug e.Code"'),t(),e(2376,`:
                                    e.Description = `),n(2377,"span",61),e(2378,"string"),t(),e(2379,".Format(LockoutErrorMessage, applicationSettings.DefaultLockoutTimeSpanInMinutes, "),n(2380,"span",48),e(2381,'""'),t(),e(2382,`);
                                    `),n(2383,"span",44),e(2384,"break"),t(),e(2385,`;
                            }

                            e.Description = `),n(2386,"span",61),e(2387,"string"),t(),e(2388,`.Format(LockoutErrorMessage, applicationSettings.DefaultLockoutTimeSpanInMinutes, e.Code);
                            errors.Add(e.Code, [e.Description]);
                        });

                        `),n(2389,"span",44),e(2390,"return"),t(),e(2391,` Result<UserResponseEnvelope>.Failure(errors);
                    }

                    `),n(2392,"span",44),e(2393,"return"),t(),e(2394," Result<UserResponseEnvelope>.Failure("),n(2395,"span",44),e(2396,"new"),t(),e(2397," Dictionary<"),n(2398,"span",61),e(2399,"string"),t(),e(2400,", "),n(2401,"span",61),e(2402,"string"),t(),e(2403,`[]>
                {
                    { `),n(2404,"span",48),e(2405,'"invalid_error"'),t(),e(2406,", "),n(2407,"span",44),e(2408,"new"),t(),e(2409,`[] { InvalidErrorMessage } }
                });
                }
            }
            `),n(2410,"span",44),e(2411,"else"),t(),e(2412,`
            {
                `),n(2413,"span",44),e(2414,"if"),t(),e(2415," ("),n(2416,"span",44),e(2417,"this"),t(),e(2418,".env.EnvironmentName == "),n(2419,"span",48),e(2420,'"Test"'),t(),e(2421,`)
                {
                    `),n(2422,"span",44),e(2423,"var"),t(),e(2424," passwordValid = "),n(2425,"span",44),e(2426,"await"),t(),e(2427," "),n(2428,"span",44),e(2429,"this"),t(),e(2430,`.userManager.CheckPasswordAsync(
                     user,
                     userRequest.UserJson.Password);

                    `),n(2431,"span",44),e(2432,"if"),t(),e(2433,` (!passwordValid)
                    {
                        `),n(2434,"span",44),e(2435,"return"),t(),e(2436," Result<UserResponseEnvelope>.Failure("),n(2437,"span",44),e(2438,"new"),t(),e(2439," Dictionary<"),n(2440,"span",61),e(2441,"string"),t(),e(2442,", "),n(2443,"span",61),e(2444,"string"),t(),e(2445,`[]>
                    {
                        { `),n(2446,"span",48),e(2447,'"invalid_error"'),t(),e(2448,", "),n(2449,"span",44),e(2450,"new"),t(),e(2451,`[] { InvalidErrorMessage } }
                    });
                    }
                }
                `),n(2452,"span",44),e(2453,"else"),t(),e(2454,`
                {
                    `),n(2455,"span",44),e(2456,"return"),t(),e(2457," Result<UserResponseEnvelope>.Failure("),n(2458,"span",44),e(2459,"new"),t(),e(2460," Dictionary<"),n(2461,"span",61),e(2462,"string"),t(),e(2463,", "),n(2464,"span",61),e(2465,"string"),t(),e(2466,`[]>
                {
                    { `),n(2467,"span",48),e(2468,'"lockout_enabled_error"'),t(),e(2469,", "),n(2470,"span",44),e(2471,"new"),t(),e(2472,`[] { LockoutEnabledErrorMessage } }
                });
                }
            }

            `),n(2473,"span",61),e(2474,"string"),t(),e(2475,`? token;
            `),n(2476,"span",44),e(2477,"if"),t(),e(2478," ("),n(2479,"span",44),e(2480,"this"),t(),e(2481,".env.EnvironmentName == "),n(2482,"span",48),e(2483,'"Test"'),t(),e(2484,`)
            {
                token = `),n(2485,"span",48),e(2486,'$"Token: '),n(2487,"span",64),e(2488,"{user.Email}"),t(),e(2489,'"'),t(),e(2490,`;
            }
            `),n(2491,"span",44),e(2492,"else"),t(),e(2493,`
            {
                token = `),n(2494,"span",44),e(2495,"await"),t(),e(2496," "),n(2497,"span",44),e(2498,"this"),t(),e(2499,`.jwtGenerator.GenerateToken(user);
            }
            `),n(2500,"span",44),e(2501,"return"),t(),e(2502," "),n(2503,"span",44),e(2504,"new"),t(),e(2505,` UserResponseEnvelope
            {
                UserJson = `),n(2506,"span",44),e(2507,"new"),t(),e(2508,`()
                {
                    Email = user.Email!,
                    UserName = user.UserName!,
                    Token = token,
                }
            };
        }
    }
}`),t()(),n(2509,"p"),e(2510,"To really appreciate the beauty of MyTested, It must be compared to "),n(2511,"a",65),e(2512,"an alternative"),t(),e(2513,` method of testing. With MyTested library, it is very easy to test against endpoint locations, input data in JSON format and output data.
When it comes to JWT authorization, a big amount of testing consists in testing for invalid JWT tokens:`),t(),n(2514,"ul")(2515,"li")(2516,"code"),e(2517,"Update_user_without_authorization_header_should_fail"),t(),e(2518,"- tests when JWT token is absent"),t(),n(2519,"li")(2520,"code"),e(2521,"Update_user_with_altered_authorization_header_should_fail"),t(),e(2522,"- tests when to a valid JWT token is added one character"),t(),n(2523,"li")(2524,"code"),e(2525,"Update_user_with_malformated_authorization_header_should_fail"),t(),e(2526,"- tests when JWT token has format "),n(2527,"code"),e(2528,"a.b"),t()(),n(2529,"li")(2530,"code"),e(2531,"Update_user_with_fake_authorization_header_should_fail"),t(),e(2532,"- tests when JWT token has correct format "),n(2533,"code"),e(2534,"a.b.c"),t(),e(2535," but random characters"),t(),n(2536,"li")(2537,"code"),e(2538,"Update_user_with_incorrect_authorization_header_key_should_fail"),t(),e(2539,"- tests when JWT token is valid but was encrypted with a different key"),t(),n(2540,"li")(2541,"code"),e(2542,"Update_user_with_expired_authorization_header_should_fail"),t(),e(2543,"- tests when a valid JWT token was expired"),t()(),n(2544,"p"),e(2545,`These are the most common case scenarios to test against an invalid JWT token and must be done just for one controller!
MyTested cannot catch 401 error code directly. We found a workaround by using `),n(2546,"a",66),e(2547,"HeaderAuthorizationException"),t(),e(2548,`
In real life, .NET Core 9 will return a 401-error code. We created a series of tests for testing invalid JWT tokens such as:`),t(),n(2549,"pre",43)(2550,"code"),e(2551,"        ["),n(2552,"span",46),e(2553,"Theory"),t(),e(2554,`]
        [`),n(2555,"span",46),e(2556,"MemberData(nameof(RegisterValidData))"),t(),e(2557,`]
        `),n(2558,"span",47)(2559,"span",44),e(2560,"public"),t(),e(2561," "),n(2562,"span",44),e(2563,"void"),t(),e(2564," "),n(2565,"span",45),e(2566,"Update_user_without_authorization_header_should_fail"),t(),e(2567,"("),n(2568,"span",60),e(2569,`
         `),n(2570,"span",61),e(2571,"string"),t(),e(2572,` fullName,
#pragma warning disable xUnit1026 // Theory methods should use all of their parameters
         `),n(2573,"span",61),e(2574,"string"),t(),e(2575,` email,
#pragma warning restore xUnit1026 // Theory methods should use all of their parameters
         `),n(2576,"span",61),e(2577,"string"),t(),e(2578," password"),t(),e(2579,")"),t(),e(2580,`
        => AssertException<MyTested.AspNetCore.Mvc.Exceptions.RouteAssertionException>(
        () =>
        {
            MyMvc
             .Pipeline()
             .ShouldMap(request => request
                 .WithMethod(HttpMethod.Put)
                 `),n(2581,"span",67),e(2582,"// without WithHeaderAuthorization"),t(),e(2583,`
                 .WithLocation(`),n(2584,"span",48),e(2585,'"api/v1.0/identity/update"'),t(),e(2586,`)
                 .WithJsonBody(
                      `),n(2587,"span",61),e(2588,"string"),t(),e(2589,".Format("),n(2590,"span",48),e(2591,'@"{{""user"":{{""password"":""{0}"",""username"":""{1}""}}}}"'),t(),e(2592,`,
                          `),n(2593,"span",48),e(2594,'$"'),n(2595,"span",64),e(2596,"{password}"),t(),e(2597,'1"'),t(),e(2598,`,
                          `),n(2599,"span",48),e(2600,'$"'),n(2601,"span",64),e(2602,"{fullName}"),t(),e(2603,'1"'),t(),e(2604,`
                      )
                 )
             )
             .To<IdentityController>(c => c.Update(`),n(2605,"span",44),e(2606,"new"),t(),e(2607,` UserUpdateCommand
             {
                 UserJson = `),n(2608,"span",44),e(2609,"new"),t(),e(2610,`()
                 {
                     FullName = `),n(2611,"span",48),e(2612,'$"'),n(2613,"span",64),e(2614,"{fullName}"),t(),e(2615,'1"'),t(),e(2616,`,
                     Password = `),n(2617,"span",48),e(2618,'$"'),n(2619,"span",64),e(2620,"{password}"),t(),e(2621,'1"'),t(),e(2622,`
                 }
             }));
        }, `),n(2623,"span",61),e(2624,"string"),t(),e(2625,".Format(HeaderAuthorizationException.Replace(Environment.NewLine, "),n(2626,"span",48),e(2627,'""'),t(),e(2628,"), "),n(2629,"span",48),e(2630,'"/api/v1.0/identity/update"'),t(),e(2631,", "),n(2632,"span",48),e(2633,'"Update"'),t(),e(2634,", "),n(2635,"span",48),e(2636,'"IdentityController"'),t(),e(2637,"));"),t()(),n(2638,"p"),e(2639,"The full set of tests of "),n(2640,"code"),e(2641,"IdentityController"),t(),e(2642," is on "),n(2643,"a",66),e(2644,"our GitHub repository"),t(),e(2645,"."),t(),n(2646,"h2",68)(2647,"span"),e(2648,"Data Validation with FluentValidation Library"),t(),n(2649,"a",69),e(2650,"#"),t()(),n(2651,"p"),e(2652,"Another change we made to MyTested is adding the possibility of testing data validation. For now, we will give an example of testing using "),n(2653,"a",70),e(2654,"FluentValidation"),t(),e(2655,". Following is an example of testing data validation using modified version of MyTested library:"),t(),n(2656,"pre",43)(2657,"code"),e(2658,"["),n(2659,"span",46),e(2660,"Theory"),t(),e(2661,`]
[`),n(2662,"span",46),e(2663,"InlineData("),n(2664,"span",48),e(2665,'"n"'),t(),e(2666,", "),n(2667,"span",48),e(2668,'"ValidEmail@a.bcde"'),t(),e(2669,", "),n(2670,"span",48),e(2671,'"p"'),t(),e(2672,")"),t(),e(2673,`]
`),n(2674,"span",47)(2675,"span",44),e(2676,"public"),t(),e(2677," "),n(2678,"span",44),e(2679,"void"),t(),e(2680," "),n(2681,"span",45),e(2682,"Update_user_with_bad_input_should_return_validation_errors"),t(),e(2683,"("),n(2684,"span",60),e(2685,`
 `),n(2686,"span",61),e(2687,"string"),t(),e(2688,` fullName,
 `),n(2689,"span",61),e(2690,"string"),t(),e(2691,` email,
 `),n(2692,"span",61),e(2693,"string"),t(),e(2694," password"),t(),e(2695,")"),t(),e(2696,`
=> AssertValidationErrorsException<MyTested.AspNetCore.Mvc.Exceptions.ValidationErrorsAssertionException>(
() =>
{
    MyMvc
     .Pipeline()
     .ShouldMap(request => request
        .WithMethod(HttpMethod.Put)
        .WithHeaderAuthorization(StaticTestData.GetJwtBearerAdministratorRole(email, `),n(2697,"span",63),e(2698,"1"),t(),e(2699,`))
        .WithLocation(`),n(2700,"span",48),e(2701,'"api/v1.0/identity/update"'),t(),e(2702,`)
        .WithJsonBody(
             `),n(2703,"span",61),e(2704,"string"),t(),e(2705,".Format("),n(2706,"span",48),e(2707,'@"{{""user"":{{""password"":""{0}"",""username"":""{1}""}}}}"'),t(),e(2708,`,
                 `),n(2709,"span",48),e(2710,'$"'),n(2711,"span",64),e(2712,"{password}"),t(),e(2713,'"'),t(),e(2714,`,
                 `),n(2715,"span",48),e(2716,'$"'),n(2717,"span",64),e(2718,"{fullName}"),t(),e(2719,'"'),t(),e(2720,`
             )
        )
     )
     .To<IdentityController>(c => c.Update(`),n(2721,"span",44),e(2722,"new"),t(),e(2723,` UserUpdateCommand
     {
         UserJson = `),n(2724,"span",44),e(2725,"new"),t(),e(2726,`()
         {
             FullName = fullName,
             Password = password,
         }
     }))
     .Which(controller => controller
        .WithData(StaticTestData.GetUsers(`),n(2727,"span",63),e(2728,"3"),t(),e(2729,`, email, fullName, password)))
     .ShouldReturn();
}, `),n(2730,"span",44),e(2731,"new"),t(),e(2732," Dictionary<"),n(2733,"span",61),e(2734,"string"),t(),e(2735,", "),n(2736,"span",61),e(2737,"string"),t(),e(2738,`[]>
{
   { `),n(2739,"span",48),e(2740,'"UserJson.Password"'),t(),e(2741,", ["),n(2742,"span",48),e(2743,`"The length of 'User Json Password' must be at least 16 characters. You entered 1 characters."`),t(),e(2744,`] },
   { `),n(2745,"span",48),e(2746,'"UserJson.FullName"'),t(),e(2747,", ["),n(2748,"span",48),e(2749,`"The length of 'User Json Full Name' must be at least 2 characters. You entered 1 characters."`),t(),e(2750,`] },
});`),t()(),n(2751,"p"),e(2752,"As you can see, now we can test data validation against the validation errors coming from FluentValidation library. Following are "),n(2753,"a",71),e(2754,"three tests"),t(),e(2755," witch test against the constraint that the tag name is unique:"),t(),n(2756,"ul")(2757,"li")(2758,"code"),e(2759,"Create_tag_with_same_name_should_fail_with_validation_error"),t(),e(2760,"- Creates tag with name when the name has already taken."),t(),n(2761,"li")(2762,"code"),e(2763,"Edit_tag_with_same_name_should_fail_with_validation_error"),t(),e(2764,"- Updates tag name when the name has already taken."),t(),n(2765,"li")(2766,"code"),e(2767,"Edit_same_tag_with_same_name_should_return_success_with_data"),t(),e(2768,"- Updates tag name when the name did not change."),t()(),n(2769,"p"),e(2770,"Sometimes, we need to validate against standard .Net services. For example, in the "),n(2771,"code"),e(2772,"IdentityService"),t(),e(2773," from above we have:"),t(),n(2774,"pre",43)(2775,"code"),e(2776,`\u2026
`),n(2777,"span",44),e(2778,"if"),t(),e(2779," (userRequest.UserJson.FullName != "),n(2780,"span",62),e(2781,"null"),t(),e(2782,`)
{
    `),n(2783,"span",44),e(2784,"var"),t(),e(2785," identityResult1 = "),n(2786,"span",44),e(2787,"await"),t(),e(2788," "),n(2789,"span",44),e(2790,"this"),t(),e(2791,`.userManager.SetUserNameAsync(
         user,
         userRequest.UserJson.FullName);

    `),n(2792,"span",44),e(2793,"if"),t(),e(2794,` (!identityResult1.Succeeded)
    {
        `),n(2795,"span",44),e(2796,"var"),t(),e(2797," errors = "),n(2798,"span",44),e(2799,"new"),t(),e(2800," Dictionary<"),n(2801,"span",61),e(2802,"string"),t(),e(2803,", "),n(2804,"span",61),e(2805,"string"),t(),e(2806,`[]>();
        identityResult1.Errors.ForEach(e =>
        {
            `),n(2807,"span",44),e(2808,"switch"),t(),e(2809,` (e.Code)
            {
                `),n(2810,"span",44),e(2811,"case"),t(),e(2812," "),n(2813,"span",48),e(2814,'"InvalidUserName"'),t(),e(2815,`:
                    e.Description = UsernameFormatErrorMessage;
                    `),n(2816,"span",44),e(2817,"break"),t(),e(2818,`;
            }
            errors.Add(e.Code, `),n(2819,"span",44),e(2820,"new"),t(),e(2821,`[] { e.Description });
        });

        `),n(2822,"span",44),e(2823,"return"),t(),e(2824,` Result<UserResponseEnvelope>.Failure(errors);
    }
}
\u2026`),t()(),n(2825,"p")(2826,"a",72),e(2827,"Here"),t(),e(2828," is the test:"),t(),n(2829,"ul")(2830,"li")(2831,"code"),e(2832,"Update_user_with_incorrect_user_name_should_fail"),t(),e(2833,"- Tests against the username implemented in "),n(2834,"code"),e(2835,"UserManager<User>"),t(),e(2836,"."),t()(),n(2837,"h2",73)(2838,"span"),e(2839,"Conclusion"),t(),n(2840,"a",74),e(2841,"#"),t()(),n(2842,"p"),e(2843,"In this article, we gave a common example of a .NET Core "),n(2844,"code"),e(2845,"Identity"),t(),e(2846," controller, implemented a common "),n(2847,"code"),e(2848,"User Identity"),t(),e(2849," service based on "),n(2850,"code"),e(2851,"UserManager<User>"),t(),e(2852,", and showed a comprehensive "),n(2853,"code"),e(2854,"Identity"),t(),e(2855," controller testing using MyTested library. From multiple examples, we can see how easy is to test against endpoint locations, input data as JSON strings, and output data. In addition, we showed a lot of examples for data validation against the validation errors coming from "),n(2856,"code"),e(2857,"FluentValidation"),t(),e(2858,` library.
It is important to note, that having a detailed testing of API controllers based on MyTested library, gives us the possibility to debug .NET Core applications in Visual Studio 2022. For example, we can set a breakpoint in our application, go to test panel, find a MyTested test, and click Debug instead on Run.
The Markdown version of this article and the compiled code of our .NET Core 9 application can be found on `),n(2859,"a",35),e(2860,"our GitHub repository"),t(),e(2861,"."),t(),n(2862,"h2",75)(2863,"span"),e(2864,"Credits"),t(),n(2865,"a",76),e(2866,"#"),t()(),n(2867,"ul")(2868,"li")(2869,"a",77),e(2870,"Ivaylo Kenov"),t()(),n(2871,"li")(2872,"a",78),e(2873,"Kalin Tsenkov"),t()(),n(2874,"li")(2875,"a",79),e(2876,"Steve Smith"),t()(),n(2877,"li")(2878,"a",80),e(2879,"Jason Taylor"),t()(),n(2880,"li")(2881,"a",81),e(2882,"Stefan Prodan"),t()(),n(2883,"li")(2884,"a",82),e(2885,"Mark Cilia Vincenti"),t()(),n(2886,"li")(2887,"a",83),e(2888,"Jimmy Bogard"),t()(),n(2889,"li")(2890,"a",84),e(2891,"Ben Morris"),t()()(),kt(),t()()()),l&2&&(m(),c("nzBordered",!0),m(6),c("nzOffsetTop",45),m(6),V("ngModel",r.enableNavigation),c("ngModelOptions",W(7,yi)),m(),c("nzOffsetTop",63)("nzAffix",!1)("nzShow",r.enableNavigation))},dependencies:[ee,X,$,xe,q,ce,ae,ie,ne,te,P,D,B,M,A,L,I,R,O,F,H,N,Q,J,le,re,de],encapsulation:2,changeDetection:0})}return a})();var ki=()=>({standalone:!0});function vi(a,s){if(a&1){let i=_();f(0),n(1,"a",67),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",68),d(3,"nz-icon",69),t()(),w()}}function Ai(a,s){if(a&1){let i=_();f(0),n(1,"a",67),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",68),e(3,"Alexei Cioina's blog"),t()(),w()}}var jn=(()=>{class a{router=x(Z);#e=x(G);viewPort=x(Y);zone=x(se);mermaidImport=x(pe,{optional:!0});mermaid;isMermaid=!1;enableNavigation=this.#e.selectors.isSwitcher();constructor(){this.isMermaid&&this.mermaidImport&&this.loadMermaid(this.mermaidImport)}ngAfterViewChecked(){this.isMermaid&&this.mermaid&&(this.isMermaid=!1,this.zone.runOutsideAngular(()=>this.mermaid?.default.run()))}loadMermaid(i){this.zone.runOutsideAngular(()=>oe(i).pipe(me()).subscribe(l=>{this.mermaid=l,this.mermaid.default.initialize({startOnLoad:!1}),this.mermaid?.default.run()}))}clickLink(){this.#e.selectors.isAdminArticles()?this.router.navigate(["admin","articles"]):this.router.navigate(["articles"])}disableEnable(){this.#e.setSwitcher(this.enableNavigation)}goLink(i){window&&(window.location.hash=i)}scrollTop(){window&&(window.location.hash=""),this.viewPort.scrollToPosition([0,0])}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-blog-about-this-blog"]],decls:480,vars:8,consts:[[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","start"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],[1,"toc-affix",3,"nzOffsetTop"],["nz-row","","nzJustify","end"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzSize","small",3,"ngModelChange","ngModel","ngModelOptions"],["nzShowInkInFixed","",3,"nzClick","nzOffsetTop","nzAffix","nzShow"],["nzHref","#h-375bae56","nzTitle","Generate Posts from Markdown Files"],["nzHref","#h-9ee0998d","nzTitle","Generate Static Syntax Highlighting"],["nzHref","#h-ae84e8a9","nzTitle","Deploy to a Cloud Platform"],["nzHref","#h-0ac07f26","nzTitle","Simulate Static Content"],["nzHref","#h-3d814a59","nzTitle","Markdown Extension"],["nzHref","#h-d748b3e2","nzTitle","Blog Listing"],[1,"markdown-title"],[1,"subtitle"],[1,"widget"],["aria-label","Edit this page on Github","href","https://github.com/cioina/cioina.azurewebsites.net/edit/main/blog/20241008-about-this-blog.md","target","_blank","rel","noopener noreferrer",1,"edit-button"],["nzType","edit"],[1,"markdown"],[1,"pic-plus"],["nz-icon","","nzType","custom:zorro","nzWidth","180px","nzHeight","180px"],["nz-icon","","nzType","custom:angular","nzWidth","180px","nzHeight","180px"],["nz-icon","","nzType","custom:ng-zorro","nzWidth","180px","nzHeight","180px"],["id","h-375bae56"],["onclick","window.location.hash = 'h-375bae56'",1,"anchor"],["href","https://github.com/cioina/alexei-cioina.b9ad.pro-us-east-1.openshiftapps.com/tree/main/posts","target","_blank","rel","noopener"],["id","h-9ee0998d"],["onclick","window.location.hash = 'h-9ee0998d'",1,"anchor"],[1,"language-javascript"],[1,"hljs-keyword"],[1,"hljs-built_in"],[1,"hljs-string"],[1,"hljs-title","function_"],[1,"hljs-params"],[1,"hljs-function"],[1,"hljs-literal"],[1,"hljs-title","class_"],[1,"hljs-regexp"],[1,"hljs-variable","language_"],[1,"hljs-property"],["id","h-ae84e8a9"],["onclick","window.location.hash = 'h-ae84e8a9'",1,"anchor"],["href","https://www.openshift.com/products/online/","target","_blank","rel","noopener"],["href","https://docs.openshift.com/container-platform/3.11/architecture/core_concepts/builds_and_image_streams.html#source-build","target","_blank","rel","noopener"],["href","https://docs.openshift.com/container-platform/3.11/dev_guide/deployments/deployment_strategies.html#recreate-strategy","target","_blank","rel","noopener"],["id","h-0ac07f26"],["onclick","window.location.hash = 'h-0ac07f26'",1,"anchor"],["href","https://github.com/dwightwatson/dwightwatson.com","target","_blank","rel","noopener"],["href","https://github.com/dwightwatson/neontsunami-laravel","target","_blank","rel","noopener"],["href","https://github.com/dwightwatson/neontsunami-laravel/blob/master/resources/views/posts/show.blade.php","target","_blank","rel","noopener"],["href","https://github.com/cioina/neontsunami","target","_blank","rel","noopener"],["href","https://laravel.com/docs/8.x/octane","target","_blank","rel","noopener"],["id","h-3d814a59"],["onclick","window.location.hash = 'h-3d814a59'",1,"anchor"],[1,"language-html"],[1,"hljs-tag"],[1,"hljs-name"],[1,"hljs-attr"],["href","https://mdxjs.com/","target","_blank","rel","noopener"],["id","h-d748b3e2"],["onclick","window.location.hash = 'h-d748b3e2'",1,"anchor"],["href","https://github.com/AndyT2503/angular-conduit-signals","target","_blank","rel","noopener"],["href","https://github.com/alexeymezenin/laravel-realworld-example-app","target","_blank","rel","noopener"],[3,"click"],["nz-typography","","nzType","success"],["nzType","arrow-left"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"nz-card",1)(2,"div",2)(3,"div",3)(4,"nz-space",4),g(5,vi,4,0,"ng-container",5)(6,Ai,4,0,"ng-container",5),t()()(),n(7,"nz-affix",6)(8,"div",7)(9,"div",3)(10,"a",8),h("click",function(){return r.scrollTop()}),e(11,"Jump to top"),t()(),n(12,"div",3)(13,"nz-switch",9),j("ngModelChange",function(S){return U(r.enableNavigation,S)||(r.enableNavigation=S),S}),h("ngModelChange",function(){return r.disableEnable()}),t()()(),n(14,"nz-anchor",10),h("nzClick",function(S){return r.goLink(S)}),d(15,"nz-link",11)(16,"nz-link",12)(17,"nz-link",13)(18,"nz-link",14)(19,"nz-link",15)(20,"nz-link",16),t()(),n(21,"span",17),e(22," About This Blog"),d(23,"span",18)(24,"span",19),n(25,"a",20),d(26,"nz-icon",21),t()(),n(27,"article",22)(28,"div",23),d(29,"span",24),n(30,"span"),e(31,"+"),t(),d(32,"span",25),n(33,"span"),e(34,"="),t(),d(35,"span",26),t(),n(36,"p"),e(37,"Here we've built a blog that is able to:"),t(),n(38,"ul")(39,"li"),e(40,"Generate posts from markdown files"),t(),n(41,"li"),e(42,"Generate static syntax highlighting"),t(),n(43,"li"),e(44,"Deploy to a cloud platform"),t(),n(45,"li"),e(46,"Simulate static content"),t()(),n(47,"h2",27)(48,"span"),e(49,"Generate Posts from Markdown Files"),t(),n(50,"a",28),e(51,"#"),t()(),n(52,"p"),e(53,"We use a "),n(54,"code"),e(55,"ng-zorro-antd"),t(),e(56," Node.js script to generate compiled Angular modules from "),n(57,"a",29),e(58,"a set of markdown files"),t(),e(59,`.
Each post represents a compiled JavaScrip file that loads via lazy-loading. The content of a markdown file is included into compiled Angular module witch is smaller than a generated static HTML.`),t(),n(60,"h2",30)(61,"span"),e(62,"Generate Static Syntax Highlighting"),t(),n(63,"a",31),e(64,"#"),t()(),n(65,"p"),e(66,"To generate static syntax highlighting (which is static HTML,) we use "),n(67,"code"),e(68,"prismjs"),t(),e(69," on Node.js. This way, we do not need to include "),n(70,"code"),e(71,"prismjs"),t(),e(72," JavaScript in our web application."),t(),n(73,"pre",32)(74,"code")(75,"span",33),e(76,"const"),t(),e(77," fs = "),n(78,"span",34),e(79,"require"),t(),e(80,"("),n(81,"span",35),e(82,"'fs'"),t(),e(83,`);
`),n(84,"span",33),e(85,"const"),t(),e(86," path = "),n(87,"span",34),e(88,"require"),t(),e(89,"("),n(90,"span",35),e(91,"'path'"),t(),e(92,`);

`),n(93,"span",33),e(94,"function"),t(),e(95," "),n(96,"span",36),e(97,"uniq"),t(),e(98,"("),n(99,"span",37),e(100,"arr"),t(),e(101,`) {
  `),n(102,"span",33),e(103,"const"),t(),e(104," set = arr."),n(105,"span",36),e(106,"reduce"),t(),e(107,"("),n(108,"span",38),e(109,"("),n(110,"span",37),e(111,"set, item"),t(),e(112,") =>"),t(),e(113,` {
    set[item] = `),n(114,"span",39),e(115,"true"),t(),e(116,`;
    `),n(117,"span",33),e(118,"return"),t(),e(119,` set;
  }, {});
  `),n(120,"span",33),e(121,"return"),t(),e(122," "),n(123,"span",40),e(124,"Object"),t(),e(125,"."),n(126,"span",36),e(127,"keys"),t(),e(128,`(set);
}

`),n(129,"span",33),e(130,"const"),t(),e(131," prismCore = "),n(132,"span",35),e(133,"'../../node-prismjs/components/prism-core.js'"),t(),e(134,`;
`),n(135,"span",33),e(136,"const"),t(),e(137," "),n(138,"span",40),e(139,"Prism"),t(),e(140," = "),n(141,"span",34),e(142,"require"),t(),e(143,`(prismCore);

`),n(144,"span",33),e(145,"const"),t(),e(146,` prelude = [
  `),n(147,"span",35),e(148,"'prism-markup'"),t(),e(149,`,
  `),n(150,"span",35),e(151,"'prism-css'"),t(),e(152,`,
  `),n(153,"span",35),e(154,"'prism-clike'"),t(),e(155,`,
  `),n(156,"span",35),e(157,"'prism-javascript'"),t(),e(158,`,
  `),n(159,"span",35),e(160,"'prism-css-extras'"),t(),e(161,`,
  `),n(162,"span",35),e(163,"'prism-json'"),t(),e(164,`,
  `),n(165,"span",35),e(166,"'prism-markup-templating'"),t(),e(167,`,
  `),n(168,"span",35),e(169,"'prism-php'"),t(),e(170,`,
  `),n(171,"span",35),e(172,"'prism-php-extras'"),t(),e(173,`,
  `),n(174,"span",35),e(175,"'prism-typescript'"),t(),e(176,`,
];

`),n(177,"span",33),e(178,"const"),t(),e(179," prismComponents = path."),n(180,"span",36),e(181,"dirname"),t(),e(182,"("),n(183,"span",34),e(184,"require"),t(),e(185,"."),n(186,"span",36),e(187,"resolve"),t(),e(188,`(prismCore));
`),n(189,"span",33),e(190,"const"),t(),e(191,` components = prelude
  .`),n(192,"span",36),e(193,"concat"),t(),e(194,"(fs."),n(195,"span",36),e(196,"readdirSync"),t(),e(197,`(prismComponents))
  .`),n(198,"span",36),e(199,"map"),t(),e(200,"("),n(201,"span",38)(202,"span",37),e(203,"component"),t(),e(204," =>"),t(),e(205," component."),n(206,"span",36),e(207,"replace"),t(),e(208,"("),n(209,"span",41),e(210,"/(\\.min)?\\.js$/"),t(),e(211,", "),n(212,"span",35),e(213,"''"),t(),e(214,`));

`),n(215,"span",33),e(216,"const"),t(),e(217," componentsSet = "),n(218,"span",36),e(219,"uniq"),t(),e(220,`(components);
componentsSet.`),n(221,"span",36),e(222,"forEach"),t(),e(223,"("),n(224,"span",38)(225,"span",37),e(226,"component"),t(),e(227," =>"),t(),e(228,` {
  `),n(229,"span",34),e(230,"require"),t(),e(231,"(path."),n(232,"span",36),e(233,"join"),t(),e(234,`(prismComponents, component));
});

`),n(235,"span",42),e(236,"module"),t(),e(237,"."),n(238,"span",43),e(239,"exports"),t(),e(240," = "),n(241,"span",40),e(242,"Prism"),t(),e(243,";"),t()(),n(244,"h2",44)(245,"span"),e(246,"Deploy to a Cloud Platform"),t(),n(247,"a",45),e(248,"#"),t()(),n(249,"p"),e(250,"We use Red Hat "),n(251,"a",46),e(252,"OpenShift Online"),t(),e(253,` public cloud
with `),n(254,"a",47),e(255,"Source-to-Image"),t(),e(256,` (S2I) build
and `),n(257,"a",48),e(258,"Recreate Strategy"),t(),e(259," with less than 60 seconds downtime."),t(),n(260,"h2",49)(261,"span"),e(262,"Simulate Static Content"),t(),n(263,"a",50),e(264,"#"),t()(),n(265,"p"),e(266,"We've found "),n(267,"a",51),e(268,"a GitHub repository"),t(),e(269,` that satisfies all 4 conditions. Well, in fact, it generates a static website, so condition 4 is not
just simulated. In contrast, `),n(270,"a",52),e(271,"this GitHub repository"),t(),e(272,` uses Laravel's Blade template and a MySQL database to
`),n(273,"a",53),e(274,"generate posts"),t(),e(275,` on the server-side. It means that every time you access a post,
your web browser makes a request to the server and the server will get the content from the database and render HTML (BTW, `),n(276,"a",54),e(277,"here"),t(),e(278," is a version adapted for OpenShift.) Even if Blade caches the result, every request creates a connection to the database (We do not consider "),n(279,"a",55),e(280,"Laravel Octane"),t(),e(281," here.) Static websites do not need a database and the content is cached on the user's side. So, the user makes less requests to the server."),t(),n(282,"p"),e(283,"How do we simulate static content? All posts from this blog are Angular compiled JavaScript files that are cached on the user's side."),t(),n(284,"h2",56)(285,"span"),e(286,"Markdown Extension"),t(),n(287,"a",57),e(288,"#"),t()(),n(289,"p"),e(290,"While transforming a markdown file into an Angular component and module, we implemented a markdown extension that will create a navigation menue from all heading lines of a markdown file. In addition, we implemented the posibility to include a code block with a special name "),n(291,"code"),e(292,"angular-template-block"),t(),e(293," to be iterpreded as a part of the Angular template. The code block below, will be included in the generated Angular component as a parth of the template."),t(),n(294,"pre",58)(295,"code")(296,"span",59),e(297,"<"),n(298,"span",60),e(299,"div"),t(),e(300," "),n(301,"span",61),e(302,"class"),t(),e(303,"="),n(304,"span",35),e(305,'"pic-plus"'),t(),e(306,">"),t(),e(307,`
  `),n(308,"span",59),e(309,"<"),n(310,"span",60),e(311,"span"),t(),e(312," "),n(313,"span",61),e(314,"nz-icon"),t(),e(315," "),n(316,"span",61),e(317,"nzType"),t(),e(318,"="),n(319,"span",35),e(320,'"custom:zorro"'),t(),e(321," "),n(322,"span",61),e(323,"nzWidth"),t(),e(324,"="),n(325,"span",35),e(326,'"180px"'),t(),e(327," "),n(328,"span",61),e(329,"nzHeight"),t(),e(330,"="),n(331,"span",35),e(332,'"180px"'),t(),e(333,">"),t(),n(334,"span",59),e(335,"</"),n(336,"span",60),e(337,"span"),t(),e(338,">"),t(),e(339,`
  `),n(340,"span",59),e(341,"<"),n(342,"span",60),e(343,"span"),t(),e(344,">"),t(),e(345,"+"),n(346,"span",59),e(347,"</"),n(348,"span",60),e(349,"span"),t(),e(350,">"),t(),e(351,`
  `),n(352,"span",59),e(353,"<"),n(354,"span",60),e(355,"span"),t(),e(356," "),n(357,"span",61),e(358,"nz-icon"),t(),e(359," "),n(360,"span",61),e(361,"nzType"),t(),e(362,"="),n(363,"span",35),e(364,'"custom:angular"'),t(),e(365," "),n(366,"span",61),e(367,"nzWidth"),t(),e(368,"="),n(369,"span",35),e(370,'"180px"'),t(),e(371," "),n(372,"span",61),e(373,"nzHeight"),t(),e(374,"="),n(375,"span",35),e(376,'"180px"'),t(),e(377,">"),t(),n(378,"span",59),e(379,"</"),n(380,"span",60),e(381,"span"),t(),e(382,">"),t(),e(383,`
  `),n(384,"span",59),e(385,"<"),n(386,"span",60),e(387,"span"),t(),e(388,">"),t(),e(389,"="),n(390,"span",59),e(391,"</"),n(392,"span",60),e(393,"span"),t(),e(394,">"),t(),e(395,`
  `),n(396,"span",59),e(397,"<"),n(398,"span",60),e(399,"span"),t(),e(400,`
    `),n(401,"span",61),e(402,"nz-icon"),t(),e(403,`
    `),n(404,"span",61),e(405,"nzType"),t(),e(406,"="),n(407,"span",35),e(408,'"custom:ng-zorro"'),t(),e(409,`
    `),n(410,"span",61),e(411,"nzWidth"),t(),e(412,"="),n(413,"span",35),e(414,'"180px"'),t(),e(415,`
    `),n(416,"span",61),e(417,"nzHeight"),t(),e(418,"="),n(419,"span",35),e(420,'"180px"'),t(),e(421,`
  >`),t(),n(422,"span",59),e(423,"</"),n(424,"span",60),e(425,"span"),t(),e(426,">"),t(),e(427,`
`),n(428,"span",59),e(429,"</"),n(430,"span",60),e(431,"div"),t(),e(432,">"),t()()(),n(433,"p"),e(434,"For more complex markdown format extensions, please visit "),n(435,"a",62),e(436,"MDX 2!"),t()(),n(437,"h2",63)(438,"span"),e(439,"Blog Listing"),t(),n(440,"a",64),e(441,"#"),t()(),n(442,"p"),e(443,"Client-side listing api is based on "),n(444,"a",65),e(445,"this GitHub repository"),t(),e(446," and server-side is similar to "),n(447,"a",66),e(448,"this GitHub repository"),t()(),n(449,"p"),e(450,"As you can see, we use a lot of "),n(451,"code"),e(452,"ng-zorro-antd"),t(),e(453," Angular components:"),t(),n(454,"ul")(455,"li")(456,"code"),e(457,"nz-list"),t(),e(458,", "),n(459,"code"),e(460,"nz-pagination"),t(),e(461,", "),n(462,"code"),e(463,"nz-image"),t(),e(464,", "),n(465,"code"),e(466,"nz-transfer"),t(),e(467,", "),n(468,"code"),e(469,"nz-select"),t(),e(470,", "),n(471,"code"),e(472,"nz-table"),t(),e(473,", and more"),t(),n(474,"li")(475,"code"),e(476,"NzDrawerService"),t(),e(477,", "),n(478,"code"),e(479,"NzDrawerRef"),t()()()()()()),l&2&&(m(),c("nzBordered",!0),m(6),c("nzOffsetTop",45),m(6),V("ngModel",r.enableNavigation),c("ngModelOptions",W(7,ki)),m(),c("nzOffsetTop",63)("nzAffix",!1)("nzShow",r.enableNavigation))},dependencies:[ee,X,$,xe,q,ce,ae,ie,ne,te,P,D,B,M,A,L,I,R,O,F,H,N,Q,J,le,re,de],encapsulation:2,changeDetection:0})}return a})();var Mi=()=>({standalone:!0});function Ni(a,s){if(a&1){let i=_();f(0),n(1,"a",94),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",95),d(3,"nz-icon",96),t()(),w()}}function Ii(a,s){if(a&1){let i=_();f(0),n(1,"a",94),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",95),e(3,"Alexei Cioina's blog"),t()(),w()}}var Wn=(()=>{class a{router=x(Z);#e=x(G);viewPort=x(Y);zone=x(se);mermaidImport=x(pe,{optional:!0});mermaid;isMermaid=!1;enableNavigation=this.#e.selectors.isSwitcher();constructor(){this.isMermaid&&this.mermaidImport&&this.loadMermaid(this.mermaidImport)}ngAfterViewChecked(){this.isMermaid&&this.mermaid&&(this.isMermaid=!1,this.zone.runOutsideAngular(()=>this.mermaid?.default.run()))}loadMermaid(i){this.zone.runOutsideAngular(()=>oe(i).pipe(me()).subscribe(l=>{this.mermaid=l,this.mermaid.default.initialize({startOnLoad:!1}),this.mermaid?.default.run()}))}clickLink(){this.#e.selectors.isAdminArticles()?this.router.navigate(["admin","articles"]):this.router.navigate(["articles"])}disableEnable(){this.#e.setSwitcher(this.enableNavigation)}goLink(i){window&&(window.location.hash=i)}scrollTop(){window&&(window.location.hash=""),this.viewPort.scrollToPosition([0,0])}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-blog-test-readme"]],decls:437,vars:8,consts:[[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","start"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],[1,"toc-affix",3,"nzOffsetTop"],["nz-row","","nzJustify","end"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzSize","small",3,"ngModelChange","ngModel","ngModelOptions"],["nzShowInkInFixed","",3,"nzClick","nzOffsetTop","nzAffix","nzShow"],["nzHref","#h-0b79795d","nzTitle","Introduction"],["nzHref","#h-5a486561","nzTitle","MyTested Library Out of The Box"],["nzHref","#h-dacb62dd","nzTitle","Basic API Controller Testing"],["nzHref","#h-3505cd43","nzTitle","Data Validation with FluentValidation Library"],["nzHref","#h-adda9d19","nzTitle","Exception Testing"],["nzHref","#h-7aa876f0","nzTitle","Identity Controller Testing"],["nzHref","#h-dde4549b","nzTitle","Advanced Testing with MyTested Library"],["nzHref","#h-ff4316b6","nzTitle","MyTested Library Limitations"],["nzHref","#h-948a2e35","nzTitle","Credits"],[1,"markdown-title"],[1,"subtitle"],[1,"widget"],["aria-label","Edit this page on Github","href","https://github.com/cioina/cioina.azurewebsites.net/edit/main/blog/20241009-test-readme.md","target","_blank","rel","noopener noreferrer",1,"edit-button"],["nzType","edit"],[1,"markdown"],["id","h-0b79795d"],["onclick","window.location.hash = 'h-0b79795d'",1,"anchor"],["href","https://github.com/cioina/cioina.azurewebsites.net","target","_blank","rel","noopener"],["href","https://github.com/ivaylokenov/MyTested.AspNetCore.Mvc","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov/BookStore","target","_blank","rel","noopener"],["id","h-5a486561"],["onclick","window.location.hash = 'h-5a486561'",1,"anchor"],["href","https://github.com/kalintsenkov/BlazorShop/blob/master/src/BlazorShop.Tests/Controllers/AddressesControllerTests.cs","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov/BlazorShop/blob/master/src/BlazorShop.Web/Server/Infrastructure/Extensions/ServiceCollectionExtensions.cs","target","_blank","rel","noopener"],["href","https://github.com/gothinkster/aspnetcore-realworld-example-app/blob/master/src/Conduit/ServicesExtensions.cs","target","_blank","rel","noopener"],["href","https://github.com/EdiWang/Edi.AspNetCore.Jwt/blob/master/src/Edi.AspNetCore.Jwt/DefaultJwtAuthManager.cs","target","_blank","rel","noopener"],["href","https://github.com/ivaylokenov/MyTested.AspNetCore.Mvc/tree/development/samples/MusicStore/MusicStore.Test","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Routing/FrontEndRouteTest.cs","target","_blank","rel","noopener"],[1,"language-csharp"],[1,"hljs-keyword"],[1,"hljs-title"],[1,"hljs-meta"],[1,"hljs-function"],[1,"hljs-string"],["id","h-dacb62dd"],["onclick","window.location.hash = 'h-dacb62dd'",1,"anchor"],["href","https://github.com/jasontaylordev/CleanArchitecture/blob/main/src/Web/Endpoints/TodoLists.cs","target","_blank","rel","noopener"],["href","https://github.com/EdiWang/Moonglade/blob/master/src/Moonglade.Web/Controllers/TagsController.cs","target","_blank","rel","noopener"],["href","https://github.com/gothinkster/aspnetcore-realworld-example-app/blob/master/src/Conduit/Features/Tags/TagsController.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Web/Web/Features/TagsController.cs","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev/CleanArchitecture/blob/main/src/Web/Web.csproj","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/specification.json","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Routing/TagsControllerRouteTest.cs","target","_blank","rel","noopener"],["id","h-3505cd43"],["onclick","window.location.hash = 'h-3505cd43'",1,"anchor"],["href","https://github.com/kalintsenkov/BookStore/blob/main/src/Server/BookStore.Application/Catalog/Authors/Commands/Create/AuthorCreateCommandValidator.Specs.cs","target","_blank","rel","noopener"],["href","https://github.com/gothinkster/aspnetcore-realworld-example-app/blob/master/tests/Conduit.IntegrationTests/Features/Articles/EditTests.cs","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev/CleanArchitecture/blob/main/tests/Application.UnitTests/Common/Exceptions/ValidationExceptionTests.cs","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev/CleanArchitecture/blob/main/tests/Web.AcceptanceTests/StepDefinitions/LoginStepDefinitions.cs","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov/BookStore/blob/main/src/Server/BookStore.Application/Catalog/Authors/Commands/Common/AuthorCommandValidator.cs","target","_blank","rel","noopener"],["href","https://github.com/gothinkster/aspnetcore-realworld-example-app/blob/master/src/Conduit/Features/Users/Create.cs","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev/CleanArchitecture/blob/main/src/Application/TodoLists/Commands/UpdateTodoList/UpdateTodoListCommandValidator.cs","target","_blank","rel","noopener"],[1,"language-json"],[1,"hljs-punctuation"],[1,"hljs-attr"],["id","h-adda9d19"],["onclick","window.location.hash = 'h-adda9d19'",1,"anchor"],["href","https://github.com/kalintsenkov/BookStore/blob/main/src/Server/BookStore.Domain/Common/BaseDomainException.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Web/Web/Middleware/ValidationExceptionHandlerMiddleware.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Routing/IdentityControllerRouteTest.cs","target","_blank","rel","noopener"],["id","h-7aa876f0"],["onclick","window.location.hash = 'h-7aa876f0'",1,"anchor"],["href","https://cioina.azurewebsites.net/articles/dotnet-core-testing#h-f5dcf3f1743665e0100f5e709e3971acd67ebe05","target","_blank","rel","noopener"],["id","h-dde4549b"],["onclick","window.location.hash = 'h-dde4549b'",1,"anchor"],["href","https://cioina.azurewebsites.net/articles/ratelimit-middleware","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Data/StaticTestData.cs","target","_blank","rel","noopener"],["id","h-ff4316b6"],["onclick","window.location.hash = 'h-ff4316b6'",1,"anchor"],["href","https://github.com/kalintsenkov/BookStore/tree/main/src/Server","target","_blank","rel","noopener"],["href","https://github.com/gothinkster/aspnetcore-realworld-example-app/tree/master/src/Conduit","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev/CleanArchitecture/tree/main/src","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/tree/main/src/BlogAngular.Test/Test","target","_blank","rel","noopener"],["id","h-948a2e35"],["onclick","window.location.hash = 'h-948a2e35'",1,"anchor"],["href","https://github.com/ivaylokenov","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov","target","_blank","rel","noopener"],["href","https://github.com/ardalis","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev","target","_blank","rel","noopener"],["href","https://github.com/stefanprodan","target","_blank","rel","noopener"],["href","https://github.com/MarkCiliaVincenti","target","_blank","rel","noopener"],["href","https://github.com/jbogard","target","_blank","rel","noopener"],["href","https://github.com/BenMorris","target","_blank","rel","noopener"],[3,"click"],["nz-typography","","nzType","success"],["nzType","arrow-left"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"nz-card",1)(2,"div",2)(3,"div",3)(4,"nz-space",4),g(5,Ni,4,0,"ng-container",5)(6,Ii,4,0,"ng-container",5),t()()(),n(7,"nz-affix",6)(8,"div",7)(9,"div",3)(10,"a",8),h("click",function(){return r.scrollTop()}),e(11,"Jump to top"),t()(),n(12,"div",3)(13,"nz-switch",9),j("ngModelChange",function(S){return U(r.enableNavigation,S)||(r.enableNavigation=S),S}),h("ngModelChange",function(){return r.disableEnable()}),t()()(),n(14,"nz-anchor",10),h("nzClick",function(S){return r.goLink(S)}),d(15,"nz-link",11)(16,"nz-link",12)(17,"nz-link",13)(18,"nz-link",14)(19,"nz-link",15)(20,"nz-link",16)(21,"nz-link",17)(22,"nz-link",18)(23,"nz-link",19),t()(),n(24,"span",20),e(25," MyTested Test Project Example"),d(26,"span",21)(27,"span",22),n(28,"a",23),d(29,"nz-icon",24),t()(),n(30,"article",25)(31,"h2",26)(32,"span"),e(33,"Introduction"),t(),n(34,"a",27),e(35,"#"),t()(),n(36,"p"),e(37,"The compiled code of our .NET Core 9 application is on "),n(38,"a",28),e(39,"our GitHub repository"),t(),e(40,". For this test project, which is part our application, we will use "),n(41,"a",29),e(42,"MyTested"),t(),e(43," - a well-known library for testing ASP.NET Core MVC. Here, we adapted the library to work with .NET Core 9 and API controllers with Bearer Header Authorization based on JWT token implementation provided by .NET Core. Our .NET Core 9 project is based on "),n(44,"a",30),e(45,"BookStore"),t(),e(46," repository and adapted to work with MyTested library."),t(),n(47,"h2",31)(48,"span"),e(49,"MyTested Library Out of The Box"),t(),n(50,"a",32),e(51,"#"),t()(),n(52,"p"),e(53,"I found out about MyTested for the first time from "),n(54,"a",33),e(55,"BlazorShop"),t(),e(56," repository. At the same time, I found out about "),n(57,"code"),e(58,"Jwt Authentication"),t(),e(59," implementation from same "),n(60,"a",34),e(61,"BlazorShop"),t(),e(62," repository and from "),n(63,"a",35),e(64,"aspnetcore-realworld-example"),t(),e(65," repository. Both "),n(66,"code"),e(67,"Jwt Authentication"),t(),e(68," implementations did not work with original "),n(69,"a",29),e(70,"MyTested"),t(),e(71," library, so I decided to find out why. I do not know who engineered MyTested, but I was not able to fully understand how it works. I was only able to add some small pieces of code to make MyTested and my own "),n(72,"code"),e(73,"Jwt Authentication"),t(),e(74," implementation work and not to break any original MyTested tests. One interesting idea of JWT token implementation together with refresh token is on "),n(75,"a",36),e(76,"EdiWang"),t(),e(77,` GitHub repository.
But, what MyTested can do out of the box? The best answer is in `),n(78,"a",37),e(79,"MusicStore"),t(),e(80," testing project. For the API controller, "),n(81,"a",38),e(82,"here"),t(),e(83," is an example:"),t(),n(84,"pre",39)(85,"code")(86,"span",40),e(87,"using"),t(),e(88,` BlogAngular.Application.Common.Version;
`),n(89,"span",40),e(90,"using"),t(),e(91,` BlogAngular.Web.Features;
`),n(92,"span",40),e(93,"using"),t(),e(94,` MyTested.AspNetCore.Mvc;
`),n(95,"span",40),e(96,"using"),t(),e(97,` Xunit;

`),n(98,"span",40),e(99,"namespace"),t(),e(100," "),n(101,"span",41),e(102,"BlogAngular.Test.Routing"),t(),e(103,`
{
    `),n(104,"span",40),e(105,"public"),t(),e(106," "),n(107,"span",40),e(108,"class"),t(),e(109," "),n(110,"span",41),e(111,"FrontEndRouteTest"),t(),e(112,`
    {
        [`),n(113,"span",42),e(114,"Fact"),t(),e(115,`]
        `),n(116,"span",43)(117,"span",40),e(118,"public"),t(),e(119," "),n(120,"span",40),e(121,"void"),t(),e(122," "),n(123,"span",41),e(124,"VersionShouldBeRouted"),t(),e(125,"()"),t(),e(126,`
        => MyMvc
        .Pipeline()
        .ShouldMap(request => request
            .WithMethod(HttpMethod.Get)
            .WithLocation(`),n(127,"span",44),e(128,'"api/v1.0/version"'),t(),e(129,`))
        .To<VersionController>(c => c.Index())
        .Which()
        .ShouldReturn()
        .ActionResult(result => result.Result(`),n(130,"span",40),e(131,"new"),t(),e(132,` VersionResponseEnvelope
        {
            VersionJson = `),n(133,"span",40),e(134,"new"),t(),e(135,` VersionResponseModel()
        }));
    }
}`),t()(),n(136,"h2",45)(137,"span"),e(138,"Basic API Controller Testing"),t(),n(139,"a",46),e(140,"#"),t()(),n(141,"p"),e(142,"There are different ways to define API controllers: "),n(143,"a",47),e(144,"CleanArchitecture"),t(),e(145,", "),n(146,"a",48),e(147,"Moonglade"),t(),e(148,", "),n(149,"a",49),e(150,"Conduit"),t(),e(151,", and "),n(152,"a",50),e(153,"this one"),t(),e(154,". The main reason we implemented API control in a certain way is "),n(155,"a",51),e(156,"NSwag.AspNetCore and NSwag.MSBuild"),t(),e(157," which we use just in Debug mode to generate "),n(158,"a",52),e(159,"specification.json"),t(),e(160,". "),n(161,"code"),e(162,"NSwag"),t(),e(163,` tool is \u201Cvery sensitive\u201D to how API controllers look.
By basic API controller testing, we mean at least one test per CRUD concept.
`),n(164,"a",53),e(165,"Here"),t(),e(166," is an example:"),t(),n(167,"ul")(168,"li")(169,"code"),e(170,"Create_tag_should_return_success_with_data"),t(),e(171,"- Create"),t(),n(172,"li")(173,"code"),e(174,"Listing_tags_without_url_parameters_should_return_success_with_all_tags"),t(),e(175,"- Read"),t(),n(176,"li")(177,"code"),e(178,"Edit_tag_should_return_success_with_data"),t(),e(179,"- Update"),t(),n(180,"li")(181,"code"),e(182,"Delete_tag_should_return_success_with_tag_id"),t(),e(183," - Delete"),t()(),n(184,"h2",54)(185,"span"),e(186,"Data Validation with FluentValidation Library"),t(),n(187,"a",55),e(188,"#"),t()(),n(189,"p"),e(190,"A particular change we made to MyTested is adding the possibility of testing data validation. In fact, now, we can implement all following tests: "),n(191,"a",56),e(192,"BookStore"),t(),e(193,", "),n(194,"a",57),e(195,"RealWorld"),t(),e(196,", "),n(197,"a",58),e(198,"CleanArchitecture1"),t(),e(199,", and "),n(200,"a",59),e(201,"CleanArchitecture2"),t(),e(202," in a set of beautiful tests. "),n(203,"a",53),e(204,"Here"),t(),e(205," are examples of testing data validation using modified version of MyTested library:"),t(),n(206,"ul")(207,"li")(208,"code"),e(209,"Create_tag_with_one_char_should_return_validation_error"),t(),e(210,"- Creates tag name length bellow allowed by database constraint"),t(),n(211,"li")(212,"code"),e(213,"Create_tag_with_max_chars_should_return_validation_error"),t(),e(214,"- Creates tag name length above allowed by database constraint"),t(),n(215,"li")(216,"code"),e(217,"Edit_tag_with_one_char_should_return_validation_error"),t(),e(218,"- Updates tag name length bellow allowed by database constraint"),t(),n(219,"li")(220,"code"),e(221,"Edit_tag_with_max_chars_should_return_validation_error"),t(),e(222," - Updates tag name length above allowed by database constraint"),t()(),n(223,"p"),e(224,"Our validation implementation is based mostly on "),n(225,"a",60),e(226,"BookStore"),t(),e(227,". One useful technique to validate unique data comes from "),n(228,"a",61),e(229,"Conduit"),t(),e(230," and "),n(231,"a",62),e(232,"CleanArchitecture"),t(),e(233,". Following are "),n(234,"a",53),e(235,"three tests"),t(),e(236," with the constraint that the tag name is unique:"),t(),n(237,"ul")(238,"li")(239,"code"),e(240,"Create_tag_with_same_name_should_fail_with_validation_error"),t(),e(241,"- Creates tag with name when the name has already taken."),t(),n(242,"li")(243,"code"),e(244,"Edit_tag_with_same_name_should_fail_with_validation_error"),t(),e(245,"- Updates tag name when the name has already taken."),t(),n(246,"li")(247,"code"),e(248,"Edit_same_tag_with_same_name_should_return_success_with_data"),t(),e(249,"- Updates tag name when the name did not change."),t()(),n(250,"p"),e(251,"In "),n(252,"a",28),e(253,"our application"),t(),e(254,", any "),n(255,"code"),e(256,"MyTested.AspNetCore.Mvc.Exceptions.ValidationErrorsAssertionException"),t(),e(257," will return 422 with JSON string similar to this:"),t(),n(258,"pre",63)(259,"code")(260,"span",64),e(261,"{"),t(),e(262,`
   `),n(263,"span",65),e(264,'"TagJson.Title"'),t(),n(265,"span",64),e(266,":"),t(),e(267,"  "),n(268,"span",64),e(269,"["),t(),n(270,"span",44),e(271,`"The length of 'Tag Json Title' must be 420 characters or fewer. You entered 421 characters."`),t(),n(272,"span",64),e(273,"]"),t(),e(274,`
`),n(275,"span",64),e(276,"}"),t()()(),n(277,"p"),e(278,"That represents a standard validation message from "),n(279,"code"),e(280,"FluentValidation"),t(),e(281," library which can be customized."),t(),n(282,"h2",66)(283,"span"),e(284,"Exception Testing"),t(),n(285,"a",67),e(286,"#"),t()(),n(287,"p"),e(288,"In our application, we use "),n(289,"code"),e(290,"Ardalis.GuardClauses.NotFoundException"),t(),e(291," instead of "),n(292,"a",68),e(293,"BaseDomainException"),t(),e(294,". In addition, we use "),n(295,"a",69),e(296,"ValidationExceptionHandlerMiddleware"),t(),e(297," to intercept all validation exceptions that return "),n(298,"code"),e(299,"HttpStatusCode.UnprocessableEntity"),t(),e(300,"(422). Unfortunately, MyTested does not work with the middleware concept. But, we can use "),n(301,"code"),e(302,"MyTested.AspNetCore.Mvc.Exceptions.InvocationAssertionException"),t(),e(303," and "),n(304,"a",70),e(305,"FromNotFoundException"),t(),e(306," to test against two common exceptions:"),t(),n(307,"ul")(308,"li")(309,"code"),e(310,"Edit_tag_with_wrong_id_should_fail"),t(),e(311,"- The tag with the specified id does not exist in the database."),t(),n(312,"li")(313,"code"),e(314,"Update_user_with_malformated_data_should_fail"),t(),e(315,"- The webserver cannot create the object from the json data request."),t()(),n(316,"h2",71)(317,"span"),e(318,"Identity Controller Testing"),t(),n(319,"a",72),e(320,"#"),t()(),n(321,"p"),e(322,"When it comes to JWT authorization, a big amount of testing consists in testing for invalid JWT tokens:"),t(),n(323,"ul")(324,"li")(325,"code"),e(326,"Update_user_without_authorization_header_should_fail"),t(),e(327,"- tests when JWT token is absent"),t(),n(328,"li")(329,"code"),e(330,"Update_user_with_altered_authorization_header_should_fail"),t(),e(331,"- tests when to a valid JWT token is added one character"),t(),n(332,"li")(333,"code"),e(334,"Update_user_with_malformated_authorization_header_should_fail"),t(),e(335,"- tests when JWT token has format "),n(336,"code"),e(337,"a.b"),t()(),n(338,"li")(339,"code"),e(340,"Update_user_with_fake_authorization_header_should_fail"),t(),e(341,"- tests when JWT token has correct format "),n(342,"code"),e(343,"a.b.c"),t(),e(344," but random characters"),t(),n(345,"li")(346,"code"),e(347,"Update_user_with_incorrect_authorization_header_key_should_fail"),t(),e(348,"- tests when JWT token is valid but was encrypted with a different key"),t(),n(349,"li")(350,"code"),e(351,"Update_user_with_expired_authorization_header_should_fail"),t(),e(352,"- tests when a valid JWT token was expired"),t()(),n(353,"p"),e(354,`These are the most common case scenarios to test against an invalid JWT token and must be done just for one controller!
MyTested cannot catch 401 error code directly. We found a workaround by using `),n(355,"a",70),e(356,"HeaderAuthorizationException"),t(),e(357,`
The full source code for the .NET Core `),n(358,"code"),e(359,"IdentityService"),t(),e(360," implementation can be found "),n(361,"a",73),e(362,"here"),t()(),n(363,"h2",74)(364,"span"),e(365,"Advanced Testing with MyTested Library"),t(),n(366,"a",75),e(367,"#"),t()(),n(368,"p"),e(369,"In "),n(370,"a",76),e(371,'"Implementing JWT Token Refresh Concept for .NET Core 9"'),t(),e(372,", we show an example of RateLimitMiddleware and try some advanced testing with shared "),n(373,"code"),e(374,"MemoryCache"),t(),e(375,": "),n(376,"code"),e(377,"GetTagsWithRateLimitMiddleware"),t(),e(378," and "),n(379,"code"),e(380,"GetAllWithRateLimitMiddleware"),t(),e(381," from "),n(382,"a",77),e(383,"StaticTestData.cs"),t(),e(384,")."),t(),n(385,"h2",78)(386,"span"),e(387,"MyTested Library Limitations"),t(),n(388,"a",79),e(389,"#"),t()(),n(390,"p"),e(391,"We applied modified version of MyTested library to three popular GitHub repositories: "),n(392,"a",80),e(393,"BookStore"),t(),e(394,", "),n(395,"a",81),e(396,"RealWorld"),t(),e(397,", and "),n(398,"a",82),e(399,"CleanArchitecture"),t(),e(400,". Our quick investigation shows that BookStore can be configured to work 100% with MyTested while RealWorld works only with "),n(401,"a",49),e(402,"anonymous controllers"),t(),e(403,` and CleanArchitecture does not work at all.
The full test project source code can be found on `),n(404,"a",83),e(405,"our GitHub repository"),t(),e(406,"."),t(),n(407,"h2",84)(408,"span"),e(409,"Credits"),t(),n(410,"a",85),e(411,"#"),t()(),n(412,"ul")(413,"li")(414,"a",86),e(415,"Ivaylo Kenov"),t()(),n(416,"li")(417,"a",87),e(418,"Kalin Tsenkov"),t()(),n(419,"li")(420,"a",88),e(421,"Steve Smith"),t()(),n(422,"li")(423,"a",89),e(424,"Jason Taylor"),t()(),n(425,"li")(426,"a",90),e(427,"Stefan Prodan"),t()(),n(428,"li")(429,"a",91),e(430,"Mark Cilia Vincenti"),t()(),n(431,"li")(432,"a",92),e(433,"Jimmy Bogard"),t()(),n(434,"li")(435,"a",93),e(436,"Ben Morris"),t()()()()()()),l&2&&(m(),c("nzBordered",!0),m(6),c("nzOffsetTop",45),m(6),V("ngModel",r.enableNavigation),c("ngModelOptions",W(7,Mi)),m(),c("nzOffsetTop",63)("nzAffix",!1)("nzShow",r.enableNavigation))},dependencies:[ee,X,$,xe,q,ce,ae,ie,ne,te,P,D,B,M,A,L,I,R,O,F,H,N,Q,J,le,re,de],encapsulation:2,changeDetection:0})}return a})();var Ri=()=>({standalone:!0});function Li(a,s){if(a&1){let i=_();f(0),n(1,"a",85),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",86),d(3,"nz-icon",87),t()(),w()}}function Bi(a,s){if(a&1){let i=_();f(0),n(1,"a",85),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",86),e(3,"Alexei Cioina's blog"),t()(),w()}}var Jn=(()=>{class a{router=x(Z);#e=x(G);viewPort=x(Y);zone=x(se);mermaidImport=x(pe,{optional:!0});mermaid;isMermaid=!1;enableNavigation=this.#e.selectors.isSwitcher();constructor(){this.isMermaid&&this.mermaidImport&&this.loadMermaid(this.mermaidImport)}ngAfterViewChecked(){this.isMermaid&&this.mermaid&&(this.isMermaid=!1,this.zone.runOutsideAngular(()=>this.mermaid?.default.run()))}loadMermaid(i){this.zone.runOutsideAngular(()=>oe(i).pipe(me()).subscribe(l=>{this.mermaid=l,this.mermaid.default.initialize({startOnLoad:!1}),this.mermaid?.default.run()}))}clickLink(){this.#e.selectors.isAdminArticles()?this.router.navigate(["admin","articles"]):this.router.navigate(["articles"])}disableEnable(){this.#e.setSwitcher(this.enableNavigation)}goLink(i){window&&(window.location.hash=i)}scrollTop(){window&&(window.location.hash=""),this.viewPort.scrollToPosition([0,0])}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-blog-ratelimit-middleware"]],decls:1576,vars:8,consts:[[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","start"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],[1,"toc-affix",3,"nzOffsetTop"],["nz-row","","nzJustify","end"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzSize","small",3,"ngModelChange","ngModel","ngModelOptions"],["nzShowInkInFixed","",3,"nzClick","nzOffsetTop","nzAffix","nzShow"],["nzHref","#h-0b79795d","nzTitle","Introduction"],["nzHref","#h-ce31d768","nzTitle","Use Case Scenario"],["nzHref","#h-c73a370e","nzTitle","JWT Token Refresh Concept"],["nzHref","#h-2ee872d2","nzTitle","JWT Token Refresh Implementation"],["nzHref","#h-dabba405","nzTitle","Modified RateLimitMiddleware"],["nzHref","#h-bd1baabd","nzTitle","Testing of RateLimitMiddleware With MyTested Library"],["nzHref","#h-009deb37","nzTitle","Test Settings"],["nzHref","#h-fb5fe24a","nzTitle","Proof of Concept"],["nzHref","#h-6f8b794f","nzTitle","Conclusion"],["nzHref","#h-948a2e35","nzTitle","Credits"],[1,"markdown-title"],[1,"subtitle"],[1,"widget"],["aria-label","Edit this page on Github","href","https://github.com/cioina/cioina.azurewebsites.net/edit/main/blog/20241018-ratelimit-middleware.md","target","_blank","rel","noopener noreferrer",1,"edit-button"],["nzType","edit"],[1,"markdown"],[2,"border-color","#faad14"],["id","h-0b79795d"],["onclick","window.location.hash = 'h-0b79795d'",1,"anchor"],["href","https://github.com/cioina/cioina.azurewebsites.net","target","_blank","rel","noopener"],["href","https://github.com/ivaylokenov/MyTested.AspNetCore.Mvc","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov/BookStore","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/tree/main/src/BlogAngular.Test/Test","target","_blank","rel","noopener"],["id","h-ce31d768"],["onclick","window.location.hash = 'h-ce31d768'",1,"anchor"],["id","h-c73a370e"],["onclick","window.location.hash = 'h-c73a370e'",1,"anchor"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Web/Web/Features/IdentityController.cs","target","_blank","rel","noopener"],[1,"language-csharp"],[1,"hljs-meta"],[1,"hljs-keyword"],["href","https://github.com/cioina/cioina.azurewebsites.net/blob/main/bin/Release/net9.0/appsettings.json","target","_blank","rel","noopener"],["id","h-2ee872d2"],["onclick","window.location.hash = 'h-2ee872d2'",1,"anchor"],["href","https://github.com/EdiWang/Edi.AspNetCore.Jwt/blob/master/src/Edi.AspNetCore.Jwt/DefaultJwtAuthManager.cs","target","_blank","rel","noopener"],[1,"hljs-literal"],[1,"hljs-built_in"],[1,"hljs-string"],["href","https://github.com/stefanprodan/AspNetCoreRateLimit/blob/master/src/AspNetCoreRateLimit/Middleware/RateLimitMiddleware.cs","target","_blank","rel","noopener"],["id","h-dabba405"],["onclick","window.location.hash = 'h-dabba405'",1,"anchor"],[1,"hljs-title"],[1,"hljs-function"],[1,"hljs-params"],[1,"hljs-comment"],[1,"hljs-subst"],[1,"hljs-number"],["id","h-bd1baabd"],["onclick","window.location.hash = 'h-bd1baabd'",1,"anchor"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/Data/StaticTestData.cs","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/testsettings.json","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/tree/main/src/BlogAngular.Test/Test/RateLimit","target","_blank","rel","noopener"],["href","https://github.com/cioina/MyTested-test-project-example/blob/main/src/BlogAngular.Test/Test/RateLimit/AsyncKeyedLockTest.cs","target","_blank","rel","noopener"],["href","https://github.com/MarkCiliaVincenti/AsyncKeyedLock","target","_blank","rel","noopener"],["href","https://github.com/EdiWang/Edi.CacheAside.InMemory/blob/master/src/Edi.CacheAside.InMemory/MemoryCacheAside.cs","target","_blank","rel","noopener"],["id","h-009deb37"],["onclick","window.location.hash = 'h-009deb37'",1,"anchor"],[1,"language-json"],[1,"hljs-punctuation"],[1,"hljs-attr"],["id","h-fb5fe24a"],["onclick","window.location.hash = 'h-fb5fe24a'",1,"anchor"],["id","h-6f8b794f"],["onclick","window.location.hash = 'h-6f8b794f'",1,"anchor"],["id","h-948a2e35"],["onclick","window.location.hash = 'h-948a2e35'",1,"anchor"],["href","https://github.com/ivaylokenov","target","_blank","rel","noopener"],["href","https://github.com/kalintsenkov","target","_blank","rel","noopener"],["href","https://github.com/ardalis","target","_blank","rel","noopener"],["href","https://github.com/jasontaylordev","target","_blank","rel","noopener"],["href","https://github.com/stefanprodan","target","_blank","rel","noopener"],["href","https://github.com/MarkCiliaVincenti","target","_blank","rel","noopener"],["href","https://github.com/jbogard","target","_blank","rel","noopener"],["href","https://github.com/BenMorris","target","_blank","rel","noopener"],[3,"click"],["nz-typography","","nzType","success"],["nzType","arrow-left"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"nz-card",1)(2,"div",2)(3,"div",3)(4,"nz-space",4),g(5,Li,4,0,"ng-container",5)(6,Bi,4,0,"ng-container",5),t()()(),n(7,"nz-affix",6)(8,"div",7)(9,"div",3)(10,"a",8),h("click",function(){return r.scrollTop()}),e(11,"Jump to top"),t()(),n(12,"div",3)(13,"nz-switch",9),j("ngModelChange",function(S){return U(r.enableNavigation,S)||(r.enableNavigation=S),S}),h("ngModelChange",function(){return r.disableEnable()}),t()()(),n(14,"nz-anchor",10),h("nzClick",function(S){return r.goLink(S)}),d(15,"nz-link",11)(16,"nz-link",12)(17,"nz-link",13)(18,"nz-link",14)(19,"nz-link",15)(20,"nz-link",16)(21,"nz-link",17)(22,"nz-link",18)(23,"nz-link",19)(24,"nz-link",20),t()(),n(25,"span",21),e(26," Implementing JWT Token Refresh Concept for .NET Core 9"),d(27,"span",22)(28,"span",23),n(29,"a",24),d(30,"nz-icon",25),t()(),n(31,"article",26)(32,"blockquote",27)(33,"p")(34,"strong"),e(35,"The concept of Bearer Header Authorization based on JWT token implementation provided by .NET Core 9 is the same as in .NET Core 8. "),t()()(),n(36,"h2",28)(37,"span"),e(38,"Introduction"),t(),n(39,"a",29),e(40,"#"),t()(),n(41,"p"),e(42,"The compiled code of our .NET Core 9 application is on "),n(43,"a",30),e(44,"our GitHub repository"),t(),e(45,". For testing purpose, we will use "),n(46,"a",31),e(47,"MyTested"),t(),e(48," - a well-known library for testing ASP.NET Core MVC. Here, we adapted the library to work with .NET Core 9 and API controllers with Bearer Header Authorization based on JWT token implementation provided by .NET Core. Our project is based on "),n(49,"a",32),e(50,"BookStore"),t(),e(51," repository and adapted to work with MyTested library. MyTested was engineered to work without middleware which is an advantage for many cases. However, the scope of this article was to find a way to tests middleware with MyTested. The full test project source code can be found on "),n(52,"a",33),e(53,"our another GitHub repository"),t(),e(54,"."),t(),n(55,"h2",34)(56,"span"),e(57,"Use Case Scenario"),t(),n(58,"a",35),e(59,"#"),t()(),n(60,"p"),e(61,"The user signs in and gets a JWT token valid for 30 minutes. The user opens a webpage to create/edit an article. It takes 35 minutes to finish the work. The user clicks on submit button. A modal form pops up and asks the user to refresh JWT token by entering a password. The user gets a new JWT token valid for next 30 minutes. Finally, the user clicks submit button and saves the work."),t(),n(62,"h2",36)(63,"span"),e(64,"JWT Token Refresh Concept"),t(),n(65,"a",37),e(66,"#"),t()(),n(67,"p"),e(68,"First, we need to know how basic native JWT token implemented in .NET Core 9 works. Usually, there are "),n(69,"a",38),e(70,"two types of API endpoints: public and private"),t(),e(71,". A private API endpoint look like this:"),t(),n(72,"pre",39)(73,"code"),e(74,"["),n(75,"span",40),e(76,"HttpPut"),t(),e(77,`]
[`),n(78,"span",40),e(79,"Route(nameof(Update))"),t(),e(80,`]
[`),n(81,"span",40),e(82,"Authorize(AuthenticationSchemes = Bearer, Policy = BearerPolicy, Roles = AdministratorRoleName)"),t(),e(83,`]
`),n(84,"span",41),e(85,"public"),t(),e(86," "),n(87,"span",41),e(88,"async"),t(),e(89,` Task<ActionResult<UserResponseEnvelope>> Update(
    UserUpdateCommand command)
    => `),n(90,"span",41),e(91,"await"),t(),e(92," "),n(93,"span",41),e(94,"this"),t(),e(95,".Send(command);"),t()(),n(96,"p"),e(97,"The user signs in and gets a JWT token which is saved in localStorage. Then, any request to the server includes obtained JWT token in the Authorization header. The server won\u2019t use the token on public endpoints. It means that the server won\u2019t try to decrypt the token. On the private endpoints, the server will try to decrypt the token, apply "),n(98,"code"),e(99,"BearerPolicy"),t(),e(100,", and match the role from the token to "),n(101,"code"),e(102,"AdministratorRoleName"),t(),e(103," list. At this point, the basic native .NET Core 9 implementation does not care if the user form the JWT token exists in the database, and it does not care if the role exists in the database ether. However, the server checks if the token expired and returns a 401 error if it\u2019s the case. With all this in mind, we implemented the concept of JWT token refresh period called PRefresh. Let\u2019s call the token\u2019s valid period PValid. Then, "),n(104,"code"),e(105,"SecurityTokenDescriptorExpiresInMinutes"),t(),e(106," from "),n(107,"a",42),e(108,"appsettings.json"),t(),e(109," = PValid + PRefresh and "),n(110,"code"),e(111,"SecurityTokenRefreshRate"),t(),e(112," = PRefresh/(PValid + PRefresh). So, if "),n(113,"code"),e(114,"SecurityTokenDescriptorExpiresInMinutes"),t(),e(115,"= 60 minutes and "),n(116,"code"),e(117,"SecurityTokenRefreshRate"),t(),e(118," = 1/2, it means that PValid = 30 minutes and PRefresh = 30 minutes. If "),n(119,"code"),e(120,"SecurityTokenRefreshRate"),t(),e(121," = 1/4, it means that PValid = 45 minutes and PRefresh = 15 minutes. If "),n(122,"code"),e(123,"SecurityTokenRefreshRate"),t(),e(124," = 3/4, it means that PValid = 15 minutes and PRefresh = 45 minutes and so on. "),t(),n(125,"h2",43)(126,"span"),e(127,"JWT Token Refresh Implementation"),t(),n(128,"a",44),e(129,"#"),t()(),n(130,"p"),e(131,"One interesting idea of JWT token implementation together with refresh token is on "),n(132,"a",45),e(133,"EdiWang"),t(),e(134," GitHub repository. Our main difference from above implementation is not using web browser cookies and uses native .NET Core implementation which is \u201Ccontrolled\u201D by the .NET Core framework itself. One problem we solved in this article, is the implementation of "),n(135,"code"),e(136,"JWT Token"),t(),e(137," refresh mechanism. There is no standard way to refresh JWT token in .NET Core 9. The main idea was to check a valid "),n(138,"code"),e(139,"JWT token"),t(),e(140," right after standard .NET Core authorization and before entering of an API controller. In fact, we needed to use following formula with this small piece of code:"),t(),n(141,"pre",39)(142,"code")(143,"span",41),e(144,"var"),t(),e(145,` claimsPrincipal = context.User!;
 `),n(146,"span",41),e(147,"if"),t(),e(148," (claimsPrincipal != "),n(149,"span",46),e(150,"null"),t(),e(151,`)
 {
     `),n(152,"span",41),e(153,"var"),t(),e(154,` isAuthenticated = claimsPrincipal.Identity?.IsAuthenticated;
     `),n(155,"span",41),e(156,"if"),t(),e(157," (isAuthenticated != "),n(158,"span",46),e(159,"null"),t(),e(160," && ("),n(161,"span",47),e(162,"bool"),t(),e(163,`)isAuthenticated)
     {
         `),n(164,"span",41),e(165,"var"),t(),e(166,` claim = claimsPrincipal.FindFirst(ClaimTypes.Name);
         `),n(167,"span",41),e(168,"if"),t(),e(169," (claim != "),n(170,"span",46),e(171,"null"),t(),e(172,`)
         {
             clientId = claim.Value;
         }
     }
 }
 `),n(173,"span",41),e(174,"if"),t(),e(175," (clientId != "),n(176,"span",46),e(177,"null"),t(),e(178,`)
 {
     `),n(179,"span",41),e(180,"var"),t(),e(181," iat = claimsPrincipal.FindFirst("),n(182,"span",48),e(183,'"iat"'),t(),e(184,`);
     `),n(185,"span",41),e(186,"var"),t(),e(187," exp = claimsPrincipal.FindFirst("),n(188,"span",48),e(189,'"exp"'),t(),e(190,`);
     `),n(191,"span",41),e(192,"if"),t(),e(193," (iat != "),n(194,"span",46),e(195,"null"),t(),e(196," && exp != "),n(197,"span",46),e(198,"null"),t(),e(199,`)
     {
         `),n(200,"span",41),e(201,"var"),t(),e(202," pValid = ("),n(203,"span",47),e(204,"long"),t(),e(205,".Parse(exp.Value) - "),n(206,"span",47),e(207,"long"),t(),e(208,`.Parse(iat.Value)) * _options.SecurityTokenRefreshRate;
         `),n(209,"span",41),e(210,"var"),t(),e(211," current = "),n(212,"span",47),e(213,"long"),t(),e(214,`.Parse(exp.Value) - DateTimeOffset.Now.ToUnixTimeSeconds();
         `),n(215,"span",41),e(216,"if"),t(),e(217,` (current < pValid)
         {
             `),n(218,"span",41),e(219,"await"),t(),e(220," ReturnSecurityTokenRefreshRate(context, "),n(221,"span",48),e(222,'"SecurityTokenRefreshRate"'),t(),e(223,", "),n(224,"span",48),e(225,'"Please refresh your JWT token"'),t(),e(226,`);
             `),n(227,"span",41),e(228,"return"),t(),e(229,`;
         }
     }
 }`),t()(),n(230,"p"),e(231,"So, we needed a middleware to place the above piece of code. A good candidate we found was AspNetCoreRateLimit library, so we decided to modify its source code keeping in mind also the possibility of testing it with MyTested. The original AspNetCoreRateLimit middleware is called "),n(232,"a",49),e(233,"RateLimitMiddleware.cs"),t(),e(234," Following is the modified source code that is used in our actual application."),t(),n(235,"h3",50)(236,"span"),e(237,"Modified RateLimitMiddleware"),t(),n(238,"a",51),e(239,"#"),t()(),n(240,"pre",39)(241,"code")(242,"span",41),e(243,"using"),t(),e(244,` Microsoft.AspNetCore.Hosting;
`),n(245,"span",41),e(246,"using"),t(),e(247,` Microsoft.AspNetCore.Http;
`),n(248,"span",41),e(249,"using"),t(),e(250,` Newtonsoft.Json;
`),n(251,"span",41),e(252,"using"),t(),e(253,` Newtonsoft.Json.Serialization;
`),n(254,"span",41),e(255,"using"),t(),e(256,` System;
`),n(257,"span",41),e(258,"using"),t(),e(259,` System.Collections.Generic;
`),n(260,"span",41),e(261,"using"),t(),e(262,` System.Data;
`),n(263,"span",41),e(264,"using"),t(),e(265,` System.Linq;
`),n(266,"span",41),e(267,"using"),t(),e(268,` System.Net;
`),n(269,"span",41),e(270,"using"),t(),e(271,` System.Security.Claims;
`),n(272,"span",41),e(273,"using"),t(),e(274,` System.Text;
`),n(275,"span",41),e(276,"using"),t(),e(277,` System.Threading.Tasks;

`),n(278,"span",41),e(279,"namespace"),t(),e(280," "),n(281,"span",52),e(282,"AspNetCoreRateLimit"),t(),e(283,`
{
    `),n(284,"span",41),e(285,"public"),t(),e(286," "),n(287,"span",41),e(288,"abstract"),t(),e(289," "),n(290,"span",41),e(291,"class"),t(),e(292," "),n(293,"span",52),e(294,"RateLimitMiddleware"),t(),e(295,"<"),n(296,"span",52),e(297,"TProcessor"),t(),e(298,"> : "),n(299,"span",52),e(300,"IMiddleware"),t(),e(301,`
        `),n(302,"span",41),e(303,"where"),t(),e(304," "),n(305,"span",52),e(306,"TProcessor"),t(),e(307," : "),n(308,"span",52),e(309,"IRateLimitProcessor"),t(),e(310,`
    {
        `),n(311,"span",41),e(312,"private"),t(),e(313," "),n(314,"span",41),e(315,"readonly"),t(),e(316,` IWebHostEnvironment _env;
        `),n(317,"span",41),e(318,"private"),t(),e(319," "),n(320,"span",41),e(321,"readonly"),t(),e(322,` TProcessor _processor;
        `),n(323,"span",41),e(324,"private"),t(),e(325," "),n(326,"span",41),e(327,"readonly"),t(),e(328,` RateLimitOptions _options;
        `),n(329,"span",41),e(330,"private"),t(),e(331," "),n(332,"span",41),e(333,"readonly"),t(),e(334,` IRateLimitConfiguration _config;
        `),n(335,"span",41),e(336,"private"),t(),e(337," "),n(338,"span",41),e(339,"readonly"),t(),e(340," "),n(341,"span",47),e(342,"bool"),t(),e(343,` _securityTokenRefreshOnly;
        `),n(344,"span",53)(345,"span",41),e(346,"protected"),t(),e(347," "),n(348,"span",52),e(349,"RateLimitMiddleware"),t(),e(350,"("),n(351,"span",54),e(352,`
            IWebHostEnvironment env,
            RateLimitOptions options,
            TProcessor processor,
            IRateLimitConfiguration config,
            `),n(353,"span",47),e(354,"bool"),t(),e(355," securityTokenRefreshOnly"),t(),e(356,")"),t(),e(357,`
        {
            _env = env;
            _options = options;
            _processor = processor;
            _config = config;
            _securityTokenRefreshOnly = securityTokenRefreshOnly;

            `),n(358,"span",41),e(359,"if"),t(),e(360," (_env.EnvironmentName == "),n(361,"span",48),e(362,'"Test"'),t(),e(363,`)
            {
                _config.RegisterResolvers();
            }
        }

        `),n(364,"span",53)(365,"span",41),e(366,"public"),t(),e(367," "),n(368,"span",41),e(369,"async"),t(),e(370," Task "),n(371,"span",52),e(372,"InvokeAsync"),t(),e(373,"("),n(374,"span",54),e(375,"HttpContext context, RequestDelegate _next"),t(),e(376,")"),t(),e(377,`
        {
            `),n(378,"span",55),e(379,"// check if rate limiting is enabled (EnableEndpointRateLimiting)"),t(),e(380,`
            `),n(381,"span",41),e(382,"if"),t(),e(383," (_options == "),n(384,"span",46),e(385,"null"),t(),e(386,`)
            {
                `),n(387,"span",41),e(388,"await"),t(),e(389,` _next.Invoke(context);
                `),n(390,"span",41),e(391,"return"),t(),e(392,`;
            }

            `),n(393,"span",47),e(394,"string"),t(),e(395," clientIp = "),n(396,"span",46),e(397,"null"),t(),e(398,`;
            `),n(399,"span",47),e(400,"string"),t(),e(401," clientId = "),n(402,"span",46),e(403,"null"),t(),e(404,`;

            `),n(405,"span",41),e(406,"var"),t(),e(407,` claimsPrincipal = context.User!;

            `),n(408,"span",41),e(409,"if"),t(),e(410," (claimsPrincipal != "),n(411,"span",46),e(412,"null"),t(),e(413,`)
            {
                `),n(414,"span",41),e(415,"var"),t(),e(416,` isAuthenticated = claimsPrincipal.Identity?.IsAuthenticated;
                `),n(417,"span",41),e(418,"if"),t(),e(419," (isAuthenticated != "),n(420,"span",46),e(421,"null"),t(),e(422," && ("),n(423,"span",47),e(424,"bool"),t(),e(425,`)isAuthenticated)
                {
                    `),n(426,"span",41),e(427,"var"),t(),e(428,` claim = claimsPrincipal.FindFirst(ClaimTypes.Name);
                    `),n(429,"span",41),e(430,"if"),t(),e(431," (claim != "),n(432,"span",46),e(433,"null"),t(),e(434,`)
                    {
                        clientId = claim.Value;
                    }
                }
            }

            `),n(435,"span",41),e(436,"if"),t(),e(437,` (!_config.IpResolvers.IsEmpty)
            {
                `),n(438,"span",41),e(439,"var"),t(),e(440,` resolver = _config.IpResolvers.GetEnumerator();
                `),n(441,"span",41),e(442,"while"),t(),e(443,` (resolver.MoveNext())
                {
                    clientIp = resolver.Current.Value.ResolveIp(context);
                    `),n(444,"span",41),e(445,"if"),t(),e(446," (!"),n(447,"span",47),e(448,"string"),t(),e(449,`.IsNullOrEmpty(clientIp))
                    {
                        `),n(450,"span",41),e(451,"break"),t(),e(452,`;
                    }
                }
            }

            `),n(453,"span",41),e(454,"var"),t(),e(455,` path = context.Request.Path.ToString().ToLowerInvariant();
            `),n(456,"span",41),e(457,"var"),t(),e(458," identity = "),n(459,"span",41),e(460,"new"),t(),e(461,` ClientRequestIdentity
            {
                ClientIp = clientIp ?? context.Connection.RemoteIpAddress?.MapToIPv4().ToString(),
                Path = path == `),n(462,"span",48),e(463,'"/"'),t(),e(464,`
                    ? path
                    : path.TrimEnd(`),n(465,"span",48),e(466,"'/'"),t(),e(467,`),
                HttpVerb = context.Request.Method.ToLowerInvariant(),
                ClientId = clientId ?? `),n(468,"span",48),e(469,'"anon"'),t(),e(470,`
            };


            `),n(471,"span",55),e(472,"// check white list"),t(),e(473,`
            `),n(474,"span",41),e(475,"if"),t(),e(476,` (!_processor.IsWhitelisted(identity))
            {
                `),n(477,"span",41),e(478,"if"),t(),e(479," (clientId != "),n(480,"span",46),e(481,"null"),t(),e(482,`)
                {
                    `),n(483,"span",41),e(484,"var"),t(),e(485," iat = claimsPrincipal.FindFirst("),n(486,"span",48),e(487,'"iat"'),t(),e(488,`);
                    `),n(489,"span",41),e(490,"var"),t(),e(491," exp = claimsPrincipal.FindFirst("),n(492,"span",48),e(493,'"exp"'),t(),e(494,`);
                    `),n(495,"span",41),e(496,"if"),t(),e(497," (iat != "),n(498,"span",46),e(499,"null"),t(),e(500," && exp != "),n(501,"span",46),e(502,"null"),t(),e(503,`)
                    {
                        `),n(504,"span",41),e(505,"var"),t(),e(506," pValid = ("),n(507,"span",47),e(508,"long"),t(),e(509,".Parse(exp.Value) - "),n(510,"span",47),e(511,"long"),t(),e(512,`.Parse(iat.Value)) * _options.SecurityTokenRefreshRate;
                        `),n(513,"span",41),e(514,"var"),t(),e(515," current = "),n(516,"span",47),e(517,"long"),t(),e(518,`.Parse(exp.Value) - DateTimeOffset.Now.ToUnixTimeSeconds();

                        `),n(519,"span",41),e(520,"if"),t(),e(521," ("),n(522,"span",41),e(523,"this"),t(),e(524,"._env.EnvironmentName == "),n(525,"span",48),e(526,'"Test"'),t(),e(527,`)
                        {
                            `),n(528,"span",41),e(529,"if"),t(),e(530," (clientId == "),n(531,"span",48),e(532,'"SecurityTokenRefreshException@email.com1"'),t(),e(533,`)
                            {
                                `),n(534,"span",41),e(535,"await"),t(),e(536," Task.FromException("),n(537,"span",41),e(538,"new"),t(),e(539," SecurityTokenRefreshException("),n(540,"span",48),e(541,'$"This is a test. PValid:  '),n(542,"span",56),e(543,"{pValid}"),t(),e(544," Current: "),n(545,"span",56),e(546,"{current}"),t(),e(547," ClientId: "),n(548,"span",56),e(549,"{clientId}"),t(),e(550,'"'),t(),e(551,`));
                            }
                        }
                        `),n(552,"span",41),e(553,"else"),t(),e(554," "),n(555,"span",41),e(556,"if"),t(),e(557,` (current < pValid)
                        {
                            `),n(558,"span",41),e(559,"await"),t(),e(560," ReturnSecurityTokenRefreshRate(context, "),n(561,"span",48),e(562,'"SecurityTokenRefreshRate"'),t(),e(563,", "),n(564,"span",48),e(565,'"Please refresh your JWT token"'),t(),e(566,`);
                            `),n(567,"span",41),e(568,"return"),t(),e(569,`;
                        }
                    }
                }

                `),n(570,"span",40),e(571,"#"),n(572,"span",41),e(573,"region"),t(),e(574," NOT securityTokenRefreshOnly"),t(),e(575,`
                `),n(576,"span",41),e(577,"if"),t(),e(578,` (!_securityTokenRefreshOnly)
                {
                    `),n(579,"span",41),e(580,"if"),t(),e(581," ("),n(582,"span",41),e(583,"this"),t(),e(584,"._env.EnvironmentName == "),n(585,"span",48),e(586,'"Test"'),t(),e(587,`)
                    {
                        `),n(588,"span",41),e(589,"if"),t(),e(590," (clientIp == "),n(591,"span",48),e(592,'"0.0.0.0"'),t(),e(593,`)
                        {
                            `),n(594,"span",41),e(595,"await"),t(),e(596," Task.FromException("),n(597,"span",41),e(598,"new"),t(),e(599," MatchingRulesException("),n(600,"span",48),e(601,'$"This is a test. ClientIp: '),n(602,"span",56),e(603,"{identity.ClientIp}"),t(),e(604,'"'),t(),e(605,`));
                        }
                    }

                    IEnumerable<RateLimitRule> rules = `),n(606,"span",46),e(607,"null"),t(),e(608,`;
                    rules = `),n(609,"span",41),e(610,"await"),t(),e(611,` _processor.GetMatchingRulesAsync(identity, context.RequestAborted);
                    `),n(612,"span",41),e(613,"if"),t(),e(614," (rules == "),n(615,"span",46),e(616,"null"),t(),e(617,`)
                    {
                        `),n(618,"span",41),e(619,"if"),t(),e(620," ("),n(621,"span",41),e(622,"this"),t(),e(623,"._env.EnvironmentName == "),n(624,"span",48),e(625,'"Test"'),t(),e(626,`)
                        {
                            `),n(627,"span",41),e(628,"await"),t(),e(629," Task.FromException("),n(630,"span",41),e(631,"new"),t(),e(632," MatchingRulesException("),n(633,"span",48),e(634,'$"This is a test. ClientIp: '),n(635,"span",56),e(636,"{identity.ClientIp}"),t(),e(637,'"'),t(),e(638,`));
                        }
                        `),n(639,"span",41),e(640,"else"),t(),e(641,`
                        {
                            `),n(642,"span",41),e(643,"await"),t(),e(644," ReturnSecurityTokenRefreshRate(context, "),n(645,"span",48),e(646,'"MatchingRulesException"'),t(),e(647,", "),n(648,"span",48),e(649,'$"Matching rules is null. Your IP address is: '),n(650,"span",56),e(651,"{identity.ClientIp}"),t(),e(652,'"'),t(),e(653,`);
                            `),n(654,"span",41),e(655,"return"),t(),e(656,`;
                        }
                    }

                    `),n(657,"span",41),e(658,"var"),t(),e(659," rulesDict = "),n(660,"span",41),e(661,"new"),t(),e(662,` Dictionary<RateLimitRule, RateLimitCounter>();

                    `),n(663,"span",41),e(664,"foreach"),t(),e(665," ("),n(666,"span",41),e(667,"var"),t(),e(668," rule "),n(669,"span",41),e(670,"in"),t(),e(671,` rules)
                    {
                        `),n(672,"span",55),e(673,"// increment counter"),t(),e(674,`
                        `),n(675,"span",41),e(676,"var"),t(),e(677," rateLimitCounter = "),n(678,"span",41),e(679,"await"),t(),e(680,` _processor.ProcessRequestAsync(identity, rule, context.RequestAborted);

                        `),n(681,"span",41),e(682,"if"),t(),e(683," (rule.Limit > "),n(684,"span",57),e(685,"0"),t(),e(686,`)
                        {
                            `),n(687,"span",55),e(688,"// check if key expired"),t(),e(689,`
                            `),n(690,"span",41),e(691,"if"),t(),e(692,` (rateLimitCounter.Timestamp + rule.PeriodTimespan.Value < DateTime.UtcNow)
                            {
                                `),n(693,"span",41),e(694,"continue"),t(),e(695,`;
                            }

                            `),n(696,"span",55),e(697,"// check if limit is reached"),t(),e(698,`
                            `),n(699,"span",41),e(700,"if"),t(),e(701,` (rateLimitCounter.Count > rule.Limit)
                            {
                                `),n(702,"span",55),e(703,"//compute retry after value"),t(),e(704,`
                                `),n(705,"span",41),e(706,"var"),t(),e(707,` retryAfter = rateLimitCounter.Timestamp.RetryAfterFrom(rule);

                                `),n(708,"span",55),e(709,"// log blocked request"),t(),e(710,`
                                LogBlockedRequest(context, identity, rateLimitCounter, rule);

                                `),n(711,"span",41),e(712,"if"),t(),e(713," (_options.RequestBlockedBehaviorAsync != "),n(714,"span",46),e(715,"null"),t(),e(716,`)
                                {
                                    `),n(717,"span",41),e(718,"await"),t(),e(719,` _options.RequestBlockedBehaviorAsync(context, identity, rateLimitCounter, rule);
                                }

                                `),n(720,"span",41),e(721,"if"),t(),e(722," ("),n(723,"span",41),e(724,"this"),t(),e(725,"._env.EnvironmentName == "),n(726,"span",48),e(727,'"Test"'),t(),e(728,`)
                                {
                                    `),n(729,"span",41),e(730,"await"),t(),e(731," Task.FromException("),n(732,"span",41),e(733,"new"),t(),e(734," RateLimitMiddlewareException("),n(735,"span",48),e(736,'$"This is a test. rateLimitCounter.Count '),n(737,"span",56),e(738,"{rateLimitCounter.Count}"),t(),e(739," rule.Limit: "),n(740,"span",56),e(741,"{rule.Limit}"),t(),e(742," ClientIp: "),n(743,"span",56),e(744,"{identity.ClientIp}"),t(),e(745,'"'),t(),e(746,`));
                                }

                                `),n(747,"span",41),e(748,"if"),t(),e(749,` (!rule.MonitorMode)
                                {
                                    `),n(750,"span",55),e(751,"// break execution"),t(),e(752,`
                                    `),n(753,"span",41),e(754,"await"),t(),e(755,` ReturnQuotaExceededResponse(context, rule, retryAfter, identity.ClientIp);

                                    `),n(756,"span",41),e(757,"return"),t(),e(758,`;
                                }
                            }
                        }
                        `),n(759,"span",55),e(760,"// if limit is zero or less, block the request."),t(),e(761,`
                        `),n(762,"span",41),e(763,"else"),t(),e(764,`
                        {
                            `),n(765,"span",55),e(766,"// log blocked request"),t(),e(767,`
                            LogBlockedRequest(context, identity, rateLimitCounter, rule);

                            `),n(768,"span",41),e(769,"if"),t(),e(770," (_options.RequestBlockedBehaviorAsync != "),n(771,"span",46),e(772,"null"),t(),e(773,`)
                            {
                                `),n(774,"span",41),e(775,"await"),t(),e(776,` _options.RequestBlockedBehaviorAsync(context, identity, rateLimitCounter, rule);
                            }

                            `),n(777,"span",41),e(778,"if"),t(),e(779," ("),n(780,"span",41),e(781,"this"),t(),e(782,"._env.EnvironmentName == "),n(783,"span",48),e(784,'"Test"'),t(),e(785,`)
                            {
                                `),n(786,"span",41),e(787,"await"),t(),e(788," Task.FromException("),n(789,"span",41),e(790,"new"),t(),e(791," RateLimitMiddlewareException("),n(792,"span",48),e(793,'$"This is a test. rateLimitCounter.Count '),n(794,"span",56),e(795,"{rateLimitCounter.Count}"),t(),e(796," rule.Limit: "),n(797,"span",56),e(798,"{rule.Limit}"),t(),e(799," ClientIp: "),n(800,"span",56),e(801,"{identity.ClientIp}"),t(),e(802,'"'),t(),e(803,`));
                            }

                            `),n(804,"span",41),e(805,"if"),t(),e(806,` (!rule.MonitorMode)
                            {
                                `),n(807,"span",55),e(808,"// break execution (Int32 max used to represent infinity)"),t(),e(809,`
                                `),n(810,"span",41),e(811,"await"),t(),e(812," ReturnQuotaExceededResponse(context, rule, "),n(813,"span",47),e(814,"int"),t(),e(815,`.MaxValue.ToString(System.Globalization.CultureInfo.InvariantCulture), identity.ClientIp);

                                `),n(816,"span",41),e(817,"return"),t(),e(818,`;
                            }
                        }

                        rulesDict.Add(rule, rateLimitCounter);
                    }

                    `),n(819,"span",55),e(820,"// set X-Rate-Limit headers for the longest period"),t(),e(821,`
                    `),n(822,"span",41),e(823,"if"),t(),e(824," (rulesDict.Count != "),n(825,"span",57),e(826,"0"),t(),e(827,` && !_options.DisableRateLimitHeaders)
                    {
                        `),n(828,"span",41),e(829,"var"),t(),e(830,` rule = rulesDict.OrderByDescending(x => x.Key.PeriodTimespan).FirstOrDefault();
                        `),n(831,"span",41),e(832,"var"),t(),e(833,` headers = _processor.GetRateLimitHeaders(rule.Value, rule.Key, context.RequestAborted);

                        headers.Context = context;

                        context.Response.OnStarting(SetRateLimitHeaders, state: headers);
                    }
                }
                `),n(834,"span",40),e(835,"#"),n(836,"span",41),e(837,"endregion"),t()(),e(838,`
            }

            `),n(839,"span",41),e(840,"if"),t(),e(841," ("),n(842,"span",41),e(843,"this"),t(),e(844,"._env.EnvironmentName == "),n(845,"span",48),e(846,'"Test"'),t(),e(847,`)
            {
                `),n(848,"span",41),e(849,"await"),t(),e(850," Task.FromResult("),n(851,"span",46),e(852,"true"),t(),e(853,`);
            }
            `),n(854,"span",41),e(855,"else"),t(),e(856,`
            {
                `),n(857,"span",41),e(858,"await"),t(),e(859,` _next.Invoke(context);
            }
        }

        `),n(860,"span",53)(861,"span",41),e(862,"private"),t(),e(863," "),n(864,"span",41),e(865,"static"),t(),e(866," Task "),n(867,"span",52),e(868,"ReturnSecurityTokenRefreshRate"),t(),e(869,"("),n(870,"span",54),e(871,"HttpContext context, "),n(872,"span",47),e(873,"string"),t(),e(874," key, "),n(875,"span",47),e(876,"string"),t(),e(877," message"),t(),e(878,")"),t(),e(879,`
        {
            context.Response.ContentType = `),n(880,"span",48),e(881,'"application/json"'),t(),e(882,`;
            context.Response.StatusCode = (`),n(883,"span",47),e(884,"int"),t(),e(885,`)HttpStatusCode.UnprocessableEntity;

            `),n(886,"span",41),e(887,"var"),t(),e(888," result = SerializeObject("),n(889,"span",41),e(890,"new"),t(),e(891,` ErrorListResult(key,
                        [
                            message
                        ]));

            `),n(892,"span",41),e(893,"return"),t(),e(894,` context.Response.WriteAsync(result);
        }

        `),n(895,"span",53)(896,"span",41),e(897,"private"),t(),e(898," "),n(899,"span",41),e(900,"static"),t(),e(901," "),n(902,"span",47),e(903,"string"),t(),e(904," "),n(905,"span",52),e(906,"SerializeObject"),t(),e(907,"("),n(908,"span",54)(909,"span",47),e(910,"object"),t(),e(911," obj"),t(),e(912,")"),t(),e(913,`
            => JsonConvert.SerializeObject(obj, `),n(914,"span",41),e(915,"new"),t(),e(916,` JsonSerializerSettings
            {
                ContractResolver = `),n(917,"span",41),e(918,"new"),t(),e(919,` DefaultContractResolver
                {
                    NamingStrategy = `),n(920,"span",41),e(921,"new"),t(),e(922," CamelCaseNamingStrategy("),n(923,"span",46),e(924,"true"),t(),e(925,", "),n(926,"span",46),e(927,"true"),t(),e(928,`)
                }
            });

        `),n(929,"span",53)(930,"span",41),e(931,"public"),t(),e(932," "),n(933,"span",41),e(934,"virtual"),t(),e(935," Task "),n(936,"span",52),e(937,"ReturnQuotaExceededResponse"),t(),e(938,"("),n(939,"span",54),e(940,"HttpContext httpContext, RateLimitRule rule, "),n(941,"span",47),e(942,"string"),t(),e(943," retryAfter, "),n(944,"span",47),e(945,"string"),t(),e(946," clientIp"),t(),e(947,")"),t(),e(948,`
        {
            `),n(949,"span",55),e(950,"//Use Endpoint QuotaExceededResponse"),t(),e(951,`
            `),n(952,"span",41),e(953,"if"),t(),e(954," (rule.QuotaExceededResponse != "),n(955,"span",46),e(956,"null"),t(),e(957,`)
            {
                _options.QuotaExceededResponse = rule.QuotaExceededResponse;
            }
            `),n(958,"span",41),e(959,"var"),t(),e(960," message = "),n(961,"span",47),e(962,"string"),t(),e(963,`.Format(
                    _options.QuotaExceededResponse?.Content ??
                    _options.QuotaExceededMessage ??
                    `),n(964,"span",48),e(965,'"Maximum allowed: {0} per {1}. Please try again in {2} second(s). Your IP adress is {3}"'),t(),e(966,`,
                    rule.Limit,
                    rule.PeriodTimespan.HasValue ? FormatPeriodTimespan(rule.PeriodTimespan.Value) : rule.Period, retryAfter, clientIp
             );

            `),n(967,"span",41),e(968,"if"),t(),e(969,` (!_options.DisableRateLimitHeaders)
            {
                httpContext.Response.Headers.RetryAfter = retryAfter;
            }

            httpContext.Response.ContentType = _options.QuotaExceededResponse?.ContentType ?? `),n(970,"span",48),e(971,'"text/plain"'),t(),e(972,`;
            httpContext.Response.StatusCode = _options.QuotaExceededResponse?.StatusCode ?? _options.HttpStatusCode;


            `),n(973,"span",41),e(974,"var"),t(),e(975," result = SerializeObject("),n(976,"span",41),e(977,"new"),t(),e(978," ErrorListResult("),n(979,"span",48),e(980,'"QuotaExceeded"'),t(),e(981,`,
                        [
                            message
                        ]));

            `),n(982,"span",41),e(983,"return"),t(),e(984,` httpContext.Response.WriteAsync(result);
        }

        `),n(985,"span",53)(986,"span",41),e(987,"private"),t(),e(988," "),n(989,"span",41),e(990,"static"),t(),e(991," "),n(992,"span",47),e(993,"string"),t(),e(994," "),n(995,"span",52),e(996,"FormatPeriodTimespan"),t(),e(997,"("),n(998,"span",54),e(999,"TimeSpan period"),t(),e(1e3,")"),t(),e(1001,`
        {
            `),n(1002,"span",41),e(1003,"var"),t(),e(1004," sb = "),n(1005,"span",41),e(1006,"new"),t(),e(1007,` StringBuilder();

            `),n(1008,"span",41),e(1009,"if"),t(),e(1010," (period.Days > "),n(1011,"span",57),e(1012,"0"),t(),e(1013,`)
            {
                sb.Append(`),n(1014,"span",48),e(1015,'$"'),n(1016,"span",56),e(1017,"{period.Days}"),t(),e(1018,'d"'),t(),e(1019,`);
            }

            `),n(1020,"span",41),e(1021,"if"),t(),e(1022," (period.Hours > "),n(1023,"span",57),e(1024,"0"),t(),e(1025,`)
            {
                sb.Append(`),n(1026,"span",48),e(1027,'$"'),n(1028,"span",56),e(1029,"{period.Hours}"),t(),e(1030,'h"'),t(),e(1031,`);
            }

            `),n(1032,"span",41),e(1033,"if"),t(),e(1034," (period.Minutes > "),n(1035,"span",57),e(1036,"0"),t(),e(1037,`)
            {
                sb.Append(`),n(1038,"span",48),e(1039,'$"'),n(1040,"span",56),e(1041,"{period.Minutes}"),t(),e(1042,'m"'),t(),e(1043,`);
            }

            `),n(1044,"span",41),e(1045,"if"),t(),e(1046," (period.Seconds > "),n(1047,"span",57),e(1048,"0"),t(),e(1049,`)
            {
                sb.Append(`),n(1050,"span",48),e(1051,'$"'),n(1052,"span",56),e(1053,"{period.Seconds}"),t(),e(1054,'s"'),t(),e(1055,`);
            }

            `),n(1056,"span",41),e(1057,"if"),t(),e(1058," (period.Milliseconds > "),n(1059,"span",57),e(1060,"0"),t(),e(1061,`)
            {
                sb.Append(`),n(1062,"span",48),e(1063,'$"'),n(1064,"span",56),e(1065,"{period.Milliseconds}"),t(),e(1066,'ms"'),t(),e(1067,`);
            }

            `),n(1068,"span",41),e(1069,"return"),t(),e(1070,` sb.ToString();
        }

        `),n(1071,"span",53)(1072,"span",41),e(1073,"protected"),t(),e(1074," "),n(1075,"span",41),e(1076,"abstract"),t(),e(1077," "),n(1078,"span",41),e(1079,"void"),t(),e(1080," "),n(1081,"span",52),e(1082,"LogBlockedRequest"),t(),e(1083,"("),n(1084,"span",54),e(1085,"HttpContext httpContext, ClientRequestIdentity identity, RateLimitCounter counter, RateLimitRule rule"),t(),e(1086,")"),t(),e(1087,`;

        `),n(1088,"span",53)(1089,"span",41),e(1090,"private"),t(),e(1091," Task "),n(1092,"span",52),e(1093,"SetRateLimitHeaders"),t(),e(1094,"("),n(1095,"span",54)(1096,"span",47),e(1097,"object"),t(),e(1098," rateLimitHeaders"),t(),e(1099,")"),t(),e(1100,`
        {
            `),n(1101,"span",41),e(1102,"var"),t(),e(1103,` headers = (RateLimitHeaders)rateLimitHeaders;

            headers.Context.Response.Headers[`),n(1104,"span",48),e(1105,'"X-Rate-Limit-Limit"'),t(),e(1106,`] = headers.Limit;
            headers.Context.Response.Headers[`),n(1107,"span",48),e(1108,'"X-Rate-Limit-Remaining"'),t(),e(1109,`] = headers.Remaining;
            headers.Context.Response.Headers[`),n(1110,"span",48),e(1111,'"X-Rate-Limit-Reset"'),t(),e(1112,`] = headers.Reset;

            `),n(1113,"span",41),e(1114,"return"),t(),e(1115,` Task.CompletedTask;
        }
    }
}`),t()(),n(1116,"h2",58)(1117,"span"),e(1118,"Testing of RateLimitMiddleware With MyTested Library"),t(),n(1119,"a",59),e(1120,"#"),t()(),n(1121,"p"),e(1122,"From the start, we need to keep in mind that MyTested does not provide support for middleware testing. So, we found a work around which is not 100% accurate. The main idea is that you have to setup the middleware manually in the right place to be logically correct. In our case, we\u2019ve got "),n(1123,"code"),e(1124,"GetTagsWithRateLimitMiddleware"),t(),e(1125," and "),n(1126,"code"),e(1127,"GetAllWithRateLimitMiddleware"),t(),e(1128," from "),n(1129,"a",60),e(1130,"StaticTestData.cs"),t(),e(1131,"). Also, RateLimitMiddleware needs shared "),n(1132,"code"),e(1133,"MemoryCache"),t(),e(1134,". On the other hand, MyTested just simulates shared "),n(1135,"code"),e(1136,"MeroryCache"),t(),e(1137,". So, we modified source code of MyTested to work with the actual "),n(1138,"code"),e(1139,"MeroryCache"),t(),e(1140," Also, we introduced an option "),n(1141,"code"),e(1142,'\u201DReplaceMemoryCache": false'),t(),e(1143," (See "),n(1144,"a",61),e(1145,"testsettings.json"),t(),e(1146,"). From our modified source code of RateLimitMiddleware, you can see that we try to keep the original functional and add JWT token refresh concept also. As a result, we\u2019ve got following limitations:"),t(),n(1147,"ul")(1148,"li"),e(1149,"the "),n(1150,"code"),e(1151,"clientId"),t(),e(1152," is taken from JWT token only"),t(),n(1153,"li"),e(1154,"the "),n(1155,"code"),e(1156,"clientIp"),t(),e(1157," is taken from "),n(1158,"code"),e(1159,"context.Connection.RemoteIpAddress"),t(),e(1160," only"),t(),n(1161,"li")(1162,"code"),e(1163,"ClientWhitelist"),t(),e(1164,` configuration option does not work with public endpoints, and it should be empty.
Also, the \u201Ccorrect way\u201D to configure it is following:`),t()(),n(1165,"pre",39)(1166,"code"),e(1167,`...
.UseRouting()
.InitializeRateLimit()
.UseMiddleware<IpRateLimitMiddleware>()
.UseAuthentication()
.UseAuthorization()
.UseMiddleware<ClientRateLimitMiddleware>()
...`),t()(),n(1168,"p"),e(1169,"All our middleware tests are in "),n(1170,"a",62),e(1171,"RateLimit"),t(),e(1172," folder. For token refresh concept, we\u2019ve got just two tests: "),n(1173,"code"),e(1174,"Edit_tag_with_refresh_token_should_fail"),t(),e(1175," and "),n(1176,"code"),e(1177,"Login_with_password_with_refresh_token_and_whitelisted_private_route_should_return_success_with_token"),t(),e(1178,". One interesting idea of a test( See "),n(1179,"a",63),e(1180,"AsyncKeyedLockTest.cs"),t(),e(1181,") comes from "),n(1182,"a",64),e(1183,"AsyncKeyedLock"),t(),e(1184,`.
Also, we made some additional small changes in AspNetCoreRateLimit library by borrowing some ideas from `),n(1185,"a",65),e(1186,"Edi.CacheAside.InMemory"),t(),e(1187,". Finaly, we\u2019ve used following settings for our tests project:"),t(),n(1188,"h3",66)(1189,"span"),e(1190,"Test Settings"),t(),n(1191,"a",67),e(1192,"#"),t()(),n(1193,"pre",68)(1194,"code"),e(1195," "),n(1196,"span",69),e(1197,"{"),t(),e(1198,`
  `),n(1199,"span",70),e(1200,'"General"'),t(),n(1201,"span",69),e(1202,":"),t(),e(1203," "),n(1204,"span",69),e(1205,"{"),t(),e(1206,`
    `),n(1207,"span",70),e(1208,'"ReplaceMemoryCache"'),t(),n(1209,"span",69),e(1210,":"),t(),e(1211," "),n(1212,"span",46)(1213,"span",41),e(1214,"false"),t()(),e(1215,`
  `),n(1216,"span",69),e(1217,"}"),t(),n(1218,"span",69),e(1219,","),t(),e(1220,`

  `),n(1221,"span",70),e(1222,'"ApplicationSettings"'),t(),n(1223,"span",69),e(1224,":"),t(),e(1225," "),n(1226,"span",69),e(1227,"{"),t(),e(1228,`
    `),n(1229,"span",70),e(1230,'"SecurityTokenDescriptorKey"'),t(),n(1231,"span",69),e(1232,":"),t(),e(1233," "),n(1234,"span",48),e(1235,'"test1223dfgdfkffpie"'),t(),n(1236,"span",69),e(1237,","),t(),e(1238,`
    `),n(1239,"span",70),e(1240,'"SecurityTokenDescriptorExpiresInMinutes"'),t(),n(1241,"span",69),e(1242,":"),t(),e(1243," "),n(1244,"span",57),e(1245,"10"),t(),n(1246,"span",69),e(1247,","),t(),e(1248,`
    `),n(1249,"span",70),e(1250,'"SecurityTokenRefreshRate"'),t(),n(1251,"span",69),e(1252,":"),t(),e(1253," "),n(1254,"span",57),e(1255,"0.5"),t(),n(1256,"span",69),e(1257,","),t(),e(1258,`
    `),n(1259,"span",70),e(1260,'"MaxFailedAccessAttempts"'),t(),n(1261,"span",69),e(1262,":"),t(),e(1263," "),n(1264,"span",57),e(1265,"5"),t(),n(1266,"span",69),e(1267,","),t(),e(1268,`
    `),n(1269,"span",70),e(1270,'"DefaultLockoutTimeSpanInMinutes"'),t(),n(1271,"span",69),e(1272,":"),t(),e(1273," "),n(1274,"span",57),e(1275,"0"),t(),n(1276,"span",69),e(1277,","),t(),e(1278,`
    `),n(1279,"span",70),e(1280,'"ExperimentalIpAddress"'),t(),n(1281,"span",69),e(1282,":"),t(),e(1283," "),n(1284,"span",48),e(1285,'"::1"'),t(),e(1286,`
  `),n(1287,"span",69),e(1288,"}"),t(),n(1289,"span",69),e(1290,","),t(),e(1291,`

  `),n(1292,"span",70),e(1293,'"IpRateLimiting"'),t(),n(1294,"span",69),e(1295,":"),t(),e(1296," "),n(1297,"span",69),e(1298,"{"),t(),e(1299,`
    `),n(1300,"span",70),e(1301,'"EnableEndpointRateLimiting"'),t(),n(1302,"span",69),e(1303,":"),t(),e(1304," "),n(1305,"span",46)(1306,"span",41),e(1307,"true"),t()(),n(1308,"span",69),e(1309,","),t(),e(1310,`
    `),n(1311,"span",70),e(1312,'"SecurityTokenRefreshRate"'),t(),n(1313,"span",69),e(1314,":"),t(),e(1315," "),n(1316,"span",57),e(1317,"0.5"),t(),n(1318,"span",69),e(1319,","),t(),e(1320,`
    `),n(1321,"span",70),e(1322,'"StackBlockedRequests"'),t(),n(1323,"span",69),e(1324,":"),t(),e(1325," "),n(1326,"span",46)(1327,"span",41),e(1328,"false"),t()(),n(1329,"span",69),e(1330,","),t(),e(1331,`
    `),n(1332,"span",70),e(1333,'"RealIpHeader"'),t(),n(1334,"span",69),e(1335,":"),t(),e(1336," "),n(1337,"span",48),e(1338,'"X-Real-IP"'),t(),n(1339,"span",69),e(1340,","),t(),e(1341,`
    `),n(1342,"span",70),e(1343,'"HttpStatusCode"'),t(),n(1344,"span",69),e(1345,":"),t(),e(1346," "),n(1347,"span",57),e(1348,"429"),t(),n(1349,"span",69),e(1350,","),t(),e(1351,`
    `),n(1352,"span",70),e(1353,'"IpWhitelist"'),t(),n(1354,"span",69),e(1355,":"),t(),e(1356," "),n(1357,"span",69),e(1358,"["),t(),e(1359," "),n(1360,"span",48),e(1361,'"::1/10"'),t(),n(1362,"span",69),e(1363,","),t(),e(1364," "),n(1365,"span",48),e(1366,'"192.168.0.0/24"'),t(),e(1367," "),n(1368,"span",69),e(1369,"]"),t(),n(1370,"span",69),e(1371,","),t(),e(1372,`
    `),n(1373,"span",70),e(1374,'"EndpointWhitelist"'),t(),n(1375,"span",69),e(1376,":"),t(),e(1377," "),n(1378,"span",69),e(1379,"["),t(),e(1380,`
      `),n(1381,"span",48),e(1382,'"post:/api/v1.0/identity"'),t(),n(1383,"span",69),e(1384,","),t(),e(1385,`
      `),n(1386,"span",48),e(1387,'"post:/api/v1.0/identity/login"'),t(),n(1388,"span",69),e(1389,","),t(),e(1390,`
      `),n(1391,"span",48),e(1392,'"get:/*.json"'),t(),n(1393,"span",69),e(1394,","),t(),e(1395,`
      `),n(1396,"span",48),e(1397,'"get:/*.js"'),t(),n(1398,"span",69),e(1399,","),t(),e(1400,`
      `),n(1401,"span",48),e(1402,'"get:/*.css"'),t(),n(1403,"span",69),e(1404,","),t(),e(1405,`
      `),n(1406,"span",48),e(1407,'"get:/*.ico"'),t(),e(1408,`
    `),n(1409,"span",69),e(1410,"]"),t(),n(1411,"span",69),e(1412,","),t(),e(1413,`
    `),n(1414,"span",70),e(1415,'"ClientWhitelist"'),t(),n(1416,"span",69),e(1417,":"),t(),e(1418," "),n(1419,"span",69),e(1420,"["),t(),e(1421," "),n(1422,"span",48),e(1423,'"ClientWhitelist@email.com1"'),t(),e(1424," "),n(1425,"span",69),e(1426,"]"),t(),n(1427,"span",69),e(1428,","),t(),e(1429,`
    `),n(1430,"span",70),e(1431,'"QuotaExceededResponse"'),t(),n(1432,"span",69),e(1433,":"),t(),e(1434," "),n(1435,"span",69),e(1436,"{"),t(),e(1437,`
      `),n(1438,"span",70),e(1439,'"Content"'),t(),n(1440,"span",69),e(1441,":"),t(),e(1442," "),n(1443,"span",48),e(1444,'"Quota exceeded. Maximum allowed: {0} per {1}. Please try again in {2} second(s). Your IP address is {3}"'),t(),n(1445,"span",69),e(1446,","),t(),e(1447,`
      `),n(1448,"span",70),e(1449,'"ContentType"'),t(),n(1450,"span",69),e(1451,":"),t(),e(1452," "),n(1453,"span",48),e(1454,'"application/json"'),t(),e(1455,`
    `),n(1456,"span",69),e(1457,"}"),t(),n(1458,"span",69),e(1459,","),t(),e(1460,`
    `),n(1461,"span",70),e(1462,'"GeneralRules"'),t(),n(1463,"span",69),e(1464,":"),t(),e(1465," "),n(1466,"span",69),e(1467,"["),t(),e(1468,`
    `),n(1469,"span",69),e(1470,"]"),t(),e(1471,`
  `),n(1472,"span",69),e(1473,"}"),t(),n(1474,"span",69),e(1475,","),t(),e(1476,`

  `),n(1477,"span",70),e(1478,'"IpRateLimitPolicies"'),t(),n(1479,"span",69),e(1480,":"),t(),e(1481," "),n(1482,"span",69),e(1483,"{"),t(),e(1484,`
    `),n(1485,"span",70),e(1486,'"IpRules"'),t(),n(1487,"span",69),e(1488,":"),t(),e(1489," "),n(1490,"span",69),e(1491,"["),t(),e(1492,`
    `),n(1493,"span",69),e(1494,"]"),t(),e(1495,`
  `),n(1496,"span",69),e(1497,"}"),t(),e(1498,`
`),n(1499,"span",69),e(1500,"}"),t()()(),n(1501,"h2",71)(1502,"span"),e(1503,"Proof of Concept"),t(),n(1504,"a",72),e(1505,"#"),t()(),n(1506,"ol")(1507,"li"),e(1508,"Clone "),n(1509,"a",30),e(1510,"our GitHub repository"),t()(),n(1511,"li"),e(1512,"Follow the instruction form the Readme.md"),t(),n(1513,"li"),e(1514,"Change following in "),n(1515,"a",42),e(1516,"appsettings.json"),t(),e(1517,": "),n(1518,"code"),e(1519,"SecurityTokenDescriptorExpiresInMinutes"),t(),e(1520,": 10, "),n(1521,"code"),e(1522,"SecurityTokenRefreshRate"),t(),e(1523,": 0.9 (both places)"),t(),n(1524,"li"),e(1525,"Sign-in as admin using menu: Home -> Sign-in"),t(),n(1526,"li"),e(1527,"Go to menu Admin->Articles editor"),t(),n(1528,"li"),e(1529,"Click on New Article button."),t(),n(1530,"li"),e(1531,"Fill in the form and wait for 2 minutes."),t(),n(1532,"li"),e(1533,"Click Submit button and Yes button"),t(),n(1534,"li"),e(1535,"A drawer must show up asking to confirm password. It means that your JWT token expired, but you can refresh it."),t()(),n(1536,"h2",73)(1537,"span"),e(1538,"Conclusion"),t(),n(1539,"a",74),e(1540,"#"),t()(),n(1541,"p"),e(1542,"In this article, we introduced JWT token Refresh period concept and used a middleware to implement it. In fact, we used modified source code of RateLimitMiddleware from AspNetCoreRateLimit library. It means that it still can be used to limit public endpoints (See "),n(1543,"a",42),e(1544,"GeneralRules"),t(),e(1545," example). We implemented a way for testing the middleware with MyTested library. Finally, we provided a compiled .NET application for proof of concept."),t(),n(1546,"h2",75)(1547,"span"),e(1548,"Credits"),t(),n(1549,"a",76),e(1550,"#"),t()(),n(1551,"ul")(1552,"li")(1553,"a",77),e(1554,"Ivaylo Kenov"),t()(),n(1555,"li")(1556,"a",78),e(1557,"Kalin Tsenkov"),t()(),n(1558,"li")(1559,"a",79),e(1560,"Steve Smith"),t()(),n(1561,"li")(1562,"a",80),e(1563,"Jason Taylor"),t()(),n(1564,"li")(1565,"a",81),e(1566,"Stefan Prodan"),t()(),n(1567,"li")(1568,"a",82),e(1569,"Mark Cilia Vincenti"),t()(),n(1570,"li")(1571,"a",83),e(1572,"Jimmy Bogard"),t()(),n(1573,"li")(1574,"a",84),e(1575,"Ben Morris"),t()()()()()()),l&2&&(m(),c("nzBordered",!0),m(6),c("nzOffsetTop",45),m(6),V("ngModel",r.enableNavigation),c("ngModelOptions",W(7,Ri)),m(),c("nzOffsetTop",63)("nzAffix",!1)("nzShow",r.enableNavigation))},dependencies:[ee,X,$,xe,q,ce,ae,ie,ne,te,P,D,B,M,A,L,I,R,O,F,H,N,Q,J,le,re,de],encapsulation:2,changeDetection:0})}return a})();var Di=()=>({standalone:!0});function Pi(a,s){if(a&1){let i=_();f(0),n(1,"a",68),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",69),d(3,"nz-icon",70),t()(),w()}}function Fi(a,s){if(a&1){let i=_();f(0),n(1,"a",68),h("click",function(){u(i);let r=p();return E(r.clickLink())}),n(2,"h3",69),e(3,"Alexei Cioina's blog"),t()(),w()}}var Qn=(()=>{class a{router=x(Z);#e=x(G);viewPort=x(Y);zone=x(se);mermaidImport=x(pe,{optional:!0});mermaid;isMermaid=!1;enableNavigation=this.#e.selectors.isSwitcher();constructor(){this.isMermaid&&this.mermaidImport&&this.loadMermaid(this.mermaidImport)}ngAfterViewChecked(){this.isMermaid&&this.mermaid&&(this.isMermaid=!1,this.zone.runOutsideAngular(()=>this.mermaid?.default.run()))}loadMermaid(i){this.zone.runOutsideAngular(()=>oe(i).pipe(me()).subscribe(l=>{this.mermaid=l,this.mermaid.default.initialize({startOnLoad:!1}),this.mermaid?.default.run()}))}clickLink(){this.#e.selectors.isAdminArticles()?this.router.navigate(["admin","articles"]):this.router.navigate(["articles"])}disableEnable(){this.#e.setSwitcher(this.enableNavigation)}goLink(i){window&&(window.location.hash=i)}scrollTop(){window&&(window.location.hash=""),this.viewPort.scrollToPosition([0,0])}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["nz-blog-testing-angular-apps"]],decls:193,vars:8,consts:[[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","start"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],[1,"toc-affix",3,"nzOffsetTop"],["nz-row","","nzJustify","end"],["nz-button","","nzType","link","nzSize","small",3,"click"],["nzSize","small",3,"ngModelChange","ngModel","ngModelOptions"],["nzShowInkInFixed","",3,"nzClick","nzOffsetTop","nzAffix","nzShow"],["nzHref","#h-0b79795d","nzTitle","Introduction"],["nzHref","#h-c8cadc22","nzTitle","Testing tools for Angular"],["nzHref","#h-704dc335","nzTitle","Testing Angular app together with .NET Core app"],["nzHref","#h-eacbc5c7","nzTitle","Using Signal type in Angular together with Reactive State library"],["nzHref","#h-948a2e35","nzTitle","Credits"],[1,"markdown-title"],[1,"subtitle"],[1,"widget"],["aria-label","Edit this page on Github","href","https://github.com/cioina/cioina.azurewebsites.net/edit/main/blog/20241110-testing-angular-apps.md","target","_blank","rel","noopener noreferrer",1,"edit-button"],["nzType","edit"],[1,"markdown"],["id","h-0b79795d"],["onclick","window.location.hash = 'h-0b79795d'",1,"anchor"],[1,"pic-plus",2,"text-align","center"],["nzType","custom:zorro","nzWidth","180px","nzHeight","180px"],["nzType","custom:angular","nzWidth","180px","nzHeight","180px"],["nzType","custom:ng-zorro","nzWidth","180px","nzHeight","180px"],["href","https://cioina.azurewebsites.net/","target","_blank","rel","noopener"],["href","https://github.com/huajian123/ng-antd-admin","target","_blank","rel","noopener"],["href","https://github.com/AndyT2503/angular-conduit-signals","target","_blank","rel","noopener"],["href","https://github.com/NG-ZORRO/ng-zorro-antd/tree/master/components","target","_blank","rel","noopener"],["href","https://github.com/ant-design/ant-design-icons/tree/master/packages/icons-angular/src","target","_blank","rel","noopener"],["href","https://github.com/ngrx/platform/tree/main/modules/component-store/src","target","_blank","rel","noopener"],["href","https://github.com/AndyT2503/angular-conduit-signals/blob/dev/src/app/shared/store/auth.store.ts","target","_blank","rel","noopener"],["href","https://github.com/cioina/cioina.azurewebsites.net/tree/main/bin/Release/net9.0","target","_blank","rel","noopener"],["href","https://github.com/cioina/cioina.azurewebsites.net/tree/main/bin/Release/net9.0/wwwroot","target","_blank","rel","noopener"],["id","h-c8cadc22"],["onclick","window.location.hash = 'h-c8cadc22'",1,"anchor"],["href","https://github.com/NG-ZORRO/ng-zorro-antd/blob/master/package.json","target","_blank","rel","noopener"],["href","https://github.com/angular/angular/blob/main/adev/BUILD.bazel","target","_blank","rel","noopener"],[1,"language-javascript"],[1,"hljs-keyword"],[1,"hljs-title","class_"],[1,"hljs-string"],["id","h-704dc335"],["onclick","window.location.hash = 'h-704dc335'",1,"anchor"],["href","https://github.com/cioina/MyTested-test-project-example/tree/main/src/BlogAngular.Test/Test","target","_blank","rel","noopener"],["href","https://cioina.azurewebsites.net/articles/dotnet-core-testing","target","_blank","rel","noopener"],["href","https://github.com/cioina/angular-test-example/tree/main/version-2","target","_blank","rel","noopener"],["href","https://github.com/cioina/angular-test-example/blob/main/version-2/home.store.spec.ts","target","_blank","rel","noopener"],["href","https://github.com/gothinkster/realworld/blob/main/api/run-api-tests.sh","target","_blank","rel","noopener"],["href","https://github.com/cypress-io/cypress-example-conduit-app/blob/master/cypress/integration/login-spec.js","target","_blank","rel","noopener"],["href","https://github.com/stefanoslig/angular-ngrx-nx-realworld-example-app/blob/main/apps/conduit-e2e/src/e2e/login/login.ts","target","_blank","rel","noopener"],["id","h-eacbc5c7"],["onclick","window.location.hash = 'h-eacbc5c7'",1,"anchor"],["href","https://github.com/ngrx/platform","target","_blank","rel","noopener"],["href","https://github.com/cioina/angular-test-example/tree/main/version-1","target","_blank","rel","noopener"],["href","https://github.com/stefanoslig/angular-ngrx-nx-realworld-example-app/blob/main/libs/auth/data-access/src/auth.store.ts","target","_blank","rel","noopener"],["id","h-948a2e35"],["onclick","window.location.hash = 'h-948a2e35'",1,"anchor"],["href","https://github.com/angular/angular/graphs/contributors","target","_blank","rel","noopener"],["href","https://github.com/NG-ZORRO/ng-zorro-antd/graphs/contributors","target","_blank","rel","noopener"],["href","https://github.com/ant-design/ant-design-icons/graphs/contributors","target","_blank","rel","noopener"],["href","https://github.com/ngrx/platform/graphs/contributors","target","_blank","rel","noopener"],["href","https://github.com/huajian123","target","_blank","rel","noopener"],["href","https://github.com/AndyT2503","target","_blank","rel","noopener"],["href","https://github.com/stefanoslig","target","_blank","rel","noopener"],[3,"click"],["nz-typography","","nzType","success"],["nzType","arrow-left"]],template:function(l,r){l&1&&(n(0,"div",0)(1,"nz-card",1)(2,"div",2)(3,"div",3)(4,"nz-space",4),g(5,Pi,4,0,"ng-container",5)(6,Fi,4,0,"ng-container",5),t()()(),n(7,"nz-affix",6)(8,"div",7)(9,"div",3)(10,"a",8),h("click",function(){return r.scrollTop()}),e(11,"Jump to top"),t()(),n(12,"div",3)(13,"nz-switch",9),j("ngModelChange",function(S){return U(r.enableNavigation,S)||(r.enableNavigation=S),S}),h("ngModelChange",function(){return r.disableEnable()}),t()()(),n(14,"nz-anchor",10),h("nzClick",function(S){return r.goLink(S)}),d(15,"nz-link",11)(16,"nz-link",12)(17,"nz-link",13)(18,"nz-link",14)(19,"nz-link",15),t()(),n(20,"span",16),e(21," Testing Angular Applications"),d(22,"span",17)(23,"span",18),n(24,"a",19),d(25,"nz-icon",20),t()(),n(26,"article",21)(27,"h2",22)(28,"span"),e(29,"Introduction"),t(),n(30,"a",23),e(31,"#"),t()(),n(32,"div",24),d(33,"nz-icon",25),n(34,"span"),e(35,"+"),t(),d(36,"nz-icon",26),n(37,"span"),e(38,"="),t(),d(39,"nz-icon",27),t(),n(40,"p")(41,"a",28),e(42,"Our Angular app"),t(),e(43," Is based on "),n(44,"a",29),e(45,"ng-antd-admin"),t(),e(46," combined with "),n(47,"a",30),e(48,"angular-conduit-signals"),t(),e(49,". In addition, we use following Angular libraries direct form sources: "),n(50,"a",31),e(51,"NG-ZORRO components src"),t(),e(52,", "),n(53,"a",32),e(54,"icons-angular src"),t(),e(55," and "),n(56,"a",33),e(57,"component-store src"),t(),e(58," with some minor changes. All our reactive states look similar to "),n(59,"a",34),e(60,"auth.store.ts"),t(),e(61,`
The app communicates with the server via REST API controllers built on top of .NET Core 9. The compiled bin code is on `),n(62,"a",35),e(63,"our GitHub repository"),t(),e(64," together with "),n(65,"a",36),e(66,"compiled Angular app"),t()(),n(67,"h2",37)(68,"span"),e(69,"Testing tools for Angular"),t(),n(70,"a",38),e(71,"#"),t()(),n(72,"p"),e(73,"We use the same tools/packages as in "),n(74,"a",39),e(75,"NG-ZORRO"),t(),e(76,", which are the same as in "),n(77,"a",40),e(78,"TEST_DEPS"),t(),e(79," plus "),n(80,"code"),e(81,"puppeteer"),t(),e(82,". In addition, Angular and NG-ZORRO have a lot of classes and functions ready to use right out of the box:"),t(),n(83,"pre",41)(84,"code")(85,"span",42),e(86,"import"),t(),e(87," { "),n(88,"span",43),e(89,"ComponentFixture"),t(),e(90,", "),n(91,"span",43),e(92,"TestBed"),t(),e(93,", fakeAsync, tick, waitForAsync, inject "),n(94,"span",42),e(95,"as"),t(),e(96," testInject } "),n(97,"span",42),e(98,"from"),t(),e(99," "),n(100,"span",44),e(101,"'@angular/core/testing'"),t(),e(102,`;
`),n(103,"span",42),e(104,"import"),t(),e(105," { dispatchMouseEvent, dispatchFakeEvent, typeInElement } "),n(106,"span",42),e(107,"from"),t(),e(108," "),n(109,"span",44),e(110,"'ng-zorro-antd/core/testing'"),t(),e(111,`;
`),n(112,"span",42),e(113,"import"),t(),e(114," { provideNzIconsTesting } "),n(115,"span",42),e(116,"from"),t(),e(117," "),n(118,"span",44),e(119,"'ng-zorro-antd/icon/testing'"),t(),e(120,";"),t()(),n(121,"h2",45)(122,"span"),e(123,"Testing Angular app together with .NET Core app"),t(),n(124,"a",46),e(125,"#"),t()(),n(126,"p"),e(127,"Our actual(up to date) "),n(128,"a",47),e(129,"test project"),t(),e(130," for our .NET Core app uses in memory database which is very convenient for testing (read more about it "),n(131,"a",48),e(132,"here"),t(),e(133," ) Next, would be great to test on a real database. So, all our Angular test from "),n(134,"a",49),e(135,"our GitHub repository"),t(),e(136,` will connect with our .NET Core app which is connected to real MS SQL database. Therefore, it represents a type of integration test.
All the files ending in `),n(137,"a",50),e(138,"*.store.spec.ts"),t(),e(139," can be considered as real API testing which is an alternative to "),n(140,"a",51),e(141,"Newman"),t(),e(142," or "),n(143,"a",52),e(144,"cypress 1"),t(),n(145,"a",53),e(146,"cypress 2"),t()(),n(147,"h2",54)(148,"span"),e(149,"Using Signal type in Angular together with Reactive State library"),t(),n(150,"a",55),e(151,"#"),t()(),n(152,"p"),e(153,"Before Signal type became native in Angular, we used "),n(154,"a",56),e(155,"Reactive State library"),t(),e(156," for "),n(157,"a",57),e(158,"our integration tests"),t(),e(159,". Now, the library has implemented two ways of using Signals: "),n(160,"a",58),e(161,"@ngrx/signals"),t(),e(162," and "),n(163,"a",34),e(164,"@ngrx/component-store"),t(),e(165,". We use the second one direct from sources."),t(),n(166,"h2",59)(167,"span"),e(168,"Credits"),t(),n(169,"a",60),e(170,"#"),t()(),n(171,"ul")(172,"li")(173,"a",61),e(174,"Angular contributors"),t()(),n(175,"li")(176,"a",62),e(177,"NG-ZORRO contributors"),t()(),n(178,"li")(179,"a",63),e(180,"Ant Design contributors"),t()(),n(181,"li")(182,"a",64),e(183,"Reactive State for Angular contributors"),t()(),n(184,"li")(185,"a",65),e(186,"hua jian"),t()(),n(187,"li")(188,"a",66),e(189,"Andy Tu Hoang"),t()(),n(190,"li")(191,"a",67),e(192,"Stefanos Lignos"),t()()()()()()),l&2&&(m(),c("nzBordered",!0),m(6),c("nzOffsetTop",45),m(6),V("ngModel",r.enableNavigation),c("ngModelOptions",W(7,Di)),m(),c("nzOffsetTop",63)("nzAffix",!1)("nzShow",r.enableNavigation))},dependencies:[ee,X,$,xe,q,ce,ae,ie,ne,te,P,D,B,M,A,L,I,R,O,F,H,N,Q,J,le,re,de],encapsulation:2,changeDetection:0})}return a})();var ut=(()=>{class a extends kn{#e=x(G);#t=x(sn);#a=x(mn);#i=x(Y);articleListConfig=this.#e.selectors.articleListConfig;ngrxOnStoreInit(){this.setState({articleList:[],tags:[],articleCount:0})}getTags=this.effect(ot(i=>(i.loading.set(!0),this.#a.getTags(i.params).pipe(xt(l=>{this.patchState({tags:l.tags})},l=>{pt()?console.error("Get Tags Failed",l):console.warn(`Get Tags Failed: ${l.message}`)},()=>{i.loading.set(!1)})))));queryArticle=this.effect(qe(i=>{this.#e.patchState({articleListConfig:fe(ge({},this.articleListConfig()),{currentPage:i.params.offset?this.articleListConfig().currentPage:1,filters:{limit:i.params.limit,offset:i.params.offset,tags:i.params.tags,createdAtAsc:i.params.createdAtAsc}})}),this.#n(i.loading)}));onOffsetChange=this.effect(qe(i=>{this.#e.patchState({articleListConfig:fe(ge({},this.articleListConfig()),{currentPage:i.offset,filters:fe(ge({},this.articleListConfig().filters),{offset:Number(this.articleListConfig().filters.limit)*(i.offset-1)})})}),this.#i.scrollToPosition([0,0]),this.#n(i.loading)}));onLimitChange=this.effect(qe(i=>{this.#e.patchState({articleListConfig:fe(ge({},this.articleListConfig()),{currentPage:1,filters:fe(ge({},this.articleListConfig().filters),{limit:i.limit,offset:0})})}),this.#i.scrollToPosition([0,0]),this.#n(i.loading)}));#n=this.effect(ot(i=>(i.set(!0),(()=>{let l=this.articleListConfig()?.filters;return this.#t.getPublicArticles({limit:l.limit,offset:l.offset,tags:l.tags,createdAtAsc:l.createdAtAsc})})().pipe(xt(l=>{this.patchState({articleList:l.articles,articleCount:l.total})},l=>{pt()?console.error("getPublicArticles Failed",l):console.warn(`getPublicArticles Failed: ${l.message}`),this.#e.openMessageDrawer(Me(l.message))},()=>{i.set(!1)})))));static \u0275fac=(()=>{let i;return function(r){return(i||(i=Nt(a)))(r||a)}})();static \u0275prov=Ct({token:a,factory:a.\u0275fac})}return a})();var Oi=(a,s,i)=>[a,s,i];function Hi(a,s){a&1&&(n(0,"div",9),d(1,"nz-spin",11),t())}function Vi(a,s){if(a&1&&(d(0,"nz-icon",14),e(1)),a&2){let i=p().$implicit;m(),be(" ",i.title.length," ")}}function Ui(a,s){if(a&1&&(d(0,"nz-icon",15),e(1)),a&2){let i=p().$implicit;m(),be(" ",i.slug.length," ")}}function ji(a,s){if(a&1&&(d(0,"nz-icon",16),e(1)),a&2){let i=p().$implicit;m(),be(" ",i.id," ")}}function Wi(a,s){if(a&1){let i=_();n(0,"a",17),h("click",function(){u(i);let r=p().$implicit,o=p();return E(o.clickArticleLink(r))}),e(1),t()}if(a&2){let i=p().$implicit;m(),be(" ",i.title," ")}}function Ji(a,s){if(a&1&&e(0),a&2){let i=p(2).$implicit;be(" ",i.description," ")}}function Qi(a,s){if(a&1){let i=_();ue(0,Ji,1,1),n(1,"a",18),h("click",function(){u(i);let r=p().$implicit,o=p();return E(o.clickArticleLink(r))}),e(2,"Read more"),d(3,"nz-icon",19),t()}if(a&2){let i=p().$implicit,l=p();Ee(i.published?0:-1),m(),c("nzLoading",l.routerLinkLoadingId()===i.id)("disabled",l.routerLinkLoadingId()!==i.id&&l.routerLinkLoadingId()!==0)}}function Gi(a,s){if(a&1&&(n(0,"div",20)(1,"div",21)(2,"h5",22),e(3),Jt(4,"date"),t()()(),n(5,"div",23)(6,"div",24),d(7,"img",25),t()()),a&2){let i=p().$implicit,l=p();m(),c("id",mt(i.slug)),m(2),ze(Qt(4,9,i.createdAt,"MMMM d, yyyy")),m(4),c("nzSrc",Vt("https://picsum.photos/id/",i.id,"/300/200.jpg"))("alt",mt(i.title))("nzFallback",l.fallback)("nzPlaceholder",l.fallback)}}function qi(a,s){if(a&1&&(n(0,"nz-list-item",12),g(1,Vi,2,1,"ng-template",null,3,v)(3,Ui,2,1,"ng-template",null,4,v)(5,ji,2,1,"ng-template",null,5,v),n(7,"nz-list-item-meta",13),g(8,Wi,2,1,"ng-template",null,6,v)(10,Qi,4,3,"ng-template",null,7,v),t(),g(12,Gi,8,12,"ng-template",null,8,v),t()),a&2){let i=T(2),l=T(4),r=T(6),o=T(9),S=T(11),y=T(13);c("nzActions",Wt(4,Oi,i,l,r))("nzExtra",y),m(7),c("nzTitle",o)("nzDescription",S)}}function Ki(a,s){if(a&1&&(n(0,"div",20)(1,"div",24)(2,"h5",26),e(3),t()()()),a&2){let i=s,l=p(2);m(3),Ht(" ",l.articleListConfig().filters.limit*(l.articleListConfig().currentPage-1)+1," - ",l.articleListConfig().filters.limit*l.articleListConfig().currentPage>i?i:l.articleListConfig().filters.limit*l.articleListConfig().currentPage," of ",i," records ")}}function Yi(a,s){if(a&1&&ue(0,Ki,4,3,"div",20),a&2){let i,l=p();Ee((i=l.articlesCount())?0:-1,i)}}function Zi(a,s){if(a&1){let i=_();n(0,"nz-pagination",27),h("nzPageSizeChange",function(r){u(i);let o=p();return E(o.setPageSize(r))})("nzPageIndexChange",function(r){u(i);let o=p();return E(o.setPage(r))}),t()}if(a&2){let i=p();c("nzShowSizeChanger",!0)("nzPageSize",i.articleListConfig().filters.limit)("nzPageIndex",i.articleListConfig().currentPage)("nzTotal",i.articlesCount())}}var Gn=(()=>{class a{articleList;articlesCount;isLoading;articleListConfig;oldLimit;nzSetPage=new Re;nzSetPageSize=new Re;router=x(Z);changeDetectorRef=x(tt);routerLinkLoadingId=Me(0);fallback="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3PTWBSGcbGzM6GCKqlIBRV0dHRJFarQ0eUT8LH4BnRU0NHR0UEFVdIlFRV7TzRksomPY8uykTk/zewQfKw/9znv4yvJynLv4uLiV2dBoDiBf4qP3/ARuCRABEFAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghggQAQZQKAnYEaQBAQaASKIAQJEkAEEegJmBElAoBEgghgg0Aj8i0JO4OzsrPv69Wv+hi2qPHr0qNvf39+iI97soRIh4f3z58/u7du3SXX7Xt7Z2enevHmzfQe+oSN2apSAPj09TSrb+XKI/f379+08+A0cNRE2ANkupk+ACNPvkSPcAAEibACyXUyfABGm3yNHuAECRNgAZLuYPgEirKlHu7u7XdyytGwHAd8jjNyng4OD7vnz51dbPT8/7z58+NB9+/bt6jU/TI+AGWHEnrx48eJ/EsSmHzx40L18+fLyzxF3ZVMjEyDCiEDjMYZZS5wiPXnyZFbJaxMhQIQRGzHvWR7XCyOCXsOmiDAi1HmPMMQjDpbpEiDCiL358eNHurW/5SnWdIBbXiDCiA38/Pnzrce2YyZ4//59F3ePLNMl4PbpiL2J0L979+7yDtHDhw8vtzzvdGnEXdvUigSIsCLAWavHp/+qM0BcXMd/q25n1vF57TYBp0a3mUzilePj4+7k5KSLb6gt6ydAhPUzXnoPR0dHl79WGTNCfBnn1uvSCJdegQhLI1vvCk+fPu2ePXt2tZOYEV6/fn31dz+shwAR1sP1cqvLntbEN9MxA9xcYjsxS1jWR4AIa2Ibzx0tc44fYX/16lV6NDFLXH+YL32jwiACRBiEbf5KcXoTIsQSpzXx4N28Ja4BQoK7rgXiydbHjx/P25TaQAJEGAguWy0+2Q8PD6/Ki4R8EVl+bzBOnZY95fq9rj9zAkTI2SxdidBHqG9+skdw43borCXO/ZcJdraPWdv22uIEiLA4q7nvvCug8WTqzQveOH26fodo7g6uFe/a17W3+nFBAkRYENRdb1vkkz1CH9cPsVy/jrhr27PqMYvENYNlHAIesRiBYwRy0V+8iXP8+/fvX11Mr7L7ECueb/r48eMqm7FuI2BGWDEG8cm+7G3NEOfmdcTQw4h9/55lhm7DekRYKQPZF2ArbXTAyu4kDYB2YxUzwg0gi/41ztHnfQG26HbGel/crVrm7tNY+/1btkOEAZ2M05r4FB7r9GbAIdxaZYrHdOsgJ/wCEQY0J74TmOKnbxxT9n3FgGGWWsVdowHtjt9Nnvf7yQM2aZU/TIAIAxrw6dOnAWtZZcoEnBpNuTuObWMEiLAx1HY0ZQJEmHJ3HNvGCBBhY6jtaMoEiJB0Z29vL6ls58vxPcO8/zfrdo5qvKO+d3Fx8Wu8zf1dW4p/cPzLly/dtv9Ts/EbcvGAHhHyfBIhZ6NSiIBTo0LNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiECRCjUbEPNCRAhZ6NSiAARCjXbUHMCRMjZqBQiQIRCzTbUnAARcjYqhQgQoVCzDTUnQIScjUohAkQo1GxDzQkQIWejUogAEQo121BzAkTI2agUIkCEQs021JwAEXI2KoUIEKFQsw01J0CEnI1KIQJEKNRsQ80JECFno1KIABEKNdtQcwJEyNmoFCJAhELNNtScABFyNiqFCBChULMNNSdAhJyNSiEC/wGgKKC4YMA4TAAAAABJRU5ErkJggg==";clickArticleLink(i){this.routerLinkLoadingId.set(i.id),this.changeDetectorRef.markForCheck(),setTimeout(()=>{this.router.navigate(["articles",i.slug])})}setPage(i){this.oldLimit()===this.articleListConfig().filters.limit?this.nzSetPage.emit(i):this.oldLimit.set(this.articleListConfig().filters.limit)}setPageSize(i){this.articleListConfig().currentPage>Math.ceil(this.articlesCount()/i)?this.oldLimit.set(this.articleListConfig().filters.limit):this.oldLimit.set(i),this.nzSetPageSize.emit(i)}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["app-articles"]],inputs:{articleList:"articleList",articlesCount:"articlesCount",isLoading:"isLoading",articleListConfig:"articleListConfig",oldLimit:"oldLimit"},outputs:{nzSetPage:"nzSetPage",nzSetPageSize:"nzSetPageSize"},decls:8,vars:7,consts:[["item",""],["footer",""],["pagination",""],["starAction",""],["likeAction",""],["msgAction",""],["nzTitle",""],["nzDescription",""],["extra",""],[1,"app-article-preview"],[3,"hidden","nzDataSource","nzItemLayout","nzRenderItem","nzPagination","nzFooter"],["nzTip","Loading posts..."],[3,"nzActions","nzExtra"],[3,"nzTitle","nzDescription"],["nzType","star-o",2,"margin-right","8px"],["nzType","like-o",2,"margin-right","8px"],["nzType","message",2,"margin-right","8px"],[3,"click"],["nz-button","","nzType","link",3,"click","nzLoading","disabled"],["nzType","arrow-right"],["nz-row","","nzJustify","end"],["nz-col","",3,"id"],["nz-typography","","nzType","secondary"],["nz-row",""],["nz-col",""],["nz-image","","width","300px","height","200px",3,"nzSrc","nzFallback","nzPlaceholder","alt"],["nz-typography",""],[3,"nzPageSizeChange","nzPageIndexChange","nzShowSizeChanger","nzPageSize","nzPageIndex","nzTotal"]],template:function(l,r){if(l&1&&(ue(0,Hi,2,0,"div",9),n(1,"nz-list",10),g(2,qi,14,8,"ng-template",null,0,v)(4,Yi,1,1,"ng-template",null,1,v)(6,Zi,1,4,"ng-template",null,2,v),t()),l&2){let o=T(3),S=T(5),y=T(7);Ee(r.isLoading()?0:-1),m(),c("hidden",r.isLoading())("nzDataSource",r.articleList())("nzItemLayout","vertical")("nzRenderItem",o)("nzPagination",y)("nzFooter",S)}},dependencies:[Yt,wn,fn,P,D,B,Rn,Nn,In,Mn,N,dn,H,_n,Dn,Bn,L,I,R,M,A,He,O,F],encapsulation:2,changeDetection:0})}return a})();var ea=()=>({overflow:"auto",display:"block",width:"100%"}),ta=(a,s)=>[a,s],qn=()=>({standalone:!0});function na(a,s){if(a&1&&(f(0),n(1,"h5",16),d(2,"nz-icon",17),t(),w()),a&2){let i=p(2);m(2),c("nzTooltipTitle",i.applyTooltipTitle)}}function ia(a,s){a&1&&g(0,na,3,1,"ng-container",11)}function aa(a,s){if(a&1){let i=_();f(0),n(1,"button",18),h("nzOnConfirm",function(){u(i);let r=p();return E(r.confirmApply())}),d(2,"nz-icon",19),e(3," Apply "),t(),w()}if(a&2){let i=p(),l=T(9);m(),c("disabled",i.disableApply())("nzIcon",l)}}function ra(a,s){if(a&1){let i=_();f(0),n(1,"button",20),h("nzOnConfirm",function(){u(i);let r=p();return E(r.confirmClose())}),d(2,"nz-icon",21),e(3," Close "),t(),w()}if(a&2){p();let i=T(7);m(),c("nzIcon",i)("nzOkDanger",!0)}}function la(a,s){a&1&&(f(0),n(1,"h4",16),d(2,"nz-icon",22),t(),w())}function oa(a,s){a&1&&(f(0),n(1,"h5",23),e(2,"Do you want to close without changes?"),t(),w())}function sa(a,s){a&1&&(n(0,"nz-space",10),g(1,la,3,0,"ng-container",11)(2,oa,3,0,"ng-container",11),t())}function ma(a,s){a&1&&(f(0),n(1,"h4",24),d(2,"nz-icon",22),t(),w())}function da(a,s){a&1&&(f(0),n(1,"h5",23),e(2,"Do you want to apply changes?"),t(),w())}function pa(a,s){a&1&&(n(0,"nz-space",10),g(1,ma,3,0,"ng-container",11)(2,da,3,0,"ng-container",11),t())}function ca(a,s){if(a&1){let i=_();f(0),n(1,"nz-switch",25),j("ngModelChange",function(r){u(i);let o=p();return U(o.isAscending,r)||(o.isAscending=r),E(r)}),h("click",function(){u(i);let r=p();return E(r.ascendingEnable())}),t(),w()}if(a&2){let i=p();m(),V("ngModel",i.isAscending),c("ngModelOptions",W(2,qn))}}function xa(a,s){if(a&1){let i=_();f(0),n(1,"nz-switch",26),j("ngModelChange",function(r){u(i);let o=p();return U(o.showSearch,r)||(o.showSearch=r),E(r)}),h("click",function(){u(i);let r=p();return E(r.disableEnable())}),t(),w()}if(a&2){let i=p();m(),V("ngModel",i.showSearch),c("ngModelOptions",W(3,qn))("disabled",i.leftSearch||i.rightSearch)}}function ha(a,s){a&1&&(f(0),n(1,"h5",16),d(2,"nz-icon",27),t(),w())}function Sa(a,s){a&1&&g(0,ha,3,0,"ng-container",11)}function ua(a,s){a&1&&(f(0),n(1,"h4",33),e(2,"Remaining Tags"),t(),w())}function Ea(a,s){a&1&&(f(0),n(1,"h5",33),d(2,"nz-icon",34),t(),w())}function ga(a,s){if(a&1&&d(0,"nz-option",30),a&2){let i=s.$implicit;c("nzLabel",i.label)("nzValue",i.value)}}function fa(a,s){if(a&1&&(d(0,"nz-icon",35),e(1)),a&2){let i=s.$implicit;c("nzType","sort-"+i.nzValue),m(),be(" ",i.nzLabel," ")}}function wa(a,s){if(a&1){let i=_();n(0,"tr",36),h("click",function(){let r=u(i).$implicit,o=p().onItemSelect;return E(o(r))}),n(1,"td",37),h("nzCheckedChange",function(){let r=u(i).$implicit,o=p().onItemSelect;return E(o(r))}),t(),n(2,"td"),e(3),t()()}if(a&2){let i=s.$implicit,l=p().disabled;m(),c("nzChecked",i.checked)("nzDisabled",l||i.disabled),m(2),ze(i.title)}}function _a(a,s){if(a&1){let i=_();n(0,"div",28)(1,"div",9)(2,"nz-space",10),g(3,ua,3,0,"ng-container",11)(4,Ea,3,0,"ng-container",11),t()()(),n(5,"div",28)(6,"div",9)(7,"nz-select",29),j("ngModelChange",function(r){u(i);let o=p();return U(o.orderModelLeft,r)||(o.orderModelLeft=r),E(r)}),h("ngModelChange",function(r){u(i);let o=p();return E(o.handleOrderLeft(r))}),je(8,ga,1,2,"nz-option",30,Ue),t(),g(10,fa,2,2,"ng-template",null,4,v),t()(),n(12,"nz-table",31,5)(14,"thead")(15,"tr")(16,"th",32),h("nzCheckedChange",function(r){let o=u(i).onItemSelectAll;return E(o(r))}),t(),n(17,"th"),e(18,"All"),t()()(),n(19,"tbody"),je(20,wa,4,3,"tr",null,Ue),t()()}if(a&2){let i=s.$implicit,l=s.stat,r=s.disabled,o=T(11),S=T(13),y=p();m(7),c("nzBackdrop",!0)("nzCustomTemplate",o),V("ngModel",y.orderModelLeft),m(),We(y.listOfOption),m(4),c("nzData",y.convertItemsRight(i)),m(4),c("nzDisabled",r)("nzChecked",l.checkAll)("nzIndeterminate",l.checkHalf),m(4),We(S.data)}}function za(a,s){a&1&&(f(0),n(1,"h4",24),e(2,"Selected Tags"),t(),w())}function ba(a,s){a&1&&(f(0),n(1,"h5",24),d(2,"nz-icon",38),t(),w())}function ya(a,s){if(a&1&&d(0,"nz-option",30),a&2){let i=s.$implicit;c("nzLabel",i.label)("nzValue",i.value)}}function Ca(a,s){if(a&1&&(d(0,"nz-icon",35),e(1)),a&2){let i=s.$implicit;c("nzType","sort-"+i.nzValue),m(),be(" ",i.nzLabel," ")}}function Ta(a,s){if(a&1){let i=_();n(0,"tr",36),h("click",function(){let r=u(i).$implicit,o=p().onItemSelect;return E(o(r))}),n(1,"td",37),h("nzCheckedChange",function(){let r=u(i).$implicit,o=p().onItemSelect;return E(o(r))}),t(),n(2,"td"),e(3),t()()}if(a&2){let i=s.$implicit,l=p().disabled;m(),c("nzChecked",i.checked)("nzDisabled",l||i.disabled),m(2),ze(i.title)}}function ka(a,s){if(a&1){let i=_();n(0,"div",28)(1,"div",9)(2,"nz-space",10),g(3,za,3,0,"ng-container",11)(4,ba,3,0,"ng-container",11),t()()(),n(5,"div",28)(6,"div",9)(7,"nz-select",29),j("ngModelChange",function(r){u(i);let o=p();return U(o.orderModelRight,r)||(o.orderModelRight=r),E(r)}),h("ngModelChange",function(r){u(i);let o=p();return E(o.handleOrderRight(r))}),je(8,ya,1,2,"nz-option",30,Ue),t(),g(10,Ca,2,2,"ng-template",null,6,v),t()(),n(12,"nz-table",31,7)(14,"thead")(15,"tr")(16,"th",32),h("nzCheckedChange",function(r){let o=u(i).onItemSelectAll;return E(o(r))}),t(),n(17,"th"),e(18,"All"),t()()(),n(19,"tbody"),je(20,Ta,4,3,"tr",null,Ue),t()()}if(a&2){let i=s.$implicit,l=s.stat,r=s.disabled,o=T(11),S=T(13),y=p();m(7),c("nzBackdrop",!0)("nzCustomTemplate",o),V("ngModel",y.orderModelRight),m(),We(y.listOfOption),m(4),c("nzData",y.convertItemsLeft(i)),m(4),c("nzDisabled",r)("nzChecked",l.checkAll)("nzIndeterminate",l.checkHalf),m(4),We(S.data)}}var Kn=(()=>{class a{params;nzMessageService=x(Tn);drawerRef=x(rn);selectedCount=0;list=[];showSearch=!1;leftSearch=!1;rightSearch=!1;selectedTags=[];applyTooltipTitle="";orderModelLeft=null;orderModelRight=null;listOfOption=[{label:"Ascending",value:"ascending"},{label:"Descending",value:"descending"}];sortOrder=null;isAscending=!1;createdAtAsc=null;initialCreatedAtAsc=null;isTagListChange(){let i=this.selectedTags||[];if(this.selectedTags=[],this.list.filter(r=>r.direction==="right").forEach(r=>this.selectedTags.push(r.id)),this.createdAtAsc!==this.initialCreatedAtAsc||i?.length!==this.selectedTags.length)return!0;let l=!0;return i.forEach(r=>l=l&&this.selectedTags.includes(r)),!l}ngOnInit(){this.params.createdAtAsc===void 0?(this.isAscending=!1,this.createdAtAsc=null):(this.isAscending=this.params.createdAtAsc,this.createdAtAsc=this.isAscending),this.initialCreatedAtAsc=this.createdAtAsc,this.params.tags?this.selectedTags=this.params.tags:(this.selectedTags=[],this.params.tagList.forEach(i=>this.selectedTags.push(i.id))),this.list=[],this.params.tagList.forEach(i=>this.list.push({title:i.title,id:i.id,direction:this.selectedTags.includes(i.id)?"right":"left"})),this.selectedCount=this.selectedTags.length}ascendingEnable(){this.isAscending?this.createdAtAsc=null:this.createdAtAsc=!0}disableEnable(){this.showSearch||(this.showSearch=this.leftSearch||this.rightSearch)}handleSearchChange(i){i.direction==="left"?this.leftSearch=i.value!=="":this.rightSearch=i.value!==""}handleChange(i){i.from==="right"?(this.orderModelLeft=null,this.sortOrder={direction:"left",sortOrder:null},this.selectedCount-=i.list.length):(this.orderModelRight=null,this.sortOrder={direction:"right",sortOrder:null},this.selectedCount+=i.list.length)}handleFilterOption(i,l){return l.title.toLowerCase().includes(i.toLowerCase())}confirmClose(){this.isTagListChange()&&this.nzMessageService.warning("Changes were not saved!"),this.drawerRef.close(!1)}disableApply(){return this.selectedCount<1?(this.applyTooltipTitle="It should be at least one selected tag.",!0):this.selectedCount>100?(this.applyTooltipTitle="It should not be more than 100 selected tags.",!0):!1}confirmApply(){this.isTagListChange()?(this.nzMessageService.info("Applying selected tags."),this.selectedTags.length===this.list.length&&(this.selectedTags=null),this.drawerRef.close({tags:this.selectedTags,createdAtAsc:this.createdAtAsc})):this.drawerRef.close(null)}convertItemsRight(i){return i.filter(l=>!l.hide)}convertItemsLeft(i){return i.filter(l=>!l.hide)}handleOrderRight(i){this.sortOrder={direction:"right",sortOrder:i}}handleOrderLeft(i){this.sortOrder={direction:"left",sortOrder:i}}static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["app-article-listing-tags"]],inputs:{params:"params"},decls:25,vars:14,consts:[["closeTpl",""],["applyTpl",""],["renderList",""],["renderSelectedList",""],["orderTemplateLeft",""],["t1",""],["orderTemplateRight",""],["t2",""],["nz-row","","nzJustify","end",1,"m-b-20"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],["nz-row","","nzJustify","end"],["nz-row","","nzJustify","start",1,"m-b-20"],["nzSize","small","nzAlign","center"],[3,"nzSearchChange","nzChange","nzDataSource","nzShowSearch","nzShowSelectAll","nzFilterOption","nzRenderList","nzSortOrder"],["nz-typography","","nzType","danger"],["nzType","info-circle","nz-tooltip","",3,"nzTooltipTitle"],["nz-button","","nzType","primary","nzShape","round","nz-popconfirm","","nzPopconfirmTitle"," ","nzPopconfirmShowArrow","false","nzOkText","Yes","nzCancelText","No",3,"nzOnConfirm","disabled","nzIcon"],["nzType","check"],["nz-button","","nzDanger","true","nzShape","round","nz-popconfirm","","nzPopconfirmTitle"," ","nzPopconfirmShowArrow","false","nzOkText","Yes","nzCancelText","No",3,"nzOnConfirm","nzIcon","nzOkDanger"],["nzType","close"],["nzType","question-circle-o"],["nz-typography",""],["nz-typography","","nzType","success"],["nzCheckedChildren","Oldest articles first","nzUnCheckedChildren","Newest articles first",3,"ngModelChange","click","ngModel","ngModelOptions"],["nzCheckedChildren","Hide Search","nzUnCheckedChildren","Show Search",3,"ngModelChange","click","ngModel","ngModelOptions","disabled"],["nzType","info-circle","nz-tooltip","","nzTooltipTitle","Clear out all search boxes in order to hide them."],["nz-row","","nzJustify","center"],["nzAllowClear","","nzPlaceHolder","Sort Order...",3,"ngModelChange","nzBackdrop","nzCustomTemplate","ngModel"],[3,"nzLabel","nzValue"],["nzSize","small",3,"nzData"],["nzShowCheckbox","",3,"nzCheckedChange","nzDisabled","nzChecked","nzIndeterminate"],["nz-typography","","nzType","warning"],["nzType","info-circle","nz-tooltip","","nzTooltipTitle","Here are all remaining tags."],[3,"nzType"],[3,"click"],["nzShowCheckbox","",3,"nzCheckedChange","nzChecked","nzDisabled"],["nzType","info-circle","nz-tooltip","","nzTooltipTitle","Here are all selected tags."]],template:function(l,r){if(l&1){let o=_();n(0,"div",8)(1,"div",9)(2,"nz-space",10),ue(3,ia,1,0,"ng-container"),g(4,aa,4,2,"ng-container",11)(5,ra,4,2,"ng-container",11),t()(),g(6,sa,3,0,"ng-template",null,0,v)(8,pa,3,0,"ng-template",null,1,v),t(),n(10,"div",12)(11,"div",9)(12,"nz-space",10),g(13,ca,2,3,"ng-container",11),t()()(),n(14,"div",13)(15,"div",9)(16,"nz-space",14),g(17,xa,2,4,"ng-container",11),ue(18,Sa,1,0,"ng-container"),t()()(),n(19,"div")(20,"nz-transfer",15),h("nzSearchChange",function(y){return u(o),E(r.handleSearchChange(y))})("nzChange",function(y){return u(o),E(r.handleChange(y))}),g(21,_a,22,7,"ng-template",null,2,v)(23,ka,22,7,"ng-template",null,3,v),t()()}if(l&2){let o=T(22),S=T(24);m(3),Ee(r.disableApply()?3:-1),m(15),Ee(r.leftSearch||r.rightSearch?18:-1),m(),et(W(10,ea)),m(),c("nzDataSource",r.list)("nzShowSearch",r.showSearch)("nzShowSelectAll",!1)("nzFilterOption",r.handleFilterOption)("nzRenderList",jt(11,ta,o,S))("nzSortOrder",r.sortOrder)}},dependencies:[ee,X,$,L,I,R,rt,on,P,D,B,M,A,He,lt,N,Q,J,H,Cn,zn,pn,xn,cn,yn,Sn,bn,hn,Fn,Pn,nn,tn,le,re,gn,un,En,O,F],encapsulation:2,changeDetection:0})}return a})();var va=["drawerTitleTemplate"];function Aa(a,s){a&1&&(f(0),n(1,"h4",13),d(2,"nz-icon",14),t(),w())}function Ma(a,s){a&1&&(f(0),n(1,"h5",15),e(2,"Do you want to reload all articles?"),t(),w())}function Na(a,s){a&1&&(n(0,"nz-space",7),g(1,Aa,3,0,"ng-container",8)(2,Ma,3,0,"ng-container",8),t())}function Ia(a,s){if(a&1){let i=_();f(0),n(1,"button",11),h("nzOnConfirm",function(){u(i);let r=p();return E(r.selectAll())}),d(2,"nz-icon",12),t(),g(3,Na,3,0,"ng-template",null,1,v),w()}if(a&2){let i=T(4),l=p();m(),c("nzLoading",l.isArticlesLoading())("nzIcon",i)}}function Ra(a,s){if(a&1){let i=_();f(0),n(1,"button",16),h("click",function(){u(i);let r=p();return E(r.openTagsFilter())}),d(2,"nz-icon",17),e(3," Tags "),t(),n(4,"nz-badge",18),d(5,"a",19),t(),w()}if(a&2){let i=p();m(),c("nzLoading",i.isTagsLoading()),m(3),c("nzCount",i.tagCount())}}function La(a,s){if(a&1&&(n(0,"div",5)(1,"div",6)(2,"h3",20),e(3),t()()()),a&2){let i=p();m(3),ze(i.drawerTitle)}}var Xn=(()=>{class a{drawerTitleTemplate=qt("drawerTitleTemplate");#e=x(ut);#t=x(G);articleListConfig=this.#t.selectors.articleListConfig;windowWidth=this.#t.selectors.width;articleCount=this.#e.selectors.articleCount;articleList=this.#e.selectors.articleList;tagList=this.#e.selectors.tags;drawerService=x(ln);isTagsLoading=Me(!1);isArticlesLoading=Me(!1);tagCount=Gt(()=>this.articleListConfig()?.filters.tags?this.articleListConfig().filters.tags.length:0);oldLimit=Me(this.articleListConfig().filters.limit);drawerTitle="";noCancel(){return new Promise(l=>{try{l(!1)}finally{}})}ngOnInit(){this.#t.setAdminArticles(!1);let i=this.articleListConfig()?.filters;(i?.tags===void 0||i?.tags===null)&&(i?.createdAtAsc===void 0||i?.createdAtAsc===null)?this.selectAll():(this.#e.getTags({loading:this.isTagsLoading,params:null}),this.#e.queryArticle({loading:this.isArticlesLoading,params:{limit:i.limit,offset:0,tags:i.tags,createdAtAsc:i.createdAtAsc}}))}selectAll(){this.#e.getTags({loading:this.isTagsLoading,params:null}),this.#e.queryArticle({loading:this.isArticlesLoading,params:{limit:10,offset:0}}),this.oldLimit.set(10)}onPageOffsetChange(i){this.#e.onOffsetChange({loading:this.isArticlesLoading,offset:i})}onPageLimitChange(i){this.#e.onLimitChange({loading:this.isArticlesLoading,limit:i})}openTagsFilter(){if(this.isTagsLoading())return;this.isTagsLoading.set(!0),this.drawerTitle="Article Tags";let i=this.articleListConfig()?.filters;this.drawerService.create({nzTitle:this.drawerTitleTemplate(),nzContent:Kn,nzWidth:this.windowWidth()>600?600:this.windowWidth(),nzClosable:!1,nzOnCancel:this.noCancel,nzContentParams:{params:{tagList:this.tagList(),tags:i.tags,createdAtAsc:i.createdAtAsc}}}).afterClose.subscribe(r=>{if(r){let o=this.articleListConfig()?.filters;this.#e.queryArticle({loading:this.isArticlesLoading,params:fe(ge({},r),{limit:o.limit,offset:0})})}this.isTagsLoading.set(!1)})}pageHeaderInfo={title:"Articles",desc:"This page is a symbiose between dynamic (.NET Core, SQL Server database) and static (JavaScript, CSS, icon, etc.) resources. All articles are served as static content from JavaScript files compiled by Angular framework. In addition, JavaScript files are served via lazy loading. Articles metadata is stored in the database and served dynamically by .NET Core API controllers."};static \u0275fac=function(l){return new(l||a)};static \u0275cmp=C({type:a,selectors:[["app-home-listing"]],viewQuery:function(l,r){l&1&&Ft(r.drawerTitleTemplate,va,5),l&2&&Ot()},features:[Ut([an(ut)])],decls:14,vars:7,consts:[["drawerTitleTemplate",""],["applyTpl",""],[3,"pageHeaderInfo"],[1,"normal-table-wrap","bg-color-no","p-b-50"],[1,"m-b-20",3,"nzBordered"],["nz-row","","nzJustify","center"],["nz-col",""],["nzSize","small","nzAlign","baseline"],[4,"nzSpaceItem"],["nz-row","","nzJustify","end"],[3,"nzSetPage","nzSetPageSize","articleList","articlesCount","isLoading","articleListConfig","oldLimit"],["nz-button","","nzType","primary","nzShape","circle","nz-popconfirm","","nzPopconfirmTitle"," ","nzPopconfirmShowArrow","false","nzOkText","Yes","nzCancelText","No",3,"nzOnConfirm","nzLoading","nzIcon"],["nzType","sync"],["nz-typography","","nzType","success"],["nzType","question-circle-o"],["nz-typography",""],["nz-button","","nzType","primary","nzShape","round",3,"click","nzLoading"],["nzType","tag"],[3,"nzCount"],[1,"head-example"],["nz-typography","","nzType","warning"]],template:function(l,r){if(l&1){let o=_();d(0,"app-page-header",2),n(1,"div",3)(2,"nz-card",4)(3,"div",5)(4,"div",6)(5,"nz-space",7),g(6,Ia,5,2,"ng-container",8),t()()(),n(7,"div",9)(8,"div",6)(9,"nz-space",7),g(10,Ra,6,2,"ng-container",8),t()()(),n(11,"app-articles",10),h("nzSetPage",function(y){return u(o),E(r.onPageOffsetChange(y))})("nzSetPageSize",function(y){return u(o),E(r.onPageLimitChange(y))}),t(),g(12,La,4,1,"ng-template",null,0,v),t()()}l&2&&(c("pageHeaderInfo",r.pageHeaderInfo),m(2),c("nzBordered",!0),m(9),c("articleList",r.articleList)("articlesCount",r.articleCount)("isLoading",r.isArticlesLoading)("articleListConfig",r.articleListConfig)("oldLimit",r.oldLimit))},dependencies:[Ln,Gn,An,vn,L,I,R,rt,ne,te,M,A,He,lt,N,Q,J,H,O,F,P,D,B],encapsulation:2,changeDetection:0})}return a})();var am=[{path:"",pathMatch:"full",title:"Articles",data:{key:"articles"},component:Xn},{path:"what-version-of-this-blog",title:"What Version?",data:{key:"what-version-of-this-blog"},component:Hn},{path:"svg-icons",title:"SVG Icons",data:{key:"svg-icons"},component:Vn},{path:"dotnet-core-testing",title:"ASP.NET Testing",data:{key:"dotnet-core-testing"},component:Un},{path:"about-this-blog",title:"My Blog",data:{key:"about-this-blog"},component:jn},{path:"test-readme",title:"MyTested Example",data:{key:"test-readme"},component:Wn},{path:"ratelimit-middleware",title:"JWT Token Refresh",data:{key:"ratelimit-middleware"},component:Jn},{path:"testing-angular-apps",title:"Testing Angular Apps",data:{key:"testing-angular-apps"},component:Qn}];export{am as BLOG_ROUTES};
