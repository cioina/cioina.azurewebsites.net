import{z as ot}from"./chunk-IFNOIDAT.js";import{s as it}from"./chunk-QFU3VBWG.js";import{D as J,E as p,aa as K,da as Q,ea as tt,fa as et,i as X,u as Y}from"./chunk-YV7GLJ3M.js";import{a as d}from"./chunk-OOMKWNMR.js";import{Aa as V,Ba as $,Db as U,G as x,Gb as Z,Hb as G,K as m,O as N,Pa as j,Tc as W,Vb as g,Xb as C,ac as q,ba as A,bc as E,cc as z,dc as B,f as b,g as h,ga as F,h as y,ha as R,ia as _,lb as f,ma as n,r as M,rc as H,v as u,w as T,wd as v,xb as k,yb as P}from"./chunk-OIBKXX4P.js";import{a as o}from"./chunk-3XFQOAE3.js";var a={UNLOAD:"unload",LOADING:"loading",LOADED:"LOADED"};var O="codeEditor";function I(e){return(...c)=>{e&&e(...c)}}var D=new y(1),l=a.UNLOAD,rt=(()=>{class e{nzConfigService=n(tt);document=n(V);firstEditorInitialized=!1;option={};config;option$=new h(this.option);constructor(){let t=this.nzConfigService.getConfigForComponent(O);this.config=o({},t),this.config.monacoEnvironment&&(window.MonacoEnvironment=o({},this.config.monacoEnvironment)),this.option=this.config.defaultEditorOption||{},et(O,()=>{let i=this.nzConfigService.getConfigForComponent(O);i&&this._updateDefaultOption(i.defaultEditorOption)})}_updateDefaultOption(t){this.option=o(o({},this.option),t),this.option$.next(this.option),"theme"in t&&t.theme&&monaco.editor.setTheme(t.theme)}requestToInit(){return l===a.LOADED?(this.onInit(),M(this.getLatestOption())):(l===a.UNLOAD&&(this.config.useStaticLoading&&typeof monaco>"u"?p("You choose to use static loading but it seems that you forget to config webpack plugin correctly. Please refer to our official websitefor more details about static loading."):this.loadMonacoScript()),D.pipe(A(()=>this.onInit()),u(()=>this.getLatestOption())))}loadMonacoScript(){if(this.config.useStaticLoading){Promise.resolve().then(()=>this.onLoad());return}if(l===a.LOADING)return;l=a.LOADING;let t=this.config.assetsRoot,i=t?`${t}/vs`:"assets/vs",r=window,s=this.document.createElement("script");s.type="text/javascript",s.src=`${i}/loader.js`;let S=()=>{w(),r.require.config(o({paths:{vs:i}},this.config.extraConfig)),r.require(["vs/editor/editor.main"],()=>{this.onLoad()})},L=()=>{throw w(),new Error(`${J} cannot load assets of monaco editor from source "${i}".`)},w=()=>{s.removeEventListener("load",S),s.removeEventListener("error",L),this.document.documentElement.removeChild(s)};s.addEventListener("load",S),s.addEventListener("error",L),this.document.documentElement.appendChild(s)}onLoad(){l=a.LOADED,D.next(!0),D.complete(),I(this.config.onLoad)()}onInit(){this.firstEditorInitialized||(this.firstEditorInitialized=!0,I(this.config.onFirstEditorInit)()),I(this.config.onInit)()}getLatestOption(){return o({},this.option)}static \u0275fac=function(i){return new(i||e)};static \u0275prov=R({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function st(e,c){e&1&&(E(0,"div",0),B(1,"nz-spin"),z())}function at(e,c){}function dt(e,c){if(e&1&&(E(0,"div",1),U(1,at,0,0,"ng-template",2),z()),e&2){let t=H();f(),q("ngTemplateOutlet",t.nzToolkit)}}var Rt=(()=>{class e{nzCodeEditorService=n(rt);ngZone=n(G);platform=n(Y);destroyRef=n($);nzEditorMode="normal";nzOriginalText="";nzLoading=!1;nzFullControl=!1;nzToolkit;set nzEditorOption(t){this.editorOption$.next(t)}nzEditorInitialized=new Z;editorOptionCached={};el=n(j).nativeElement;resize$=new b;editorOption$=new h({});editorInstance=null;value="";modelSet=!1;onDidChangeContentDisposable=null;constructor(){this.el.classList.add("ant-code-editor"),this.destroyRef.onDestroy(()=>{this.onDidChangeContentDisposable&&(this.onDidChangeContentDisposable.dispose(),this.onDidChangeContentDisposable=null),this.editorInstance&&(this.editorInstance.dispose(),this.editorInstance=null)})}ngAfterViewInit(){this.platform.isBrowser&&this.nzCodeEditorService.requestToInit().pipe(d(this.destroyRef)).subscribe(t=>this.setup(t))}writeValue(t){this.value=t,this.setValue()}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouch=t}onChange=t=>{};onTouch=()=>{};layout(){this.resize$.next()}setup(t){this.ngZone.runOutsideAngular(()=>K().pipe(d(this.destroyRef)).subscribe(()=>{this.editorOptionCached=t,this.registerOptionChanges(),this.initMonacoEditorInstance(),this.registerResizeChange(),this.setValue(),this.nzFullControl||this.setValueEmitter(),this.nzEditorInitialized.observers.length&&this.ngZone.run(()=>this.nzEditorInitialized.emit(this.editorInstance))}))}registerOptionChanges(){T([this.editorOption$,this.nzCodeEditorService.option$]).pipe(d(this.destroyRef)).subscribe(([t,i])=>{this.editorOptionCached=o(o(o({},this.editorOptionCached),i),t),this.updateOptionToMonaco()})}initMonacoEditorInstance(){this.ngZone.runOutsideAngular(()=>{this.editorInstance=this.nzEditorMode==="normal"?monaco.editor.create(this.el,o({},this.editorOptionCached)):monaco.editor.createDiffEditor(this.el,o({},this.editorOptionCached))})}registerResizeChange(){Q(window,"resize").pipe(m(300),d(this.destroyRef)).subscribe(()=>{this.layout()}),this.resize$.pipe(d(this.destroyRef),x(()=>!!this.editorInstance),u(()=>({width:this.el.clientWidth,height:this.el.clientHeight})),N((t,i)=>t.width===i.width&&t.height===i.height),m(50)).subscribe(()=>{this.editorInstance.layout()})}setValue(){if(this.editorInstance){if(this.nzFullControl&&this.value){p("should not set value when you are using full control mode! It would result in ambiguous data flow!");return}if(this.nzEditorMode==="normal")if(this.modelSet){let t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>t.setValue(this.value))}else this.editorInstance.setModel(monaco.editor.createModel(this.value,this.editorOptionCached.language)),this.modelSet=!0;else if(this.modelSet){let t=this.editorInstance.getModel();this.preservePositionAndSelections(()=>{t.modified.setValue(this.value),t.original.setValue(this.nzOriginalText)})}else{let t=this.editorOptionCached.language;this.editorInstance.setModel({original:monaco.editor.createModel(this.nzOriginalText,t),modified:monaco.editor.createModel(this.value,t)}),this.modelSet=!0}}}preservePositionAndSelections(t){if(!this.editorInstance){t();return}let i=this.editorInstance.getPosition(),r=this.editorInstance.getSelections();t(),i&&this.editorInstance.setPosition(i),r&&this.editorInstance.setSelections(r)}setValueEmitter(){let t=this.nzEditorMode==="normal"?this.editorInstance.getModel():this.editorInstance.getModel().modified;this.onDidChangeContentDisposable=t.onDidChangeContent(()=>{this.emitValue(t.getValue())})}emitValue(t){this.value!==t&&(this.value=t,this.ngZone.run(()=>{this.onChange(t)}))}updateOptionToMonaco(){this.editorInstance&&this.editorInstance.updateOptions(o({},this.editorOptionCached))}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=k({type:e,selectors:[["nz-code-editor"]],inputs:{nzEditorMode:"nzEditorMode",nzOriginalText:"nzOriginalText",nzLoading:[2,"nzLoading","nzLoading",v],nzFullControl:[2,"nzFullControl","nzFullControl",v],nzToolkit:"nzToolkit",nzEditorOption:"nzEditorOption"},outputs:{nzEditorInitialized:"nzEditorInitialized"},exportAs:["nzCodeEditor"],features:[W([{provide:it,useExisting:F(()=>e),multi:!0}])],decls:2,vars:2,consts:[[1,"ant-code-editor-loading"],[1,"ant-code-editor-toolkit"],[3,"ngTemplateOutlet"]],template:function(i,r){i&1&&(g(0,st,2,0,"div",0),g(1,dt,2,1,"div",1)),i&2&&(C(r.nzLoading?0:-1),f(),C(r.nzToolkit?1:-1))},dependencies:[ot,X],encapsulation:2,changeDetection:0})}return e})();var kt=(()=>{class e{static \u0275fac=function(i){return new(i||e)};static \u0275mod=P({type:e});static \u0275inj=_({})}return e})();export{Rt as a,kt as b};
